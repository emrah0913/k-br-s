<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye'den Kıbrıs'a Sipariş Getirme Hizmeti | Getir Kıbrıs</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { primary: '#5d3ebc', secondary: '#ffd300' },
                    fontFamily: { inter: ['Inter', 'sans-serif'] },
                    borderRadius: { 'button': '8px', DEFAULT: '8px' }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50">

<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">
    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center justify-between">
        <div class="flex-1"></div>
        <div class="flex flex-col items-center">
            <img src="logom.png" alt="Getir Kıbrıs" class="h-12">
            <a href="index.html" class="text-sm font-medium text-primary mt-1">Ana Sayfa</a>
        </div>
        <div class="flex-1 flex justify-end">
            <div id="auth-button">
                <button id="login-btn" class="text-primary"><i class="ri-google-fill ri-lg"></i></button>
                <div id="profile-container" class="hidden">
                    <img id="profile-img" src="" alt="P" class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </div>
        </div>
    </header>

    <main class="pt-16 pb-20">
        <div class="relative w-full overflow-hidden mb-6" style="padding-top: 56.25%;">
            <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/YYNLzJJKTXs" frameborder="0" allowfullscreen></iframe>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-4 mb-8">
            <button id="calculate-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 border border-gray-100 hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2">
                    <i class="ri-calculator-line ri-xl text-primary"></i>
                </div>
                <span class="text-sm font-medium">Sipariş Ver / Hesapla</span>
            </button>

            <a href="sepet.html" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 border border-gray-100 relative">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2">
                    <i class="ri-shopping-cart-line ri-xl text-primary"></i>
                </div>
                <span class="text-sm font-medium">Sepetim</span>
                <span id="cart-badge" class="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </a>
        </div>

        <div id="selection-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[100] hidden px-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-lg relative fade-in shadow-2xl">
                <button id="close-selection-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="ri-close-line ri-xl"></i></button>
                <h3 class="text-xl font-bold text-center mb-6 text-primary">İşlem Türünü Seçin</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button id="opt-link-order" class="flex flex-col items-center p-6 border-2 border-gray-100 rounded-xl hover:border-primary hover:bg-primary/5 transition-all">
                        <i class="ri-link text-3xl text-primary mb-2"></i>
                        <span class="font-bold text-gray-800">Link ile Satın Al</span>
                        <p class="text-xs text-center text-gray-500 mt-1 text-wrap">Trendyol vb. sitelerden ürün getirtin.</p>
                    </button>
                    <button id="opt-cargo-order" class="flex flex-col items-center p-6 border-2 border-gray-100 rounded-xl hover:border-orange-500 hover:bg-orange-50 transition-all">
                        <i class="ri-truck-line text-3xl text-orange-600 mb-2"></i>
                        <span class="font-bold text-gray-800">Kargo Hesapla</span>
                        <p class="text-xs text-center text-gray-500 mt-1 text-wrap">Buzdolabı, koli vb. kargolarınız için.</p>
                    </button>
                </div>
            </div>
        </div>

        <section id="calculator-section" class="bg-white rounded-lg shadow-lg mx-auto p-6 mb-8 max-w-2xl fade-in hidden">
            <h2 class="text-xl font-semibold mb-4 text-primary">Ürün Bilgilerini Girin (TR'den Kıbrıs'a)</h2>
            <form id="calculator-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki</label>
                    <input type="url" id="product-link" required class="w-full p-2 border rounded-md" placeholder="https://...">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)</label>
                    <input type="number" id="product-price" required class="w-full p-2 border rounded-md" placeholder="0.00">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                    <select id="product-category" required class="w-full p-2 border rounded-md">
                        </select>
                </div>
                
                <div id="calculation-result" class="mt-4 p-4 bg-gray-50 rounded-lg hidden">
                    <div class="flex justify-between font-bold text-primary">
                        <span>Toplam Maliyet:</span>
                        <span id="result-total">0 ₺</span>
                    </div>
                </div>

                <button type="submit" id="main-action-btn" class="w-full bg-primary text-white py-3 rounded-button font-semibold">Maliyeti Hesapla</button>
            </form>
        </section>

        <section id="item-cargo-section" class="bg-white rounded-lg shadow-lg mx-auto p-6 mb-8 max-w-2xl fade-in hidden">
            <h2 class="text-xl font-semibold mb-4 text-primary text-center">Eşya Kargo Hesaplama</h2>
            <div class="space-y-4">
                <div class="flex gap-2">
                    <button class="dir-btn flex-1 py-2 rounded-md border-2 border-primary bg-primary text-white text-xs font-bold" data-dir="TR-KKTC">TR ➔ KIBRIS</button>
                    <button class="dir-btn flex-1 py-2 rounded-md border-2 border-primary text-primary text-xs font-bold" data-dir="KKTC-TR">KIBRIS ➔ TR</button>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Eşya Ara</label>
                    <input type="text" id="item-search" class="w-full p-3 border rounded-md" placeholder="Örn: Bulaşık Makinesi...">
                    <div id="search-results" class="mt-1 bg-white border rounded-md hidden max-h-48 overflow-y-auto shadow-xl z-50 relative"></div>
                </div>
                <div id="selected-item-info" class="hidden p-4 bg-primary/5 rounded-lg border-2 border-dashed border-primary">
                    <div class="flex justify-between items-center font-bold">
                        <span id="selected-item-name"></span>
                        <span id="selected-item-price" class="text-xl text-primary">0 ₺</span>
                    </div>
                </div>
                <button id="add-cargo-to-cart" class="w-full bg-primary text-white py-3 rounded-button font-semibold opacity-50" disabled>Sepete Ekle</button>
            </div>
        </section>

    </main>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
        authDomain: "kibris-6b4f7.firebaseapp.com",
        projectId: "kibris-6b4f7",
        storageBucket: "kibris-6b4f7.firebasestorage.app",
        messagingSenderId: "141262926171",
        appId: "1:141262926171:web:07226845e51d4bbc0dea7e"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Veriler (Bunu Admin Panelinden de çekebilirsin)
    const cargoItems = [
        { name: 'Bulaşık Makinesi', price: 1500 },
        { name: 'Buzdolabı (Büyük)', price: 2800 },
        { name: 'Çamaşır Makinesi', price: 1450 },
        { name: 'Kombi', price: 900 },
        { name: 'Koli (Orta)', price: 200 },
        { name: 'Televizyon (55 inç)', price: 750 }
    ];

    // Elementler
    const selectionModal = document.getElementById('selection-modal');
    const linkSection = document.getElementById('calculator-section');
    const cargoSection = document.getElementById('item-cargo-section');

    // MODAL YÖNETİMİ
    document.getElementById('calculate-btn').onclick = () => selectionModal.classList.remove('hidden');
    document.getElementById('close-selection-modal').onclick = () => selectionModal.classList.add('hidden');
    
    document.getElementById('opt-link-order').onclick = () => {
        selectionModal.classList.add('hidden');
        cargoSection.classList.add('hidden');
        linkSection.classList.remove('hidden');
        linkSection.scrollIntoView({behavior: 'smooth'});
    };

    document.getElementById('opt-cargo-order').onclick = () => {
        selectionModal.classList.add('hidden');
        linkSection.classList.add('hidden');
        cargoSection.classList.remove('hidden');
        cargoSection.scrollIntoView({behavior: 'smooth'});
    };

    // EŞYA ARAMA SİSTEMİ
    const searchInput = document.getElementById('item-search');
    const searchResults = document.getElementById('search-results');

    searchInput.addEventListener('input', (e) => {
        const val = e.target.value.toLocaleLowerCase('tr-TR');
        if (val.length < 2) { searchResults.classList.add('hidden'); return; }
        
        const filtered = cargoItems.filter(i => i.name.toLocaleLowerCase('tr-TR').includes(val));
        
        if (filtered.length > 0) {
            searchResults.innerHTML = filtered.map(i => `
                <div class="p-3 hover:bg-gray-100 cursor-pointer border-b select-item-trigger" 
                     data-name="${i.name}" data-price="${i.price}">
                    ${i.name} - <span class="font-bold text-primary">${i.price} ₺</span>
                </div>
            `).join('');
            searchResults.classList.remove('hidden');
        } else {
            searchResults.classList.add('hidden');
        }
    });

    // Delegasyon ile tıklama yakalama (Global function hatasını önler)
    searchResults.addEventListener('click', (e) => {
        const item = e.target.closest('.select-item-trigger');
        if (!item) return;
        
        const name = item.dataset.name;
        const price = item.dataset.price;
        
        searchInput.value = name;
        searchResults.classList.add('hidden');
        document.getElementById('selected-item-info').classList.remove('hidden');
        document.getElementById('selected-item-name').textContent = name;
        document.getElementById('selected-item-price').textContent = price + " ₺";
        
        const btn = document.getElementById('add-cargo-to-cart');
        btn.disabled = false;
        btn.classList.remove('opacity-50');
    });

    // Yön Butonları Renk Değişimi
    document.querySelectorAll('.dir-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.dir-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white');
                b.classList.add('text-primary');
            });
            btn.classList.add('bg-primary', 'text-white');
        };
    });

    // --- MEVCUT AUTH VE DİĞER FONKSİYONLARIN DEVAMI BURAYA GELECEK ---
    // (Giriş yapma, sepet badge'i, vb. işlemler yukarıdaki gibi onAuthStateChanged içine eklenmeli)
    
</script>

</body>
</html>

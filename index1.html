<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getir KÄ±brÄ±s | TÃ¼rkiye'den KÄ±brÄ±s'a GÃ¼venli SipariÅŸ</title>
    
    <!-- CSS & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5d3ebc',
                        secondary: '#ffd300',
                        accent: '#2ecc71',
                        dark: '#1a1a1a'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    borderRadius: {
                        'button': '12px',
                        DEFAULT: '24px',
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        
        .product-slider { 
            display: flex;
            overflow-x: auto; 
            scroll-snap-type: x mandatory;
            scrollbar-width: none; 
            -ms-overflow-style: none; 
            white-space: nowrap; 
            padding-bottom: 1rem;
        }
        .product-slider::-webkit-scrollbar { display: none; }
        .product-card {
            display: inline-block;
            width: 280px;
            margin-right: 1.5rem;
            white-space: normal;
            scroll-snap-align: start;
            flex-shrink: 0;
        }
        
        .hero-banner { background: linear-gradient(135deg, #5d3ebc 0%, #4c2fb3 100%); }
        .btn-hover { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-hover:hover { transform: translateY(-2px); filter: brightness(1.05); }
        .btn-hover:active { transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <!-- Header -->
    <header class="fixed top-0 w-full max-w-screen-lg bg-white/90 backdrop-blur-md shadow-sm z-50 px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <img src="logom.png" alt="Logo" class="h-10" onerror="this.src='https://placehold.co/140x45/5d3ebc/ffffff?text=Getir+Kibris'">
            <div class="h-6 w-px bg-gray-200 mx-2 hidden sm:block"></div>
            <a href="index.html" class="text-[11px] font-black text-primary uppercase tracking-tighter hover:text-indigo-700 transition-colors">Ana Sayfa</a>
        </div>
        
        <div id="auth-section" class="flex items-center gap-3">
            <!-- Login Button -->
            <button id="login-trigger" class="flex items-center gap-2 bg-white border-2 border-primary text-primary px-4 py-2 rounded-xl text-[11px] font-black uppercase btn-hover">
                <i class="ri-google-fill text-red-500"></i> GiriÅŸ Yap
            </button>
            <!-- User Profile (Hidden initially) -->
            <div id="profile-container" class="hidden flex items-center gap-3">
                <div class="text-right hidden sm:block">
                    <p id="user-display-name" class="text-[10px] font-black text-gray-800 truncate max-w-[120px]"></p>
                    <button id="logout-btn" class="text-[8px] font-bold text-red-500 uppercase tracking-widest hover:underline">Ã‡Ä±kÄ±ÅŸ</button>
                </div>
                <img id="user-photo" src="" class="w-10 h-10 rounded-full border-2 border-primary shadow-md cursor-pointer">
            </div>
        </div>
    </header>

    <main class="pt-24 px-4">
        
        <!-- Hero Banner -->
        <section class="hero-banner rounded-[40px] p-8 mb-10 text-white relative overflow-hidden shadow-2xl">
            <div class="relative z-10 max-w-2xl font-inter">
                <div class="inline-flex items-center gap-2 bg-secondary text-primary px-3 py-1 rounded-full text-[10px] font-black uppercase mb-4 shadow-lg">
                    <i class="ri-shield-check-fill"></i> GÃ¼venli TaÅŸÄ±macÄ±lÄ±k
                </div>
                <h1 class="text-3xl sm:text-5xl font-black mb-4 leading-tight tracking-tight">TÃ¼rkiye'den KÄ±brÄ±s'a<br>AlÄ±ÅŸveriÅŸin En Kolay Yolu</h1>
                <p class="text-indigo-50 mb-6 text-sm sm:text-base opacity-95 font-medium leading-relaxed">
                    Trendyol, Amazon ve Hepsiburada sipariÅŸlerinizi kapÄ±nÄ±za getiriyoruz. Mobilya, tekstil veya elektronik; tek sepetle yÃ¶netin.
                </p>
                <button id="hero-calc-btn" class="bg-secondary text-primary px-8 py-4 rounded-2xl font-black uppercase tracking-wider text-xs btn-hover shadow-xl">
                    Hemen Hesapla
                </button>
            </div>
            <i class="ri-archive-stack-line absolute -bottom-10 -right-10 text-white/5 text-[280px] rotate-6 pointer-events-none"></i>
        </section>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-16 text-center">
            <a href="https://getirkibris.com/getirhome" class="bg-gradient-to-br from-secondary to-secondary/80 shadow-lg p-6 rounded-[32px] flex flex-col items-center justify-center border border-secondary/50 btn-hover group overflow-hidden">
                <div class="w-14 h-14 bg-white rounded-full flex items-center justify-center mb-3 shadow-xl border-2 border-white p-1.5 transition-transform group-hover:rotate-6">
                    <img src="getir-home-logo.png" alt="Getir Home" class="w-full h-full object-contain" onerror="this.src='https://placehold.co/80x80/ffd300/5d3ebc?text=Home'">
                </div>
                <span class="text-xs font-black text-primary uppercase tracking-widest">Getir Home</span>
            </a>

            <button id="action-calculate-trigger" class="bg-white shadow-xl shadow-gray-200/50 p-6 rounded-[32px] flex flex-col items-center justify-center border border-gray-100 btn-hover group">
                <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                    <i class="ri-flashlight-fill ri-2x text-primary"></i>
                </div>
                <span class="text-xs font-black text-gray-800 uppercase tracking-widest">SipariÅŸ Ver</span>
            </button>

            <button id="cart-nav-btn" class="bg-white shadow-xl shadow-gray-200/50 p-6 rounded-[32px] flex flex-col items-center justify-center border border-gray-100 btn-hover group relative">
                <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform">
                    <i class="ri-shopping-bag-3-fill ri-2x text-primary"></i>
                    <span id="cart-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-black rounded-full h-6 w-6 flex items-center justify-center hidden border-2 border-white shadow-lg animate-bounce">0</span>
                </div>
                <span class="text-xs font-black text-gray-800 uppercase tracking-widest">Sepetim</span>
            </button>
        </div>

        <!-- Calculator Section -->
        <section id="calculator-section" class="bg-white rounded-[40px] shadow-2xl mx-auto p-8 mb-20 max-w-2xl border border-gray-100 relative overflow-hidden hidden fade-in">
            <div class="absolute top-0 left-0 w-2 h-full bg-primary"></div>
            <div class="mb-10 text-center">
                <h2 class="text-2xl font-black text-gray-800 tracking-tight">AkÄ±llÄ± HesaplayÄ±cÄ±</h2>
                <p class="text-xs text-gray-400 font-bold uppercase mt-1 text-primary tracking-widest">GÃ¼mrÃ¼k, Nakliye ve Sigorta Dahil</p>
                <div class="mt-4 inline-flex items-center gap-2 bg-indigo-50 px-4 py-2 rounded-full border border-indigo-100">
                    <i class="ri-user-smile-line text-primary"></i>
                    <span class="text-[10px] font-bold text-primary/80 uppercase">Misafir olarak hesaplama yapabilirsiniz!</span>
                </div>
            </div>

            <form id="calculator-form" class="space-y-6">
                <!-- Order Method -->
                <div>
                    <label for="order-method" class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 ml-2">SipariÅŸ YÃ¶ntemi</label>
                    <select id="order-method" class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-primary/20 rounded-2xl outline-none text-sm font-semibold transition-all">
                        <option value="service" selected>ÃœrÃ¼nÃ¼ benim yerime siz sipariÅŸ edin</option>
                        <option value="self">ÃœrÃ¼nÃ¼ ben alacaÄŸÄ±m, sadece kargo hizmeti istiyorum</option>
                    </select>
                </div>

                <!-- Product Link -->
                <div class="relative group">
                    <i class="ri-link-m absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="url" id="product-link" required class="w-full p-5 pl-14 bg-gray-50 border-2 border-transparent focus:border-primary/20 rounded-2xl outline-none text-sm font-semibold transition-all" placeholder="ÃœrÃ¼n linkini buraya yapÄ±ÅŸtÄ±rÄ±n...">
                </div>

                <!-- Product Price -->
                <div class="relative group">
                    <i class="ri-money-dollar-circle-line absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="number" id="product-price" required class="w-full p-5 pl-14 bg-gray-50 border-2 border-transparent focus:border-primary/20 rounded-2xl outline-none text-sm font-semibold transition-all" placeholder="ÃœrÃ¼n FiyatÄ± (â‚º)" step="0.01">
                </div>

                <!-- Category -->
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 ml-2">Kategori</label>
                    <select id="product-category" required class="w-full p-5 bg-gray-50 border-2 border-transparent focus:border-primary/20 rounded-2xl outline-none text-sm font-semibold transition-all">
                        <option value="" disabled selected>Kategori SeÃ§in</option>
                    </select>
                </div>

                <!-- Result Panel -->
                <div id="calculation-result" class="mt-8 p-8 bg-dark text-white rounded-[32px] hidden shadow-2xl relative overflow-hidden border-2 border-primary/20">
                    <div class="relative z-10 space-y-4">
                        <div class="flex justify-between items-center text-xs text-gray-400 font-bold uppercase tracking-wider">
                            <span id="result-price-label">ÃœrÃ¼n Bedeli</span>
                            <span id="result-price-val" class="text-white font-black">0 â‚º</span>
                        </div>
                        <div class="flex justify-between items-center text-xs text-gray-400 font-bold uppercase tracking-wider">
                            <span>Lojistik & GÃ¼mrÃ¼k Ãœcreti</span>
                            <span id="result-fee-val" class="text-accent font-black">+0 â‚º</span>
                        </div>
                        <div class="pt-5 border-t border-white/10 flex justify-between items-center">
                            <span class="text-[10px] font-black uppercase tracking-[3px] text-primary bg-white px-3 py-1 rounded-full">Net Toplam</span>
                            <span id="result-total-val" class="text-3xl font-black text-secondary">0 â‚º</span>
                        </div>
                    </div>
                    <div class="absolute -right-10 -bottom-10 opacity-5 rotate-12">
                        <i class="ri-safe-2-line text-[150px]"></i>
                    </div>
                </div>

                <button type="submit" id="calc-submit-btn" class="w-full bg-primary text-white py-6 rounded-[24px] font-black uppercase tracking-[4px] shadow-2xl shadow-primary/30 transition-all active:scale-[0.98]">
                    <span id="calc-btn-text">Maliyeti Hesapla</span>
                </button>
            </form>
        </section>

        <!-- Popular Products -->
        <h2 class="text-2xl font-black text-gray-800 mb-8 border-b-4 border-primary inline-block pb-2 tracking-tighter uppercase">ðŸ›’ En PopÃ¼ler FÄ±rsatlar</h2>
        <div class="product-slider px-2 mb-20">
            <!-- 1. Legom -->
            <div class="product-card bg-white shadow-xl rounded-[32px] overflow-hidden border border-gray-100 hover:shadow-2xl transition-all">
                <div class="h-52 bg-gray-50 flex items-center justify-center p-6">
                    <img src="https://cdn.dsmcdn.com/ty1339/product/media/images/prod/QC/20240531/13/4f260764-0e89-3345-85d3-c78b2860a122/1_org_zoom.jpg" class="max-h-full object-contain" loading="lazy">
                </div>
                <div class="p-6 text-center">
                    <h3 class="text-xs font-black text-gray-800 mb-2 truncate uppercase">Legom Aktivite KoltuÄŸu</h3>
                    <p class="text-[10px] font-bold text-gray-400 mb-2">Yatak & Ã‡ok AmaÃ§lÄ±</p>
                    <p class="text-xl font-black text-red-600 mb-5 tracking-tighter">12.635,00 â‚º</p>
                    <a href="https://www.trendyol.com/good-night/legom-aktivite-koltugu-yatak-cok-amacli-p-833506385" target="_blank" class="block w-full text-center bg-primary text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest btn-hover">SatÄ±n Al</a>
                </div>
            </div>
            <!-- 2. Terlik -->
            <div class="product-card bg-white shadow-xl rounded-[32px] overflow-hidden border border-gray-100 hover:shadow-2xl transition-all">
                <div class="h-52 bg-gray-50 flex items-center justify-center p-6">
                    <img src="https://cdn.dsmcdn.com/ty1583/prod/QC/20241008/22/36a5c729-891b-369b-9235-de1c4459aab2/1_org_zoom.jpg" class="max-h-full object-contain" loading="lazy">
                </div>
                <div class="p-6 text-center">
                    <h3 class="text-xs font-black text-gray-800 mb-2 truncate uppercase">3'lÃ¼ KÄ±ÅŸlÄ±k Ev TerliÄŸi</h3>
                    <p class="text-[10px] font-bold text-gray-400 mb-2">Misafir TerliÄŸi</p>
                    <p class="text-xl font-black text-red-600 mb-5 tracking-tighter">289,90 â‚º</p>
                    <a href="https://www.trendyol.com/star-shoes/3-lu-kislik-ev-terligi-kislik-terlik-misafir-terligi-p-864790548" target="_blank" class="block w-full text-center bg-primary text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest btn-hover">SatÄ±n Al</a>
                </div>
            </div>
            <!-- 3. Mont -->
            <div class="product-card bg-white shadow-xl rounded-[32px] overflow-hidden border border-gray-100 hover:shadow-2xl transition-all">
                <div class="h-52 bg-gray-50 flex items-center justify-center p-6">
                    <img src="https://cdn.dsmcdn.com/ty1613/prod/QC/20241208/02/3f26a3f7-9329-3fbf-976d-40355be6ec72/1_org_zoom.jpg" class="max-h-full object-contain" loading="lazy">
                </div>
                <div class="p-6 text-center">
                    <h3 class="text-xs font-black text-gray-800 mb-2 truncate uppercase">KadÄ±n Siyah Oversize Mont</h3>
                    <p class="text-[10px] font-bold text-gray-400 mb-2">Dik Yaka ÅžiÅŸme</p>
                    <p class="text-xl font-black text-red-600 mb-5 tracking-tighter">826,68 â‚º</p>
                    <a href="https://www.trendyol.com/lia-blanco-s/kadin-siyah-oversize-sisme-kislik-mont-dik-yaka-p-856865482" target="_blank" class="block w-full text-center bg-primary text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest btn-hover">SatÄ±n Al</a>
                </div>
            </div>
            <!-- 4. SaÃ§ -->
            <div class="product-card bg-white shadow-xl rounded-[32px] overflow-hidden border border-gray-100 hover:shadow-2xl transition-all">
                <div class="h-52 bg-gray-50 flex items-center justify-center p-6">
                    <img src="https://cdn.dsmcdn.com/ty1521/product/media/images/prod/QC/20240903/19/2055f782-17d7-358f-bf14-480a25545b92/1_org_zoom.jpg" class="max-h-full object-contain" loading="lazy">
                </div>
                <div class="p-6 text-center">
                    <h3 class="text-xs font-black text-gray-800 mb-2 truncate uppercase">Ovex HÄ±zlÄ± SaÃ§ Kurtarma</h3>
                    <p class="text-[10px] font-bold text-gray-400 mb-2">CanlandÄ±rma Terapisi</p>
                    <p class="text-xl font-black text-red-600 mb-5 tracking-tighter">379,24 â‚º</p>
                    <a href="https://www.trendyol.com/hc-care/ovex-hizli-sac-kurtarma-ve-canlandirma-terapisi-200-ml-p-7103580" target="_blank" class="block w-full text-center bg-primary text-white text-[10px] font-black py-4 rounded-2xl uppercase tracking-widest btn-hover">SatÄ±n Al</a>
                </div>
            </div>
        </div>

        <!-- Stores Grid -->
        <div class="px-2 mb-20">
            <h3 class="text-lg font-black mb-8 uppercase tracking-[3px] text-gray-300 text-center sm:text-left">AnlaÅŸmalÄ± MaÄŸazalar</h3>
            <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-6">
                <a href="https://www.trendyol.com" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://www.freelogovectors.net/wp-content/uploads/2024/01/trendyol_logo-freelogovectors.net_.png" class="max-h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
                <a href="https://www.hepsiburada.com" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://www.ideasoft.com.tr/wp-content/uploads/2022/05/Hepsiburada-Logo-Transparan.png" class="max-h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
                <a href="https://www.n11.com" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/60/N11_logo.svg" class="max-h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
                <a href="https://www.amazon.com.tr" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTZvIiXt3ogobFi7dC0k1dMgpNvrwiTQl6cbA&s" class="max-h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
                <a href="https://www.zara.com.tr" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://logodownload.org/wp-content/uploads/2014/05/zara-logo-0.png" class="max-h-12 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
                <a href="https://www.temu.com" target="_blank" class="bg-white rounded-3xl shadow-sm p-5 h-28 flex items-center justify-center border border-gray-50 btn-hover">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/db/Temu_logo_icon.svg/2048px-Temu_logo_icon.svg.png" class="max-h-10 object-contain grayscale hover:grayscale-0 transition-all">
                </a>
            </div>
        </div>

        <!-- Video Section (Must be below store grid) -->
        <section class="mb-20">
            <h3 class="text-xl font-black mb-8 text-gray-800 uppercase tracking-tighter text-center">Operasyonel SÃ¼recimiz</h3>
            <div class="relative w-full overflow-hidden rounded-[40px] shadow-2xl bg-black border-4 border-white" style="padding-top: 56.25%;">
                <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/YYNLzJJKTXs" title="TanÄ±tÄ±m Videosu" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>
        </section>

        <!-- Warehouse Info (Below Video) -->
        <div class="bg-white p-8 rounded-[40px] shadow-sm border border-gray-100">
            <h3 class="text-xl font-black mb-8 text-primary tracking-tighter flex items-center gap-2">
                <i class="ri-map-pin-user-fill"></i> Depo & Kabul NoktalarÄ±mÄ±z
            </h3>
            <div class="grid sm:grid-cols-2 gap-8 font-inter">
                <div class="bg-gray-50 p-7 rounded-[32px] border border-gray-100 relative overflow-hidden">
                    <h4 class="font-black text-[10px] uppercase mb-4 text-primary tracking-[3px]">TÃ¼rkiye Toplama Merkezi</h4>
                    <p class="text-[11px] text-gray-600 leading-relaxed font-medium">
                        <strong>Adres:</strong> Bozyurt Mah. Kanal ÃœstÃ¼ 3281 sk. No:3, Nazilli/AydÄ±n<br>
                        <strong>Telefon:</strong> +90 547 190 19 88<br>
                        <strong>Yetkili:</strong> Emrah Kutlu
                    </p>
                    <i class="ri-map-pin-2-fill absolute -right-4 -bottom-4 text-gray-100 text-6xl"></i>
                </div>
                <div class="bg-gray-50 p-7 rounded-[32px] border border-gray-100 relative overflow-hidden">
                    <h4 class="font-black text-[10px] uppercase mb-4 text-primary tracking-[3px]">KÄ±brÄ±s Teslimat Ofisi</h4>
                    <p class="text-[11px] text-gray-600 leading-relaxed font-medium">
                        <strong>Adres:</strong> AlaykÃ¶y Sanayi BÃ¶lgesi 1.Etap, 8.Sokak, LefkoÅŸa<br>
                        <strong>Telefon:</strong> +90 533 860 71 82<br>
                        <strong>E-posta:</strong> info@getirkibris.com
                    </p>
                    <i class="ri-truck-fill absolute -right-4 -bottom-4 text-gray-100 text-6xl"></i>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-20 px-4 pb-16 text-center border-t border-gray-100 pt-10">
        <div class="flex justify-center gap-8 mb-8 text-[10px] font-black uppercase tracking-widest text-gray-400">
            <a href="gizlilik.html" class="hover:text-primary transition-colors">Gizlilik</a>
            <a href="sartlar.html" class="hover:text-primary transition-colors">Åžartlar</a>
            <a href="sss.html" class="hover:text-primary transition-colors">S.S.S.</a>
        </div>
        <p class="text-[9px] text-gray-300 font-bold uppercase tracking-widest">&copy; 2024 Getir KÄ±brÄ±s. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.</p>
    </footer>

    <!-- WhatsApp Floating -->
    <a href="https://wa.me/905471901988" target="_blank" class="fixed bottom-10 right-10 bg-[#25D366] w-16 h-16 rounded-full shadow-2xl flex items-center justify-center text-white text-4xl z-[60] btn-hover">
        <i class="ri-whatsapp-line"></i>
    </a>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-32 left-1/2 -translate-x-1/2 bg-dark text-white px-8 py-4 rounded-full text-[10px] font-black uppercase tracking-widest opacity-0 transition-all z-[200] shadow-2xl pointer-events-none border border-white/10"></div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-dark/80 hidden items-center justify-center z-[100] p-4 backdrop-blur-md">
        <div class="bg-white w-full max-sm:w-[90%] max-w-sm rounded-[48px] p-12 text-center shadow-2xl fade-in">
            <h3 id="modal-title" class="text-2xl font-black mb-4 uppercase tracking-tighter text-gray-800">HoÅŸ Geldiniz</h3>
            <p id="modal-desc" class="text-xs text-gray-500 mb-10 font-medium">Sepetinize Ã¼rÃ¼n eklemek ve sipariÅŸlerinizi takip etmek iÃ§in Google ile giriÅŸ yapÄ±n.</p>
            <button id="google-login-btn" class="w-full py-5 bg-gray-50 hover:bg-gray-100 rounded-2xl font-black uppercase tracking-widest flex items-center justify-center gap-3 transition-colors border border-gray-100">
                <i class="ri-google-fill text-red-500 ri-xl"></i> Google Ä°le GiriÅŸ
            </button>
            <button id="close-modal-btn" class="mt-6 text-[10px] font-black text-gray-400 hover:text-gray-600 transition-colors uppercase tracking-[3px]">Geri DÃ¶n</button>
        </div>
    </div>

</div>

<script type="module">
    // Firebase Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, addDoc, onSnapshot, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Firebase Config (Updated to use environment variables for better compatibility)
    const firebaseConfig = typeof __firebase_config !== 'undefined' 
        ? JSON.parse(__firebase_config) 
        : {
            apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
            authDomain: "kibris-6b4f7.firebaseapp.com",
            projectId: "kibris-6b4f7",
            storageBucket: "kibris-6b4f7.firebasestorage.app",
            messagingSenderId: "141262926171",
            appId: "1:141262926171:web:07226845e51d4bbc0dea7e"
        };
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    
    // Initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // State
    let userState = null;
    let pricingSettings = {
        categoryRates: { 'furniture': 0.75, 'shopping': 0.45, 'personal': 0.35, 'electronics': 0.85, 'hobby': 0.55, 'industrial': 0.90 }
    };
    let calculationState = 'idle'; // idle or calculated

    // DOM Elements
    const loginTrigger = document.getElementById('login-trigger');
    const profileContainer = document.getElementById('profile-container');
    const userPhoto = document.getElementById('user-photo');
    const userDisplayName = document.getElementById('user-display-name');
    const logoutBtn = document.getElementById('logout-btn');
    const cartBadge = document.getElementById('cart-badge');
    const calculatorForm = document.getElementById('calculator-form');
    const calcSection = document.getElementById('calculator-section');
    const calcResultPanel = document.getElementById('calculation-result');
    const calcSubmitBtn = document.getElementById('calc-submit-btn');
    const calcBtnText = document.getElementById('calc-btn-text');
    const googleLoginBtn = document.getElementById('google-login-btn');
    const loginModal = document.getElementById('login-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalDesc = document.getElementById('modal-desc');

    // Rule 3: Auth Logic with proper fallback for mismatched tokens
    const initAuth = async () => {
        try {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                // Try custom token first
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            // Fallback to anonymous on token mismatch or other auth errors
            console.error("Auth initialization error, falling back to anonymous:", error.message);
            await signInAnonymously(auth).catch(err => console.error("Final fallback failed:", err));
        }
    };

    // UI Updates
    const showToast = (msg) => {
        const toast = document.getElementById('toast');
        toast.innerText = msg;
        toast.classList.replace('opacity-0', 'opacity-100');
        setTimeout(() => toast.classList.replace('opacity-100', 'opacity-0'), 3000);
    };

    const toggleModal = (show, title = "HoÅŸ Geldiniz", desc = "Google ile giriÅŸ yapÄ±n.") => {
        modalTitle.innerText = title;
        modalDesc.innerText = desc;
        loginModal.classList.toggle('hidden', !show);
    };

    // Pricing Loader (Rule 4 path: /settings/pricing)
    const loadPricing = async () => {
        try {
            const snap = await getDoc(doc(db, 'settings', 'pricing'));
            if (snap.exists()) {
                pricingSettings = snap.data();
            }
        } catch (e) {
            console.warn("Fiyat ayarlarÄ± varsayÄ±landa kaldÄ±.");
        }
        populateCategories();
    };

    const populateCategories = () => {
        const sel = document.getElementById('product-category');
        const names = { shopping: "Giyim & Tekstil", furniture: "Mobilya & BÃ¼yÃ¼k EÅŸya", personal: "Paket & Kargo", electronics: "Elektronik & KÃ¼Ã§Ã¼k Ev", hobby: "Spor & Hobi", industrial: "Sanayi & DiÄŸer" };
        sel.innerHTML = '<option value="" disabled selected>Kategori SeÃ§in</option>' + 
            Object.keys(pricingSettings.categoryRates).map(k => `<option value="${k}">${names[k] || k}</option>`).join('');
    };

    // Cart Listener (Rule 1 path: /users/{uid}/cart)
    const listenToCart = (uid) => {
        if (!uid) return;
        const cartRef = collection(db, 'users', uid, 'cart');
        onSnapshot(cartRef, (snap) => {
            const count = snap.size;
            cartBadge.innerText = count;
            cartBadge.classList.toggle('hidden', count === 0);
        });
    };

    // Calculation Logic
    const calculate = () => {
        const price = parseFloat(document.getElementById('product-price').value) || 0;
        const cat = document.getElementById('product-category').value;
        const method = document.getElementById('order-method').value;

        if (!cat || price <= 0) {
            showToast("LÃ¼tfen fiyat ve kategori girin.");
            return;
        }

        const fee = price * (pricingSettings.categoryRates[cat] || 0.45);
        const total = method === 'self' ? fee : price + fee;

        document.getElementById('result-price-label').textContent = method === 'self' ? 'ÃœrÃ¼n Bedeli (Size Ait)' : 'ÃœrÃ¼n Bedeli';
        document.getElementById('result-price-val').textContent = `${price.toLocaleString('tr-TR')} â‚º`;
        document.getElementById('result-fee-val').textContent = `+${fee.toLocaleString('tr-TR')} â‚º`;
        document.getElementById('result-total-val').textContent = `${total.toLocaleString('tr-TR', {minimumFractionDigits: 2})} â‚º`;
        
        calcResultPanel.classList.remove('hidden');
        calcSubmitBtn.classList.replace('bg-primary', 'bg-accent');
        calcBtnText.innerText = "Sepete Ekle";
        calculationState = 'calculated';
        showToast("Maliyet hesaplandÄ±.");
    };

    // Add To Cart Logic
    const addToCart = async () => {
        if (!userState || userState.isAnonymous) {
            toggleModal(true, "Sepete Ekle", "Bu sipariÅŸi sepetinize kaydetmek iÃ§in lÃ¼tfen Google ile giriÅŸ yapÄ±n.");
            return;
        }

        const totalStr = document.getElementById('result-total-val').textContent;
        const cleanTotal = Number(totalStr.replace('â‚º','').replace(/\./g,'').replace(',','.').trim());

        try {
            showToast("Sepete ekleniyor...");
            await addDoc(collection(db, 'users', userState.uid, 'cart'), {
                link: document.getElementById('product-link').value,
                price: parseFloat(document.getElementById('product-price').value),
                category: document.getElementById('product-category').value,
                method: document.getElementById('order-method').value,
                total: cleanTotal,
                status: 'pending',
                addedAt: new Date()
            });
            showToast("Sepete eklendi!");
            resetCalculator();
        } catch (e) {
            showToast("Hata oluÅŸtu.");
            console.error(e);
        }
    };

    const resetCalculator = () => {
        calculationState = 'idle';
        calculatorForm.reset();
        calcResultPanel.classList.add('hidden');
        calcSubmitBtn.classList.replace('bg-accent', 'bg-primary');
        calcBtnText.innerText = "Maliyeti Hesapla";
    };

    // Initializer
    const init = () => {
        initAuth();

        onAuthStateChanged(auth, (user) => {
            userState = user;
            if (user && !user.isAnonymous) {
                loginTrigger.classList.add('hidden');
                profileContainer.classList.remove('hidden');
                userPhoto.src = user.photoURL || '';
                userDisplayName.innerText = user.displayName || 'KullanÄ±cÄ±';
                listenToCart(user.uid);
            } else {
                loginTrigger.classList.remove('hidden');
                profileContainer.classList.add('hidden');
                cartBadge.classList.add('hidden');
            }
            loadPricing();
        });

        // Event Handlers
        loginTrigger.onclick = () => toggleModal(true);
        googleLoginBtn.onclick = () => signInWithPopup(auth, new GoogleAuthProvider()).then(() => toggleModal(false));
        document.getElementById('close-modal-btn').onclick = () => toggleModal(false);
        logoutBtn.onclick = () => auth.signOut();

        document.getElementById('hero-calc-btn').onclick = () => {
            calcSection.classList.remove('hidden');
            calcSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };
        document.getElementById('action-calculate-trigger').onclick = () => {
            calcSection.classList.toggle('hidden');
            if(!calcSection.classList.contains('hidden')) calcSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };
        document.getElementById('cart-nav-btn').onclick = () => {
            if(!userState || userState.isAnonymous) toggleModal(true, "Sepetim", "Sepetinize eriÅŸmek iÃ§in lÃ¼tfen giriÅŸ yapÄ±n.");
            else window.location.href = 'sepet.html';
        };

        calculatorForm.onsubmit = (e) => {
            e.preventDefault();
            if (calculationState === 'idle') calculate();
            else addToCart();
        };

        // Inputs changed
        const inputs = calculatorForm.querySelectorAll('input, select');
        inputs.forEach(input => input.oninput = () => {
            if (calculationState === 'calculated') resetCalculator();
        });
    };

    init();
</script>

</body>
</html>

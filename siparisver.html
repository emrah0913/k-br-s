<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sipariş Ver - Getir Kıbrıs</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config={theme:{extend:{colors:{primary:'#5d3ebc',secondary:'#ffd300'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <style>
        :where([class^="ri-"])::before { content: "\f3c2"; } /* Kullanıcının eklediği CSS */
        body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
        /* Gerekirse ek stiller */
    </style>
</head>
<body class="bg-gray-50">
    <div class="w-full max-w-screen-md mx-auto p-4 sm:p-6 md:p-8 min-h-screen">
        <header class="mb-8 text-center py-6">
            <a href="index.html"> 
                <img src="https://static.readdy.ai/image/d4cf8783f5bb2724d5eb1b66ee82374b/8de9178d5e8d147b21dbfa093538290a.png" alt="Getir Kıbrıs" class="h-12 mx-auto mb-2">
            </a>
            <h1 class="text-2xl sm:text-3xl font-semibold text-primary">Siparişinizi Gözden Geçirin</h1>
        </header>

        <main class="space-y-8">
            <div id="calculator-section" class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <h3 class="text-xl font-semibold mb-4 text-primary border-b pb-2">Ürün Maliyeti (Gerekirse Güncelleyin)</h3>
                <form id="calculator-form" class="space-y-4">
                    <div>
                        <label for="order-method" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Yöntemi</label>
                        <div class="relative mb-4">
                            <i class="ri-shopping-bag-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <select id="order-method" class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm focus:ring-1 focus:ring-primary">
                                <option value="" disabled>Sipariş yöntemi seçin</option>
                                <option value="self">Ürünü ben sipariş edeceğim, sadece kargo hizmeti istiyorum</option>
                                <option value="service">Ürünü benim yerime siz sipariş edin, size ödeme yapacağım</option>
                            </select>
                            <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                        </div>
                        <div>
                            <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki</label>
                            <div class="relative">
                                <i class="ri-link ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="url" id="product-link" class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="https://www.example.com/urun">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)</label>
                        <div class="relative">
                            <i class="ri-money-lira-circle-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="number" id="product-price" class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="0.00">
                        </div>
                    </div>
                    <div>
                        <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                        <div class="relative">
                            <i class="ri-price-tag-3-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <select id="product-category" class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm focus:ring-1 focus:ring-primary">
                                <option value="" disabled>Kategori seçin</option>
                                <option value="furniture">Mobilya</option>
                                <option value="electronics">Elektronik</option>
                                <option value="clothing">Giyim</option>
                                <option value="cosmetics">Kozmetik</option>
                                <option value="stationery">Kırtasiye</option>
                            </select>
                            <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                        </div>
                    </div>
                    <div>
                        <span class="block text-sm font-medium text-gray-700 mb-2">Teslimat Tipi</span>
                        <div class="flex space-x-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="delivery-type" value="warehouse" class="sr-only">
                                <div class="w-5 h-5 border border-gray-400 rounded-full flex items-center justify-center mr-2 delivery-radio">
                                    <div class="w-3 h-3 bg-primary rounded-full hidden"></div>
                                </div>
                                <span class="text-sm">Depodan teslim</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="radio" name="delivery-type" value="home" class="sr-only">
                                <div class="w-5 h-5 border border-gray-400 rounded-full flex items-center justify-center mr-2 delivery-radio">
                                    <div class="w-3 h-3 bg-primary rounded-full hidden"></div>
                                </div>
                                <span class="text-sm">Eve teslim</span>
                            </label>
                        </div>
                    </div>
                    <div id="city-selection" class="hidden">
                        <label for="city" class="block text-sm font-medium text-gray-700 mb-1">Şehir</label>
                        <div class="relative">
                            <i class="ri-map-pin-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <select id="city" class="w-full pl-10 pr-10 py-2.5 border border-gray-300 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm focus:ring-1 focus:ring-primary">
                                <option value="" disabled>Şehir seçin</option>
                                <option value="lefkosa">Lefkoşa</option>
                                <option value="girne">Girne</option>
                                <option value="magusa">Gazimağusa</option>
                                <option value="guzelyurt">Güzelyurt</option>
                                <option value="iskele">İskele</option>
                            </select>
                            <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                        </div>
                    </div>
                    <button type="submit" id="form-calculate-btn" class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors cursor-pointer !rounded-button">
                        Hesaplamayı Güncelle
                    </button>
                </form>
                <div id="calculation-result" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <h4 class="font-medium text-gray-800 mb-2">Güncel Hesaplama Sonucu</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between"><span>Ürün Fiyatı:</span><span id="result-price">0 ₺</span></div>
                        <div class="flex justify-between"><span>Kategori Ücreti:</span><span id="result-category-fee">0 ₺</span></div>
                        <div class="flex justify-between" id="result-city-row"><span>Teslimat Ücreti:</span><span id="result-delivery-fee">0 ₺</span></div>
                        <div class="flex justify-between font-medium text-primary pt-2 border-t border-gray-200"><span>Toplam:</span><span id="result-total">0 ₺</span></div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 border-b pb-2">Teslimat Bilgileri</h2>
                <form id="delivery-form" class="space-y-4">
                    <div>
                        <label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">Adınız Soyadınız</label>
                        <input type="text" id="full-name" name="full-name" required class="w-full p-3 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Adınız Soyadınız">
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefon Numaranız</label>
                        <input type="tel" id="phone" name="phone" required class="w-full p-3 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="05XX XXX XX XX">
                    </div>
                    <div>
                        <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Teslimat Adresi (Kıbrıs)</label>
                        <textarea id="address" name="address" rows="3" required class="w-full p-3 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Açık adresinizi giriniz..."></textarea>
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Notu (İsteğe Bağlı)</label>
                        <textarea id="notes" name="notes" rows="2" class="w-full p-3 border border-gray-300 rounded-button focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Eklemek istediğiniz notlar..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-secondary text-primary py-3 mt-6 rounded-button font-semibold hover:bg-yellow-400 transition-colors !rounded-button">
                        Siparişi Onayla ve Ödemeye Geç
                    </button>
                </form>
            </div>
        </main>

        <footer class="text-center text-xs text-gray-500 py-8 mt-8">
            &copy; <span id="current-year"></span> Getir Kıbrıs. Tüm hakları saklıdır.
        </footer>
    </div>
    
    <div id="toast" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-opacity duration-300 z-[100]">
        <span id="toast-message"></span>
    </div>

    <script id="utils-script-siparisver">
        // showToast fonksiyonu, index.html'deki utils-script ile aynı olabilir.
        // Eğer ayrı bir utils.js dosyanız yoksa buraya kopyalayabilirsiniz veya
        // global window.showToast olarak index.html'de tanımlandıysa direkt kullanabilirsiniz.
        // Şimdilik, netlik için buraya ekliyorum:
        window.showToast = function(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            if (!toast || !toastMessage) { console.error("Toast elemanları bulunamadı!"); return; }
            toastMessage.textContent = message;
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 3000);
        };
    </script>

    <script id="calculator-script-siparisver">
    document.addEventListener('DOMContentLoaded', function() {
        const calculatorForm = document.getElementById('calculator-form');
        const formCalculateBtnSiparis = document.getElementById('form-calculate-btn'); // Bu sayfadaki buton
        const citySelection = document.getElementById('city-selection');
        const deliveryRadios = document.querySelectorAll('input[name="delivery-type"]');
        const calculationResultDiv = document.getElementById('calculation-result');
        const resultCityRow = document.getElementById('result-city-row');

        // --- Sayfa yüklendiğinde sessionStorage'dan inputları doldur ---
        const calculatorInputsString = sessionStorage.getItem('calculatorInputs');
        if (calculatorInputsString) {
            const inputs = JSON.parse(calculatorInputsString);
            
            // Inputları doldur
            const orderMethodEl = document.getElementById('order-method');
            const productLinkEl = document.getElementById('product-link');
            const productPriceEl = document.getElementById('product-price');
            const productCategoryEl = document.getElementById('product-category');
            const cityEl = document.getElementById('city');

            if(orderMethodEl && inputs.orderMethod) orderMethodEl.value = inputs.orderMethod;
            if(productLinkEl) productLinkEl.value = inputs.productLink || '';
            if(productPriceEl) productPriceEl.value = inputs.productPrice || '';
            if(productCategoryEl) productCategoryEl.value = inputs.productCategory || '';
            
            let deliveryTypeSet = false;
            deliveryRadios.forEach(radio => {
                if (radio.value === inputs.deliveryType) {
                    radio.checked = true;
                    deliveryTypeSet = true;
                } else {
                    radio.checked = false;
                }
            });

            // Seçili radio butona göre UI güncelle (nokta ve şehir seçimi)
            const checkedDeliveryRadio = document.querySelector('input[name="delivery-type"]:checked');
            if (checkedDeliveryRadio) {
                const radioDiv = checkedDeliveryRadio.parentElement.querySelector('.delivery-radio div');
                if (radioDiv) radioDiv.classList.remove('hidden');
                citySelection.classList.toggle('hidden', checkedDeliveryRadio.value !== 'home');
                if (checkedDeliveryRadio.value === 'home' && inputs.city && cityEl) {
                    cityEl.value = inputs.city;
                }
            }
            
            // Formu doldurduktan sonra otomatik olarak "Hesaplamayı Güncelle" butonuna tıkla
            // Bu, sayfa ilk yüklendiğinde sonuçların görünmesini sağlar.
            if (formCalculateBtnSiparis && inputs.productPrice && inputs.productCategory) { // Gerekli alanlar doluysa
                 setTimeout(() => { // DOM güncellemelerinin tamamlanması için kısa bir bekleme
                    formCalculateBtnSiparis.click();
                 }, 100);
            } else {
                if (calculationResultDiv) calculationResultDiv.classList.add('hidden');
            }

        } else {
            // Eğer sessionStorage'da veri yoksa, hesaplama sonuçlarını gizle
            if (calculationResultDiv) calculationResultDiv.classList.add('hidden');
            window.showToast && window.showToast("Hesaplama bilgisi bulunamadı. Lütfen bilgileri girip güncelleyin.");
        }
        
        // Radio buton UI güncelleme ve şehir gösterme/gizleme
        deliveryRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.delivery-radio div').forEach(dot => {
                    dot.classList.add('hidden');
                });
                if (this.checked) {
                    const radioDiv = this.parentElement.querySelector('.delivery-radio div');
                    if (radioDiv) radioDiv.classList.remove('hidden');
                }
                citySelection.classList.toggle('hidden', this.value !== 'home');
            });
        });

        // Form gönderildiğinde (Hesaplamayı Güncelle)
        if (calculatorForm && formCalculateBtnSiparis) {
            calculatorForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const orderMethod = document.getElementById('order-method').value;
                const productLink = document.getElementById('product-link').value;
                const price = parseFloat(document.getElementById('product-price').value) || 0;
                const category = document.getElementById('product-category').value;
                const deliveryType = document.querySelector('input[name="delivery-type"]:checked').value;
                const cityVal = document.getElementById('city').value;

                if (!orderMethod) { window.showToast('Lütfen sipariş yöntemi seçin'); return; }
                if (price <= 0) { window.showToast('Lütfen geçerli bir fiyat girin'); return; }
                if (!category) { window.showToast('Lütfen bir kategori seçin'); return; }
                if (deliveryType === 'home' && !cityVal) { window.showToast('Lütfen bir şehir seçin'); return; }

                const categoryRates = { 'furniture': 0.70, 'electronics': 0.70, 'clothing': 0.45, 'cosmetics': 0.70, 'stationery': 0.40 };
                const cityFees = { 'lefkosa': 200, 'girne': 350, 'magusa': 300, 'guzelyurt': 400, 'iskele': 450 };
                const categoryFee = price * (categoryRates[category] || 0);
                let deliveryFee = 0;
                if (deliveryType === 'home') { deliveryFee = cityFees[cityVal] || 0; }
                const total = price + categoryFee + deliveryFee;

                document.getElementById('result-price').textContent = `${price.toFixed(2)} ₺`;
                document.getElementById('result-category-fee').textContent = `${categoryFee.toFixed(2)} ₺`;
                document.getElementById('result-delivery-fee').textContent = `${deliveryFee.toFixed(2)} ₺`;
                document.getElementById('result-total').textContent = `${total.toFixed(2)} ₺`;
                
                resultCityRow.classList.toggle('hidden', deliveryType !== 'home');
                calculationResultDiv.classList.remove('hidden');
                window.showToast('Hesaplama güncellendi!');

                const updatedCalculatedData = {
                    orderMethod, productLink, price, category, deliveryType, 
                    city: deliveryType === 'home' ? cityVal : null,
                    categoryFee, deliveryFee, total
                };
                sessionStorage.setItem('calculatedOrderData', JSON.stringify(updatedCalculatedData));
                
                const updatedFormData = { // Inputları da güncelle
                    orderMethod: orderMethod, productLink: productLink, productPrice: document.getElementById('product-price').value,
                    productCategory: category, deliveryType: deliveryType, city: cityVal
                };
                sessionStorage.setItem('calculatorInputs', JSON.stringify(updatedFormData));
            });
        }

        // Teslimat formu gönderimi
        const deliveryForm = document.getElementById('delivery-form');
        if(deliveryForm) {
            deliveryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const currentCalculatedDataString = sessionStorage.getItem('calculatedOrderData');
                if (!currentCalculatedDataString) {
                    window.showToast("Lütfen önce ürün maliyetini hesaplayın/güncelleyin.");
                    document.getElementById('calculator-section')?.scrollIntoView({behavior: 'smooth'});
                    return;
                }
                const formData = new FormData(this);
                const deliveryDetails = Object.fromEntries(formData.entries());
                const finalOrderData = {
                    calculation: JSON.parse(currentCalculatedDataString),
                    delivery: deliveryDetails
                };
                console.log('Nihai Sipariş Bilgileri:', finalOrderData);
                alert('Siparişiniz alındı (simülasyon). Detaylar için konsolu kontrol edin.');
                // Başarılı sipariş sonrası:
                // sessionStorage.removeItem('calculatedOrderData');
                // sessionStorage.removeItem('calculatorInputs');
                // window.location.href = 'tesekkurler.html'; // Teşekkürler sayfasına yönlendir
            });
        }
        document.getElementById('current-year').textContent = new Date().getFullYear();
    });
    </script>
</body>
</html>

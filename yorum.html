<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Müşteri Yorumları ve Puanları | Getir Kıbrıs</title>
    <meta name="description" content="Getir Kıbrıs kullanıcılarının Trendyol ve Hepsiburada siparişleri hakkındaki yorumlarını okuyun ve siz de deneyiminizi paylaşın.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">

    <meta name="google-signin-client_id" content="**GOOGLE_CLIENT_ID_BURAYA**.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <script>
        // Tailwind CSS Konfigürasyonu (index.html'den kopyalandı)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5d3ebc',
                        secondary: '#ffd300'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    borderRadius: {
                        'button': '8px',
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9f9f9; 
        }
        /* Yorum yıldızlarının rengini değiştiren özel CSS */
        .stars input[type="radio"]:checked ~ label::before {
            color: #ffd300; /* secondary rengi */
        }
        .stars label:hover,
        .stars label:hover ~ label {
            color: #ffd300; /* secondary rengi */
        }
        .stars label {
            /* Remixicon kullanımı için */
            font-family: 'RemixIcon' !important;
            font-style: normal;
            font-size: 24px;
            color: #ddd;
            transition: color 0.2s;
            cursor: pointer;
        }
        .stars label::before {
             /* ri-star-fill unicode */
            content: "\e8a1"; 
        }
        .stars input[type="radio"] {
            display: none;
        }
        .stars {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
    </style>
</head>
<body class="bg-gray-50">

<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center">
        <div class="flex-1">
        </div>
        <div class="flex flex-col items-center">
            <img src="logom.png" alt="Getir Kıbrıs" class="h-12"> 
            <a href="index.html" class="text-sm font-medium text-primary mt-1">Ana Sayfa</a>
        </div>
        <div class="flex-1 flex justify-end">
            <div id="auth-button" class="w-8 h-8 flex items-center justify-center">
                <button id="login-btn" class="text-xs text-primary font-medium cursor-pointer">
                    <i class="ri-google-fill ri-lg"></i>
                </button>
                <div id="profile-container" class="hidden">
                    <img id="profile-img" src="" alt="Profil" class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </div>
        </div>
    </header>

    <main class="pt-20 p-4">
        <section id="reviews-section" class="bg-white rounded-lg shadow-lg mx-auto p-6 mb-8 max-w-2xl">
            <h1 class="text-3xl font-extrabold text-gray-800 mb-6 text-center border-b-4 border-primary pb-3 tracking-tight">
                ⭐ Müşteri Yorumları ve Puanları
            </h1>
            <p class="text-center text-gray-600 mb-6">Hizmetimizden memnun kaldınız mı? Lütfen deneyiminizi paylaşın!</p>

            <div id="comment-form-container" class="border border-gray-200 p-4 rounded-lg mb-6" style="display:none;">
                <h3 class="text-xl font-semibold mb-3 text-primary">Yorumunuzu Ekleyin</h3>
                <form id="comment-form" class="space-y-3">
                    <div class="flex items-center gap-2">
                        <label class="text-sm font-medium text-gray-700">Puanınız:</label>
                        <div class="stars">
                            <input type="radio" id="star5" name="rating" value="5" required><label for="star5" title="5 Puan"></label>
                            <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4 Puan"></label>
                            <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3 Puan"></label>
                            <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2 Puan"></label>
                            <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1 Puan"></label>
                        </div>
                    </div>
                    
                    <textarea id="comment-text" placeholder="Hizmetimiz hakkındaki görüşlerinizi yazın..." rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm" required></textarea>
                    
                    <button type="submit" class="w-full bg-secondary text-primary py-3 rounded-button font-semibold hover:bg-secondary/90 transition-colors cursor-pointer flex items-center justify-center gap-2">
                        <i class="ri-send-plane-line"></i>
                        <span>Yorumu Gönder</span>
                    </button>
                    <p id="comment-status" class="text-sm text-center mt-2 text-green-600 hidden"></p>
                </form>
            </div>

            <div id="login-to-comment" class="flex flex-col items-center justify-center p-6 bg-primary/5 rounded-lg border border-primary/10">
                <p class="text-gray-700 mb-3 font-medium">Yorum Yapmak ve Puan Vermek İçin Lütfen Giriş Yapın:</p>
                <div id="google-login-button" class="g-signin2" data-onsuccess="onSignIn" data-width="240" data-height="40" data-longtitle="true" data-theme="dark"></div>
            </div>

            <div id="approved-comments-list" class="space-y-4 mt-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">Kullanıcı Deneyimleri</h3>
                
                <div class="comment-card bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-2">
                        <p class="font-semibold text-primary">Ayşe T. (Örnek)</p>
                        <div class="star-rating text-secondary text-lg">
                            <i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-half-line"></i>
                        </div>
                    </div>
                    <p class="text-sm text-gray-700">Trendyol'dan aldığım ayakkabılar 5 günde elime ulaştı. Süreç çok hızlı ve bilgilendirme harikaydı. Kesinlikle tavsiye ederim!</p>
                    <p class="text-xs text-gray-500 mt-2 text-right">01.01.2024</p>
                </div>
                <div class="comment-card bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-2">
                        <p class="font-semibold text-primary">Mehmet K. (Örnek)</p>
                        <div class="star-rating text-secondary text-lg">
                            <i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i>
                        </div>
                    </div>
                    <p class="text-sm text-gray-700">Büyük bir mobilya ürünü sipariş ettim, kargo ve gümrük işlemleriyle hiç uğraşmadım. Getir Kıbrıs ekibine teşekkürler.</p>
                    <p class="text-xs text-gray-500 mt-2 text-right">15.12.2023</p>
                </div>
                
            </div>

        </section>
    </main>
</div>

<script>
    let currentUser = null;

    // 1. Google Girişi Başarılı Olunca Çalışacak Fonksiyon
    function onSignIn(googleUser) {
        const profile = googleUser.getBasicProfile();
        const id_token = googleUser.getAuthResponse().id_token; 

        currentUser = {
            id: profile.getId(), 
            name: profile.getName(),
            email: profile.getEmail(),
            imageUrl: profile.getImageUrl(),
            token: id_token
        };

        // Header'daki profil alanını güncelle
        const profileImg = document.getElementById('profile-img');
        const profileContainer = document.getElementById('profile-container');
        const loginBtn = document.getElementById('login-btn');

        profileImg.src = currentUser.imageUrl;
        profileImg.alt = currentUser.name;
        profileContainer.classList.remove('hidden');
        loginBtn.classList.add('hidden');
        
        // Yorum formunu göster ve giriş butonunu gizle
        document.getElementById('login-to-comment').style.display = 'none';
        document.getElementById('comment-form-container').style.display = 'block';

        console.log("Kullanıcı Giriş Yaptı:", currentUser.name);
    }

    // 2. Yorum Formu Gönderildiğinde Çalışacak Fonksiyon
    document.getElementById('comment-form').addEventListener('submit', function(e) {
        e.preventDefault();

        if (!currentUser) {
            alert("Yorum yapabilmek için lütfen önce Google ile giriş yapın.");
            return;
        }

        const ratingElement = document.querySelector('input[name="rating"]:checked');
        const commentText = document.getElementById('comment-text').value.trim();
        const commentStatus = document.getElementById('comment-status');

        if (!ratingElement || !commentText) {
            alert("Lütfen puanınızı seçin ve yorumunuzu yazın.");
            return;
        }
        
        const commentData = {
            user_id: currentUser.id,
            user_name: currentUser.name,
            rating: ratingElement.value,
            comment: commentText,
            is_approved: false, 
        };
        
        commentStatus.textContent = "Yorumunuz gönderiliyor...";
        commentStatus.classList.remove('hidden', 'text-green-600', 'text-red-600');
        commentStatus.classList.add('text-gray-600');
        
        // Gerçek bir sunucu isteği ve backend simülasyonu
        // BURADA SİZİN KENDİ /api/submit-comment ENDPOINTİNİZ OLMALIDIR!
        
        // **Simülasyon (Backend yoksa bu çalışır):**
        setTimeout(() => {
            commentStatus.textContent = "Yorumunuz başarıyla gönderildi ve yönetici onayını bekliyor. Teşekkür ederiz! 🎉";
            commentStatus.classList.remove('text-gray-600');
            commentStatus.classList.add('text-green-600');
            commentStatus.classList.remove('hidden');
            document.getElementById('comment-form').reset();
            // Puanlamayı sıfırla
            document.querySelectorAll('.stars input[type="radio"]').forEach(radio => radio.checked = false);
        }, 1500);
    });
    
    // Google Sign-Out Fonksiyonu
    document.getElementById('profile-img').addEventListener('click', function() {
        if (confirm("Çıkış yapmak istediğinizden emin misiniz?")) {
            // gapi yüklendi mi kontrolü
            if (typeof gapi !== 'undefined' && gapi.auth2) {
                const auth2 = gapi.auth2.getAuthInstance();
                auth2.signOut().then(function () {
                    console.log('Kullanıcı Google Hesabından Çıkış Yaptı.');
                    currentUser = null;
                    document.getElementById('profile-container').classList.add('hidden');
                    document.getElementById('login-btn').classList.remove('hidden');
                    document.getElementById('login-to-comment').style.display = 'flex';
                    document.getElementById('comment-form-container').style.display = 'none';
                });
            } else {
                 // Gapi yüklenmediyse bile görünümü elle sıfırla
                currentUser = null;
                document.getElementById('profile-container').classList.add('hidden');
                document.getElementById('login-btn').classList.remove('hidden');
                document.getElementById('login-to-comment').style.display = 'flex';
                document.getElementById('comment-form-container').style.display = 'none';
            }
        }
    });

</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Siparişlerim - Getir Kıbrıs</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --primary: #0094da;
      --accent: #ffcb05;
      --dark: #232323;
      --light-bg: #f7fafc;
      --white: #fff;
      --gray: #ececec;
      --radius: 16px;
      --shadow: 0 4px 24px rgba(0,0,0,0.07);
    }
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      background: var(--light-bg);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container {
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      padding: 24px 10px 0 10px;
      box-sizing: border-box;
      flex: 1;
    }
    .header-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 12px 16px 0 16px;
      gap: 16px;
    }
    .profile-img {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary);
      background: var(--gray);
    }
    .btn {
      padding: 8px 18px;
      border-radius: var(--radius);
      border: none;
      font-weight: 600;
      background: var(--primary);
      color: var(--white);
      font-size: 1rem;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: background .15s;
    }
    .btn:hover { background: #007dc1; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }

    .logo-wrap {
      display: flex;
      justify-content: center;
      margin-top: 0;
      margin-bottom: 12px;
    }
    .logo {
      max-width: 90px;
      width: 18vw;
      min-width: 56px;
      height: auto;
      display: block;
    }

    .nav-btn-row {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 24px 0 12px 0;
      flex-wrap: wrap;
    }
    .nav-btn {
      font-size: 1rem;
      font-weight: 600;
      border: none;
      border-radius: var(--radius);
      background: var(--accent);
      color: var(--dark);
      padding: 13px 28px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background .17s;
      min-width: 128px;
    }
    .nav-btn:hover { background: #ffe780; }
    .nav-btn:disabled { opacity: .5; cursor: not-allowed; }

    .orders-list {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .order-card {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 18px 12px 18px;
      display: flex;
      flex-direction: column;
      gap: 7px;
      font-size: 1.03rem;
      position: relative;
    }
    .order-label {
      font-weight: 600;
      color: var(--primary);
      margin-right: 5px;
    }
    .order-link {
      color: #257ad7;
      text-decoration: underline;
      word-break: break-all;
    }
    .order-price {
      font-weight: 700;
      color: #24a85c;
      margin-top: 4px;
    }
    .empty-info {
      text-align: center;
      color: #888;
      background: #f7fafc;
      border-radius: var(--radius);
      font-size: 1.08rem;
      padding: 26px 6px 14px 6px;
      box-shadow: 0 2px 14px rgba(0,0,0,0.03);
      margin-top: 24px;
    }
    @media (max-width: 700px) {
      .nav-btn-row { gap: 7px; }
      .order-card { padding: 13px 5vw 11px 5vw; }
      .container { max-width: 99vw; }
      .logo { max-width: 60px; }
    }
    @media (max-width: 470px) {
      .header-bar { padding: 10px 4px 0 4px; }
      .logo-wrap { margin-bottom: 5px; }
      .nav-btn { font-size: .94rem; min-width: 0; padding: 9px 8px; }
      .order-card { padding: 8px 2vw 7px 2vw; }
    }
  </style>
</head>
<body>
  <div class="header-bar">
    <button id="loginBtn" class="btn" style="display:none;">Google ile Giriş Yap</button>
    <img id="profileImg" class="profile-img" alt="Profil" style="display:none;">
    <button id="logoutBtn" class="btn" style="display:none;background:#e74c3c;">Çıkış Yap</button>
  </div>
  <div class="logo-wrap">
    <img src="https://getirkibris.com/logo.png" alt="Getir Kıbrıs Logo" class="logo">
  </div>
  <div class="container">
    <div class="nav-btn-row">
      <button class="nav-btn" onclick="goPageOrWarn('index.html')">Ana Sayfa</button>
      <button class="nav-btn" onclick="goPageOrWarn('siparisver.html')">Sipariş Ver</button>
      <button class="nav-btn" onclick="goPageOrWarn('kargotakip.html')">Kargo Takip</button>
      <button class="nav-btn" onclick="goPageOrWarn('siparislerim.html')">Siparişlerim</button>
    </div>
    <div id="ordersList" class="orders-list"></div>
    <div id="emptyInfo" class="empty-info" style="display:none;">Siparişiniz bulunmamaktadır.</div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
      authDomain: "kibris-6b4f7.firebaseapp.com",
      projectId: "kibris-6b4f7",
      storageBucket: "kibris-6b4f7.firebasestorage.app",
      messagingSenderId: "141262926171",
      appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
      measurementId: "G-JL9P6BRZTD"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const profileImg = document.getElementById('profileImg');
    const ordersList = document.getElementById('ordersList');
    const emptyInfo = document.getElementById('emptyInfo');
    let user = null;

    auth.onAuthStateChanged(function(currentUser) {
      user = currentUser;
      updateAuthUI(currentUser);
      if (!user) {
        window.location.href = "index.html";
      } else {
        loadOrders();
      }
    });

    function updateAuthUI(currentUser) {
      if (currentUser) {
        loginBtn.style.display = 'none';
        profileImg.src = currentUser.photoURL || '';
        profileImg.style.display = '';
        logoutBtn.style.display = '';
      } else {
        loginBtn.style.display = '';
        profileImg.style.display = 'none';
        logoutBtn.style.display = 'none';
      }
    }

    loginBtn.onclick = function() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(e => alert('Giriş başarısız! ' + e.message));
    };

    logoutBtn.onclick = function() {
      auth.signOut().then(() => location.reload());
    };

    function goPageOrWarn(page) {
      if (user) {
        window.location.href = page;
      } else {
        alert("Lütfen giriş yapınız.");
      }
    }

    async function loadOrders() {
      ordersList.innerHTML = "";
      emptyInfo.style.display = 'none';
      try {
        const q = db.collection("siparisler")
                    .where("uid", "==", user.uid)
                    .orderBy("createdAt", "desc");
        const snap = await q.get();
        if (snap.empty) {
          emptyInfo.style.display = '';
          return;
        }
        snap.forEach(doc => {
          const s = doc.data();
          const card = document.createElement('div');
          card.className = 'order-card';
          card.innerHTML = `
            <div><span class="order-label">Ürün Linki:</span> <a href="${s.urunLinki}" target="_blank" class="order-link">${s.urunLinki}</a></div>
            <div><span class="order-label">Sipariş Kodu:</span> ${s.siparisKodu || '-'}</div>
            <div><span class="order-label">Kategori:</span> ${s.kategori || '-'}</div>
            <div><span class="order-label">Teslimat Tipi:</span> ${s.teslimatTipi || '-'}</div>
            ${s.teslimatTipi === "Eve Teslim" ? `<div><span class="order-label">Adres:</span> ${s.sehir || ''}${s.acikAdres ? ', ' + s.acikAdres : ''}</div>` : ''}
            <div class="order-price">Toplam Fiyat: ${s.toplamTutar || '-'} TL</div>
          `;
          ordersList.appendChild(card);
        });
      } catch (e) {
        console.error("Siparişler yüklenirken hata oluştu:", e);
        ordersList.innerHTML = '<div class="empty-info">Siparişler yüklenirken hata oluştu.</div>';
      }
    }
  </script>
</body>
</html>

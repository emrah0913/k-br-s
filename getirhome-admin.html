<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Getir Home Admin | Getir KÄ±brÄ±s</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css" rel="stylesheet">
<script>
    // Tailwind KonfigÃ¼rasyonu: Getir'in ana rengini (primary) tanÄ±mla
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    primary: '#5D3EBC', // Getir Moru
                    secondary: '#FFD300', // Getir SarÄ±sÄ±
                    'getir-yellow': '#FFD300',
                },
                fontFamily: {
                    inter: ['Inter', 'sans-serif'],
                },
            },
        }
    }
</script>
<style>
Â  .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
Â  .product-image-preview { transition: transform 0.2s; cursor: zoom-in; }
Â  .product-image-preview:hover { transform: scale(3.5); z-index: 1000; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
  /* Admin rengini CSS deÄŸiÅŸkeni olarak tanÄ±mla */
  :root {
      --color-primary: #5D3EBC;
  }
  .bg-primary { background-color: var(--color-primary); }
  .text-primary { color: var(--color-primary); }
</style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-white shadow p-4">
Â  <div class="max-w-6xl mx-auto flex items-center justify-between">
Â  Â  <h1 class="text-xl font-bold text-primary">Getir Home â€” YÃ¶netim</h1>
Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  <span id="admin-email" class="text-gray-600"></span>
Â  Â  Â  <button id="logoutBtn" class="text-sm text-red-600 hidden">Ã‡Ä±kÄ±ÅŸ Yap</button>
Â  Â  </div>
Â  Â  <a href="#" onclick="showMsg('Bu link mÃ¼ÅŸteriye aÃ§Ä±k Getir Home sayfasÄ±na yÃ¶nlendirecektir. HenÃ¼z bu link belirlenmedi.', false)" class="text-sm text-primary hover:text-primary/80 font-medium">Siteyi GÃ¶r</a>
Â  </div>
</header>

<main class="max-w-6xl mx-auto p-6">

<section id="login-screen" class="text-center py-12 hidden">
Â  <h2 class="text-2xl mb-4">Admin GiriÅŸi</h2>
Â  <button id="googleSignIn" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded flex items-center mx-auto gap-2 transition-colors"><i class="ri-google-fill"></i> Google ile GiriÅŸ Yap</button>
Â  <p class="mt-4 text-sm text-gray-500">LÃ¼tfen tanÄ±mlÄ± yÃ¶netici e-posta adresi ile giriÅŸ yapÄ±n.</p>
</section>

<section id="admin-panel" class="hidden card bg-white p-6">

Â  <div class="flex items-center justify-between mb-6">
Â  Â  <div>
Â  Â  Â  <h2 class="text-2xl font-semibold">YÃ¶netim Paneli</h2>
Â  Â  Â  <p class="text-sm text-gray-500">Banner, Kategori ve ÃœrÃ¼n yÃ¶netimi</p>
Â  Â  </div>
Â  Â  <div class="flex gap-2">
Â  Â  Â  <button id="tabBanner" class="px-4 py-2 rounded">Banner</button>
Â  Â  Â  <button id="tabCategory" class="px-4 py-2 bg-gray-100 rounded">Kategori</button>
Â  Â  Â  <button id="tabProduct" class="px-4 py-2 bg-gray-100 rounded">ÃœrÃ¼n</button>
Â  Â  </div>
Â  </div>

Â  <div id="sectionBanner">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ–¼ Banner YÃ¶netimi</h3>
    <!-- GÃœNCELLENMÄ°Åž BANNER EKLEME FORMU -->
Â  Â  <div id="banner-form-area" class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4 p-4 border rounded-lg bg-gray-50">
Â  Â  Â  <input id="bannerUrl" placeholder="GÃ¶rsel/Video URL (Zorunlu) - YouTube veya MP4/WebM Linki" class="border p-2 rounded col-span-3 focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="bannerTitle" placeholder="BaÅŸlÄ±k (Zorunlu)" class="border p-2 rounded col-span-1 focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="bannerDescription" placeholder="AÃ§Ä±klama" class="border p-2 rounded col-span-2 focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="bannerLink" placeholder="Link (Ã–rn: #/detail?id=...) (Opsiyonel)" class="border p-2 rounded col-span-2 focus:ring-primary focus:border-primary" />
Â  Â  Â  <div class="flex gap-2 col-span-1">
Â  Â  Â  Â  <button id="addBannerBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-1/2 transition-colors">Ekle</button>
Â  Â  Â  Â  <button id="refreshBannerBtn" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded w-1/2 transition-colors">Yenile</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="bannerList" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
Â  </div>

Â  <div id="sectionCategory" class="hidden">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ—‚ Kategori YÃ¶netimi</h3>
Â  Â  <div id="category-form-area" class="flex gap-3 mb-4">
Â  Â  Â  <input id="categoryName" placeholder="Kategori adÄ±" class="border p-2 rounded w-full focus:ring-primary focus:border-primary" />
Â  Â  Â  <select id="parentCategory" class="border p-2 rounded focus:ring-primary focus:border-primary">
Â  Â  Â  Â  <option value="">Ãœst Kategori Yok</option>
Â  Â  Â  </select>
Â  Â  Â  <button id="addCategoryBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors">Ekle</button>
Â  Â  </div>
Â  Â  <div id="categoryList" class="space-y-2"></div>
Â  Â  <button onclick="loadCategories()" class="mt-4 bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded transition-colors"><i class="ri-refresh-line"></i> Yenile</button>
Â  </div>

Â  <div id="sectionProduct" class="hidden">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ›’ ÃœrÃ¼n YÃ¶netimi</h3>

Â  Â  <div id="editingStatus" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-4 hidden" role="alert">
Â  Â  Â  Â  <p class="font-bold">DÃ¼zenleme Modu:</p>
Â  Â  Â  Â  <p id="editingProductName"></p>
Â  Â  Â  Â  <input type="hidden" id="editingProductId" />
Â  Â  </div>

Â  Â  <!-- GELÄ°ÅžMÄ°Åž ÃœRÃœN FORM ALANI (md:grid-cols-4) -->
Â  Â  <div id="product-form-area" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 p-4 border rounded-lg bg-gray-50">
Â  Â  Â  <!-- TEMEL ALANLAR -->
Â  Â  Â  <input id="productName" placeholder="ÃœrÃ¼n adÄ± (Zorunlu)" class="border p-2 rounded col-span-2 focus:ring-primary focus:border-primary" />
Â  Â  Â  <select id="productCategorySelect" class="border p-2 rounded focus:ring-primary focus:border-primary col-span-2">
Â  Â  Â  Â  <option value="">Kategori seÃ§ (Zorunlu)</option>
Â  Â  Â  </select>
Â  Â  Â  <input id="productDescription" placeholder="ÃœrÃ¼n aÃ§Ä±klamasÄ±" class="border p-2 rounded md:col-span-4 focus:ring-primary focus:border-primary" />
Â  Â  Â  
      <!-- Fiyat AlanlarÄ± -->
Â  Â  Â  <input id="productPrice" placeholder="Ana Fiyat (â‚º) (Zorunlu)" class="border p-2 rounded focus:ring-primary focus:border-primary col-span-2" type="number" step="0.01"/>
Â  Â  Â  <input id="productOldPrice" placeholder="Eski/Liste FiyatÄ± (â‚º) (Opsiyonel)" class="border p-2 rounded focus:ring-primary focus:border-primary col-span-2" type="number" step="0.01"/>
      
      <!-- Ana Medya AlanlarÄ± -->
Â  Â  Â  <input id="productImage" placeholder="Ana gÃ¶rsel URL (Zorunlu) (PNG/WEBP Ã–nerilir)" class="border p-2 rounded focus:ring-primary focus:border-primary col-span-2" />
      <input id="productVideo" placeholder="Video URL (YouTube/MP4 - Opsiyonel)" class="border p-2 rounded focus:ring-primary focus:border-primary col-span-2" /> 

Â  Â  Â  <!-- Ek GÃ¶rsel YÃ¶netimi AlanÄ± -->
      <div class="md:col-span-4 p-3 mt-4 border rounded-lg bg-white">
          <h4 class="font-semibold mb-3 text-gray-700">Ek GÃ¶rsel URL'leri</h4>
          <div id="extraImagesContainer" class="space-y-2">
              <!-- Dinamik olarak buraya eklenecek -->
          </div>
          <button id="addExtraImageBtn" type="button" class="mt-3 bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm transition-colors flex items-center gap-1">
              <i class="ri-image-add-line"></i> Yeni GÃ¶rsel AlanÄ± Ekle
          </button>
      </div>

Â  Â  Â  <!-- YENÄ°: VARYANT YÃ–NETÄ°MÄ° (GÃ¶rsel/Video Eklendi) -->
Â  Â  Â  <div class="md:col-span-4 p-3 mt-4 border rounded-lg bg-white">
Â  Â  Â  Â  Â  <h4 class="font-semibold mb-3 text-gray-700">Varyant YÃ¶netimi (GeliÅŸmiÅŸ Medya DesteÄŸi)</h4>
          
          <!-- Varyant Temel GiriÅŸ AlanÄ± -->
Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-6 gap-2 mb-3 items-end border-b pb-3">
              <input id="variantName" placeholder="Varyant AdÄ± (Zorunlu)" class="border p-2 rounded col-span-3 focus:ring-getir-yellow focus:border-getir-yellow" />
              <input id="variantPriceOffset" placeholder="Fiyat FarkÄ± (â‚º)" class="border p-2 rounded col-span-3 focus:ring-getir-yellow focus:border-getir-yellow" type="number" step="0.01" value="0"/>
          </div>

          <!-- Dinamik Medya AlanlarÄ± (YENÄ°) -->
          <div class="grid grid-cols-1 md:grid-cols-6 gap-2 mt-4">
              <!-- Ek GÃ¶rsel YÃ¶netimi (Varyant) -->
              <div class="col-span-3 p-2 border rounded bg-gray-50">
                  <h5 class="text-sm font-semibold mb-2 flex items-center gap-1"><i class="ri-image-line"></i> Varyant Ek GÃ¶rselleri</h5>
                  <div id="variantImagesContainer" class="space-y-1">
                      <!-- Dinamik GÃ¶rsel InputlarÄ± Buraya Gelecek -->
                  </div>
                  <button id="addVariantImageBtn" type="button" class="mt-2 text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded flex items-center gap-1 w-full justify-center">
                      <i class="ri-image-add-line"></i> GÃ¶rsel URL Ekle
                  </button>
              </div>

              <!-- Ek Video YÃ¶netimi (Varyant) -->
              <div class="col-span-3 p-2 border rounded bg-gray-50">
                  <h5 class="text-sm font-semibold mb-2 flex items-center gap-1"><i class="ri-video-line"></i> Varyant Ek VideolarÄ±</h5>
                  <div id="variantVideosContainer" class="space-y-1">
                      <!-- Dinamik Video InputlarÄ± Buraya Gelecek -->
                  </div>
                  <button id="addVariantVideoBtn" type="button" class="mt-2 text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 px-2 py-1 rounded flex items-center gap-1 w-full justify-center">
                      <i class="ri-video-add-line"></i> Video URL Ekle
                  </button>
              </div>
          </div>
          
          <div class="col-span-6 flex justify-end mt-4 border-t pt-3">
              <button id="addVariantBtn" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded flex items-center gap-1 transition-colors w-full md:w-auto"><i class="ri-add-line"></i> VaryantÄ± Listeye Ekle</button>
          </div>

          <!-- Eklenen Varyant Listesi -->
Â  Â  Â  Â  Â  <div id="variantList" class="space-y-2 mt-4">
Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500" id="no-variants-msg">HenÃ¼z varyant eklenmedi.</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <!-- AKTÄ°F CHECKBOX -->
Â  Â  Â  <div class="flex items-center gap-2 mt-4 md:col-span-4">
Â  Â  Â  Â  Â  Â  <input id="productActive" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" />Â 
Â  Â  Â  Â  Â  Â  <label for="productActive" class="text-sm font-medium text-gray-700">ÃœrÃ¼nÃ¼ aktif olarak gÃ¶ster</label>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="flex gap-2 mb-6">
Â  Â  Â  <button id="addProductBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"><i class="ri-add-line"></i> ÃœrÃ¼n Ekle</button>
Â  Â  Â  <button id="updateProductBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded hidden transition-colors"><i class="ri-save-line"></i> Kaydet ve GÃ¼ncelle</button>
Â  Â  Â  <button id="cancelEditBtn" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded hidden transition-colors"><i class="ri-close-line"></i> Ä°ptal</button>
Â  Â  Â  <button id="refreshProductsBtn" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded transition-colors"><i class="ri-refresh-line"></i> Yenile</button>
Â  Â  </div>

Â  Â  <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
Â  </div>

</section>

<div id="msg" class="mt-4 text-sm text-red-600"></div>
</main>

<footer class="text-center text-gray-400 py-8">
Â© 2025 Getir KÄ±brÄ±s
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

// Firestore iÃ§in DEBUG seviyesini aÃ§
setLogLevel('debug');

const firebaseConfig = {
Â  apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
Â  authDomain: "kibris-6b4f7.firebaseapp.com",
Â  projectId: "kibris-6b4f7",
Â  storageBucket: "kibris-6b4f7.appspot.com",
Â  messagingSenderId: "141262926171",
Â  appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
Â  measurementId: "G-JL9P6BRZTD"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// !!! KRÄ°TÄ°K: BURAYI KENDÄ° ADMÄ°N EMAIL'Ä°NÄ°ZLE DEÄžÄ°ÅžTÄ°RMEYÄ°N!
const ADMIN_EMAIL = "emirmob09@gmail.com";Â 

// --- DOM Elementleri ---
const loginScreen = document.getElementById("login-screen");
const googleSignIn = document.getElementById("googleSignIn");
const adminPanel = document.getElementById("admin-panel");
const adminEmailSpan = document.getElementById("admin-email");
const logoutBtn = document.getElementById("logoutBtn");
const msg = document.getElementById("msg");

// Panel TablarÄ± ve BÃ¶lÃ¼mleri
const tabBanner = document.getElementById("tabBanner");
const tabCategory = document.getElementById("tabCategory");
const tabProduct = document.getElementById("tabProduct");
const sectionBanner = document.getElementById("sectionBanner");
const sectionCategory = document.getElementById("sectionCategory");
const sectionProduct = document.getElementById("sectionProduct");

// Banner
const bannerUrl = document.getElementById("bannerUrl");
const bannerTitle = document.getElementById("bannerTitle");
const bannerDescription = document.getElementById("bannerDescription");
const bannerLink = document.getElementById("bannerLink");

const addBannerBtn = document.getElementById("addBannerBtn");
const bannerList = document.getElementById("bannerList");
const refreshBannerBtn = document.getElementById("refreshBannerBtn");

// Kategori
const categoryName = document.getElementById("categoryName");
const parentCategory = document.getElementById("parentCategory");
const addCategoryBtn = document.getElementById("addCategoryBtn");
const categoryList = document.getElementById("categoryList");

// ÃœrÃ¼n
const productName = document.getElementById("productName");
const productPrice = document.getElementById("productPrice");
const productOldPrice = document.getElementById("productOldPrice");

const productCategorySelect = document.getElementById("productCategorySelect");
const productImage = document.getElementById("productImage");
const productVideo = document.getElementById("productVideo");
const extraImagesContainer = document.getElementById("extraImagesContainer");
const addExtraImageBtn = document.getElementById("addExtraImageBtn");

const productDescription = document.getElementById("productDescription");
const productActive = document.getElementById("productActive");

// Varyant (GÃœNCELLENDÄ°: Yeni dinamik medya alanlarÄ±)
const variantName = document.getElementById("variantName");
const variantPriceOffset = document.getElementById("variantPriceOffset");
const variantImagesContainer = document.getElementById("variantImagesContainer");
const variantVideosContainer = document.getElementById("variantVideosContainer");
const addVariantImageBtn = document.getElementById("addVariantImageBtn");
const addVariantVideoBtn = document.getElementById("addVariantVideoBtn");
const addVariantBtn = document.getElementById("addVariantBtn");
const variantList = document.getElementById("variantList");
const noVariantsMsg = document.getElementById("no-variants-msg");

const addProductBtn = document.getElementById("addProductBtn");
const updateProductBtn = document.getElementById("updateProductBtn");
const cancelEditBtn = document.getElementById("cancelEditBtn");
const productList = document.getElementById("productList");
const refreshProductsBtn = document.getElementById("refreshProductsBtn");
const editingStatus = document.getElementById("editingStatus");
const editingProductName = document.getElementById("editingProductName");
const editingProductId = document.getElementById("editingProductId");

let currentProducts = [];
let productVariants = []; 

// BaÅŸlangÄ±Ã§ta Banner sekmesini aktif yap
tabBanner.classList.add("bg-[--color-primary]", "text-white"); 

// --- YARDIMCI VE UI MANTIÄžI ---
function showMsg(text, isError=true){Â 
Â  Â  msg.textContent=text;Â 
Â  Â  msg.style.color=isError?"#b91c1c":"#065f46";Â 
Â  Â  if(text) setTimeout(()=>{msg.textContent="";},5000);
}

// --- ANA ÃœRÃœN EK GÃ–RSEL YÃ–NETÄ°MÄ° ---

function updateExtraImageIndices() {
    const inputs = extraImagesContainer.querySelectorAll('.extra-image-url');
    inputs.forEach((input, index) => {
        const indexDisplay = index + 1;
        input.closest('.flex').querySelector('span').textContent = `${indexDisplay}. Resim:`;
        input.placeholder = `Ek GÃ¶rsel URL ${indexDisplay}`;
    });
}

function addExtraImageInput(initialValue = '') {
    const currentCount = extraImagesContainer.children.length;

    const index = currentCount + 1;
    const inputWrapper = document.createElement('div');
    inputWrapper.className = 'flex gap-2 items-center';
    inputWrapper.innerHTML = `
        <span class="text-sm font-medium text-gray-600 w-16 flex-shrink-0">${index}. Resim:</span>
        <input type="url" 
               class="extra-image-url border p-2 rounded w-full focus:ring-primary focus:border-primary text-sm" 
               placeholder="Ek GÃ¶rsel URL ${index}" 
               value="${initialValue}" />
        <button type="button" class="remove-extra-image-btn text-red-600 hover:text-red-700 p-1 rounded transition-colors flex-shrink-0" title="Sil">
            <i class="ri-delete-bin-line"></i>
        </button>
    `;

    extraImagesContainer.appendChild(inputWrapper);

    inputWrapper.querySelector('.remove-extra-image-btn').addEventListener('click', () => {
        inputWrapper.remove();
        updateExtraImageIndices();
    });
    
    updateExtraImageIndices();
}

function collectExtraImages() {
    const inputs = extraImagesContainer.querySelectorAll('.extra-image-url');
    const urls = [];
    inputs.forEach(input => {
        const url = input.value.trim();
        if (url) {
            urls.push(url);
        }
    });
    return urls;
}

addExtraImageBtn.addEventListener('click', () => addExtraImageInput());
// --- ANA ÃœRÃœN EK GÃ–RSEL YÃ–NETÄ°MÄ° BÄ°TÄ°Åž ---

// --- VARYANT MEDYA YÃ–NETÄ°MÄ° BAÅžLANGIÃ‡ ---

/**
 * Dinamik olarak bir varyant medya URL input alanÄ± ekler.
 */
function addVariantMediaInput(container, type, initialValue = '') {
    const inputWrapper = document.createElement('div');
    inputWrapper.className = 'flex gap-2 items-center';
    
    const placeholderText = type === 'image' ? 'GÃ¶rsel URL (PNG/WEBP)' : 'Video URL (YouTube/MP4)';
    const iconClass = type === 'image' ? 'ri-image-line' : 'ri-video-line';

    inputWrapper.innerHTML = `
        <i class="${iconClass} text-gray-500 text-sm"></i>
        <input type="url" 
               class="variant-media-url border p-1 rounded w-full focus:ring-getir-yellow focus:border-getir-yellow text-xs" 
               placeholder="${placeholderText}" 
               data-type="${type}"
               value="${initialValue}" />
        <button type="button" class="remove-variant-media-btn text-red-600 hover:text-red-700 p-1 rounded transition-colors flex-shrink-0" title="Sil">
            <i class="ri-delete-bin-line text-sm"></i>
        </button>
    `;

    container.appendChild(inputWrapper);

    inputWrapper.querySelector('.remove-variant-media-btn').addEventListener('click', () => {
        inputWrapper.remove();
    });
}

/**
 * Belirtilen tipten (image veya video) tÃ¼m varyant medya URL'lerini toplar.
 */
function collectVariantMedia(container) {
    const inputs = container.querySelectorAll('.variant-media-url');
    const urls = [];
    inputs.forEach(input => {
        const url = input.value.trim();
        if (url) {
            urls.push(url);
        }
    });
    return urls;
}

// Event Listeners for adding variant media inputs
addVariantImageBtn.addEventListener('click', () => addVariantMediaInput(variantImagesContainer, 'image'));
addVariantVideoBtn.addEventListener('click', () => addVariantMediaInput(variantVideosContainer, 'video'));

// --- VARYANT MEDYA YÃ–NETÄ°MÄ° BÄ°TÄ°Åž ---


// Yeni varyant listesini temizler ve render eder
function renderVariants() {
Â  Â  variantList.innerHTML = '';
Â  Â  if (productVariants.length === 0) {
Â  Â  Â  Â  noVariantsMsg.classList.remove('hidden');
Â  Â  Â  Â  variantList.appendChild(noVariantsMsg);
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  noVariantsMsg.classList.add('hidden');

Â  Â  productVariants.forEach((variant, index) => {
Â  Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  Â  el.className = 'flex justify-between items-center p-2 rounded bg-gray-100 text-sm';
Â  Â  Â  Â  const priceText = variant.price_offset > 0Â 
Â  Â  Â  Â  Â  Â  ? `(Fark: +${variant.price_offset.toFixed(2)} â‚º)`Â 
Â  Â  Â  Â  Â  Â  : variant.price_offset < 0Â 
Â  Â  Â  Â  Â  Â  ? `(Fark: ${variant.price_offset.toFixed(2)} â‚º)`
Â  Â  Â  Â  Â  Â  : '(Fark: 0 â‚º)';
        
        // YENÄ°: Varyant medya ikonlarÄ± (array uzunluÄŸunu kontrol et)
        const imageCount = Array.isArray(variant.extraImages) ? variant.extraImages.length : 0;
        const videoCount = Array.isArray(variant.extraVideos) ? variant.extraVideos.length : 0;

        const mediaIcons = `
            ${imageCount > 0 ? `<i class="ri-image-line text-green-500 ml-2" title="${imageCount} GÃ¶rsel Eklendi">(${imageCount})</i>` : ''}
            ${videoCount > 0 ? `<i class="ri-video-line text-blue-500 ml-1" title="${videoCount} Video Eklendi">(${videoCount})</i>` : ''}
        `;

Â  Â  Â  Â  el.innerHTML = `
Â  Â  Â  Â  Â  Â  <span>${variant.name} <span class="text-gray-500">${priceText}</span> ${mediaIcons}</span>
Â  Â  Â  Â  Â  Â  <button data-index="${index}" class="remove-variant-btn text-red-600 hover:text-red-700 transition-colors"><i class="ri-delete-bin-line"></i> Sil</button>
Â  Â  Â  Â  `;
Â  Â  Â  Â  variantList.appendChild(el);
Â  Â  });

Â  Â  document.querySelectorAll('.remove-variant-btn').forEach(btn => {
Â  Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  const indexToRemove = parseInt(e.currentTarget.dataset.index);
Â  Â  Â  Â  Â  Â  productVariants.splice(indexToRemove, 1);
Â  Â  Â  Â  Â  Â  renderVariants();
Â  Â  Â  Â  });
Â  Â  });
}

// Varyant Ekleme Butonu
addVariantBtn.addEventListener('click', () => {
Â  Â  const name = variantName.value.trim();
Â  Â  const priceOffset = parseFloat(variantPriceOffset.value);
    
    // YENÄ°: Dinamik olarak varyant medyalarÄ±nÄ± topla
    const extraImages = collectVariantMedia(variantImagesContainer);
    const extraVideos = collectVariantMedia(variantVideosContainer);

Â  Â  if (!name) {
Â  Â  Â  Â  showMsg("Varyant adÄ± boÅŸ olamaz.", true);
Â  Â  Â  Â  return;
Â  Â  }
Â  Â  if (isNaN(priceOffset)) {
Â  Â  Â  Â  showMsg("Fiyat farkÄ± geÃ§erli bir sayÄ± olmalÄ±dÄ±r.", true);
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // YENÄ°: VaryantÄ± medya dizileri ile kaydet
Â  Â  productVariants.push({ name, price_offset: priceOffset, extraImages, extraVideos });

Â  Â  variantName.value = '';
Â  Â  variantPriceOffset.value = '0';
    variantImagesContainer.innerHTML = ''; // Temizle
    variantVideosContainer.innerHTML = ''; // Temizle
Â  Â  renderVariants();
});


function resetProductForm(isEditing = false) {
Â  Â  productName.value = "";
Â  Â  productPrice.value = "";
    productOldPrice.value = ""; 
Â  Â  productCategorySelect.value = "";
Â  Â  productImage.value = "";
Â  Â  productVideo.value = "";
Â  Â  productDescription.value = "";
Â  Â  productActive.checked = false;
Â  Â  editingProductId.value = "";
Â  Â  editingProductName.textContent = "";
Â  Â  
    // Ek resim konteynerini temizle
    extraImagesContainer.innerHTML = '';

    // Varyant giriÅŸ alanlarÄ±nÄ± ve medyalarÄ±nÄ± temizle
    variantName.value = '';
    variantPriceOffset.value = '0';
    variantImagesContainer.innerHTML = ''; 
    variantVideosContainer.innerHTML = ''; 


Â  Â  productVariants = []; // Reset varyant listesi
Â  Â  renderVariants(); // UI'da sÄ±fÄ±rla

Â  Â  if (isEditing) {
Â  Â  Â  Â  addProductBtn.classList.add("hidden");
Â  Â  Â  Â  updateProductBtn.classList.remove("hidden");
Â  Â  Â  Â  cancelEditBtn.classList.remove("hidden");
Â  Â  Â  Â  editingStatus.classList.remove("hidden");
Â  Â  } else {
Â  Â  Â  Â  addProductBtn.classList.remove("hidden");
Â  Â  Â  Â  updateProductBtn.classList.add("hidden");
Â  Â  Â  Â  cancelEditBtn.classList.add("hidden");
Â  Â  Â  Â  editingStatus.classList.add("hidden");
Â  Â  }
}

function activateTab(target){
Â  [sectionBanner,sectionCategory,sectionProduct].forEach(s=>s.classList.add("hidden"));
Â  [tabBanner,tabCategory,tabProduct].forEach(t=>{
Â  Â  Â  t.classList.remove("bg-[--color-primary]","text-white");
Â  Â  Â  t.classList.add("bg-gray-100");
Â  });
Â  if(target==="banner"){
Â  Â  Â  sectionBanner.classList.remove("hidden");Â 
Â  Â  Â  tabBanner.classList.add("bg-[--color-primary]","text-white");
Â  Â  Â  tabBanner.classList.remove("bg-gray-100");
Â  Â  Â  loadBanners();
Â  }
Â  if(target==="category"){
Â  Â  Â  sectionCategory.classList.remove("hidden");Â 
Â  Â  Â  tabCategory.classList.add("bg-[--color-primary]","text-white");
Â  Â  Â  tabCategory.classList.remove("bg-gray-100");
Â  Â  Â  loadCategories();
Â  }
Â  if(target==="product"){
Â  Â  Â  sectionProduct.classList.remove("hidden");Â 
Â  Â  Â  tabProduct.classList.add("bg-[--color-primary]","text-white");
Â  Â  Â  tabProduct.classList.remove("bg-gray-100");
Â  Â  Â  resetProductForm(false);
Â  Â  Â  loadCategories(); // ÃœrÃ¼n formunu kategori ile doldur
Â  Â  Â  loadProducts();
Â  }
}

tabBanner.addEventListener("click",()=>activateTab("banner"));
tabCategory.addEventListener("click",()=>activateTab("category"));
tabProduct.addEventListener("click",()=>activateTab("product"));
cancelEditBtn.addEventListener("click",()=>resetProductForm(false));

// --- AUTH ---
onAuthStateChanged(auth, async (user)=>{
Â  try{
Â  Â  if(!user){Â 
Â  Â  Â  loginScreen.classList.remove("hidden");Â 
Â  Â  Â  adminPanel.classList.add("hidden");Â 
Â  Â  Â  logoutBtn.classList.add("hidden");Â 
Â  Â  Â  adminEmailSpan.textContent="";Â 
Â  Â  Â  return;Â 
Â  Â  }
Â  Â  if(user.email!==ADMIN_EMAIL){Â 
Â  Â  Â  showMsg("Bu panel sadece admin iÃ§in yetkilidir.", true);Â 
Â  Â  Â  await signOut(auth);Â 
Â  Â  Â  return;Â 
Â  Â  }
Â  Â  loginScreen.classList.add("hidden");Â 
Â  Â  adminPanel.classList.remove("hidden");Â 
Â  Â  logoutBtn.classList.remove("hidden");Â 
Â  Â  adminEmailSpan.textContent=user.email;

Â  Â  // BaÅŸlangÄ±Ã§ta sadece Banner sekmesini yÃ¼kle
Â  Â  activateTab("banner");Â 
Â  }catch(e){Â 
Â  Â  console.error(e);Â 
Â  Â  showMsg("Yetki hatasÄ±: "+e.message, true);
Â  }
});

googleSignIn.addEventListener("click",async()=>{Â 
Â  try{Â 
Â  Â  await signInWithPopup(auth,provider);
Â  }catch(e){
Â  Â  showMsg("GiriÅŸ hatasÄ±: "+e.message, true);
Â  }Â 
});
logoutBtn.addEventListener("click",async()=>{Â 
Â  await signOut(auth);Â 
Â  // Admin giriÅŸ ekranÄ±na yÃ¶nlendir
Â  loginScreen.classList.remove("hidden");Â 
Â  adminPanel.classList.add("hidden");Â 
Â  logoutBtn.classList.add("hidden");Â 
});

// --- BANNER CRUD ---
addBannerBtn.addEventListener("click", async ()=>{
Â  const url=bannerUrl.value.trim();
Â  const title = bannerTitle.value.trim();
Â  const description = bannerDescription.value.trim();
Â  const link = bannerLink.value.trim();

Â  if(!url || !url.startsWith('http')){ showMsg("GeÃ§erli bir gÃ¶rsel/video URL'si girin", true); return;}
Â  if(!title){ showMsg("BaÅŸlÄ±k alanÄ± boÅŸ olamaz.", true); return;}

Â  try{Â 
Â  Â  await addDoc(collection(db,"homeBanners"),{
        url,
        title,
        description,
        link: link || null, // BoÅŸsa null kaydet
        createdAt:new Date()
    });Â 
Â  Â  bannerUrl.value="";Â 
    bannerTitle.value="";
    bannerDescription.value="";
    bannerLink.value="";
Â  Â  await loadBanners();Â 
Â  Â  showMsg("Banner baÅŸarÄ±yla eklendi!", false);
Â  }catch(e){Â 
Â  Â  showMsg("Ekleme hatasÄ±: " + e.message, true);
Â  }
});
refreshBannerBtn.addEventListener("click",loadBanners);

async function loadBanners(){
Â  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  bannerList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> Bannerlar yÃ¼kleniyor...";
Â  try {
Â  Â  Â  const snap=await getDocs(collection(db,"homeBanners"));
Â  Â  Â  bannerList.innerHTML="";
Â  Â  Â  if(snap.empty){ bannerList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek banner bulunamadÄ±.</p>"; return; }
Â  Â  Â  snap.forEach(docSnap=>{
Â  Â  Â  Â  const d=docSnap.data();
Â  Â  Â  Â  const el=document.createElement("div");
Â  Â  Â  Â  el.className="flex flex-col justify-between bg-gray-100 p-3 rounded shadow-sm";
Â  Â  Â  Â  
        const urlDisplay = d.url ? d.url.substring(0, 50) + '...' : 'URL Yok';
        const linkDisplay = d.link ? `<a href="${d.link}" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 truncate">${d.link.substring(0, 40)}...</a>` : '<span class="text-xs text-gray-400">Link Yok</span>';

Â  Â  Â  Â  el.innerHTML=`
Â  Â  Â  Â  Â  <div class="flex items-start gap-3">
Â  Â  Â  Â  Â  Â  <img src="${d.url}" class="w-16 h-16 object-cover rounded product-image-preview flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/64x64/ccc/fff?text=?'"/>
Â  Â  Â  Â  Â  Â  <div class="flex-grow min-w-0">
                <div class="font-semibold text-gray-800">${d.title || 'BaÅŸlÄ±k Yok'}</div>
                <div class="text-sm text-gray-600 truncate">${d.description || 'AÃ§Ä±klama Yok'}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-1">${linkDisplay}</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <button data-id="${docSnap.id}" class="delete-banner-btn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors mt-3 self-end w-full sm:w-auto"><i class="ri-delete-bin-line"></i> Sil</button>
Â  Â  Â  Â  `;
Â  Â  Â  Â  el.querySelector(".delete-banner-btn").addEventListener("click",async(e)=>{Â 
Â  Â  Â  Â  Â  Â  const id = e.target.dataset.id;
Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db,"homeBanners",id));Â 
Â  Â  Â  Â  Â  Â  await loadBanners();Â 
Â  Â  Â  Â  Â  Â  showMsg("Banner silindi!", false);Â 
Â  Â  Â  Â  });
Â  Â  Â  Â  bannerList.appendChild(el);
Â  Â  Â  });
Â  } catch (e) {
Â  Â  Â  showMsg("Banner yÃ¼kleme hatasÄ±: " + e.message, true);
Â  }
}

// --- CATEGORY CRUD (AynÄ± kaldÄ±) ---
addCategoryBtn.addEventListener("click", async ()=>{
Â  const name=categoryName.value.trim();Â 
Â  if(!name){showMsg("Kategori adÄ± boÅŸ olamaz", true); return;}
Â  try{
Â  Â  await addDoc(collection(db,"homeCategories"),{
Â  Â  Â  Â  name,
Â  Â  Â  Â  parent:parentCategory.value||null,Â 
Â  Â  Â  Â  createdAt:new Date()
Â  Â  });
Â  Â  categoryName.value="";Â 
Â  Â  await loadCategories();Â 
Â  Â  showMsg("Kategori baÅŸarÄ±yla eklendi", false);
Â  }catch(e){
Â  Â  showMsg("Ekleme hatasÄ±: " + e.message, true);
Â  }
});

async function loadCategories(){
Â  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  categoryList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> Kategoriler yÃ¼kleniyor...";
Â  parentCategory.innerHTML='<option value="">Ãœst Kategori Yok</option>';
Â  productCategorySelect.innerHTML='<option value="">Kategori seÃ§ (Zorunlu)</option>';

Â  try {
Â  Â  const snap=await getDocs(collection(db,"homeCategories"));Â 
Â  Â  categoryList.innerHTML="";Â 
Â  Â  if(snap.empty){ categoryList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek kategori bulunamadÄ±.</p>"; return; }
Â  Â  snap.forEach(docSnap=>{
Â  Â  Â  const d=docSnap.data();
Â  Â  Â  const catId = docSnap.id;
Â  Â  Â Â 
Â  Â  Â  const el=document.createElement("div");
Â  Â  Â  el.className="flex justify-between items-center bg-gray-100 p-2 rounded";
Â  Â  Â  el.innerHTML=`
Â  Â  Â  Â  <span>${d.parent?d.parent+" > ":""}${d.name}</span>Â 
Â  Â  Â  Â  <button data-id="${catId}" class="delete-category-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm transition-colors">Sil</button>
Â  Â  Â  `;
Â  Â  Â  el.querySelector(".delete-category-btn").addEventListener("click",async(e)=>{Â 
Â  Â  Â  Â  Â  const id = e.target.dataset.id;
Â  Â  Â  Â  Â  await deleteDoc(doc(db,"homeCategories",id));Â 
Â  Â  Â  Â  Â  await loadCategories();Â 
Â  Â  Â  Â  Â  showMsg("Kategori silindi", false);Â 
Â  Â  Â  });
Â  Â  Â  categoryList.appendChild(el);
Â  Â  Â Â 
Â  Â  Â  // Select alanlarÄ±nÄ± doldur
Â  Â  Â  parentCategory.innerHTML+=`<option value="${d.name}">${d.name}</option>`;
Â  Â  Â  productCategorySelect.innerHTML+=`<option value="${d.name}">${d.name}</option>`;
Â  Â  });
Â  } catch (e) {
Â  Â  Â  showMsg("Kategori yÃ¼kleme hatasÄ±: " + e.message, true);
Â  }
}

// --- PRODUCT DÃœZENLEME MANTIÄžI ---
function editProduct(productId) {
Â  Â  const product = currentProducts.find(p => p.id === productId);

Â  Â  if (product) {
Â  Â  Â  Â  
        // 1. Formu temizle ve dÃ¼zenleme moduna geÃ§ir
        resetProductForm(true); 

        // 2. Temel ve Varyant verilerini yÃ¼kle
Â  Â  Â  Â  productVariants = Array.isArray(product.variants) ? [...product.variants] : [];
Â  Â  Â  Â  renderVariants();
        
        // 3. Tekil alanlarÄ± doldur
Â  Â  Â  Â  productName.value = product.name || '';
Â  Â  Â  Â  productPrice.value = product.price || '';
Â  Â  Â  Â  productOldPrice.value = product.old_price || ''; 
Â  Â  Â  Â  productCategorySelect.value = product.category || '';
Â  Â  Â  Â  productImage.value = product.image || '';
Â  Â  Â  Â  productVideo.value = product.video || '';
Â  Â  Â  Â  productDescription.value = product.description || '';
Â  Â  Â  Â  productActive.checked = product.active || false;
        
        // 4. Dinamik Ek GÃ¶rsel alanlarÄ±nÄ± doldur
        const existingExtraImages = Array.isArray(product.extraImages) ? product.extraImages : [];
        existingExtraImages.forEach(url => {
            addExtraImageInput(url);
        });

Â  Â  Â  Â  editingProductId.value = productId;
Â  Â  Â  Â  editingProductName.textContent = product.name;
Â  Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  } else {
Â  Â  Â  Â  showMsg("DÃ¼zenlenecek Ã¼rÃ¼n bulunamadÄ±.", true);
Â  Â  }
}

updateProductBtn.addEventListener("click", async () => {
Â  Â  const productId = editingProductId.value;
Â  Â  if (!productId) return;Â 

Â  Â  const name = productName.value.trim();
Â  Â  const price = parseFloat(productPrice.value);
    const oldPriceRaw = productOldPrice.value.trim();
    const oldPrice = oldPriceRaw ? parseFloat(oldPriceRaw) : null;

Â  Â  const category = productCategorySelect.value;
Â  Â  const image = productImage.value.trim();
Â  Â  const video = productVideo.value.trim();
Â  Â  const extraImages = collectExtraImages(); 
Â  Â  const desc = productDescription.value.trim();
Â  Â  const active = productActive.checked;
Â  Â  const variants = productVariants;

Â  Â  if (!name || isNaN(price) || !category || !image) {Â 
Â  Â  Â  Â  showMsg("ÃœrÃ¼n adÄ±, fiyat, kategori ve ana gÃ¶rsel zorunludur.", true);Â 
Â  Â  Â  Â  return;Â 
Â  Â  }
    
    if (oldPrice !== null && isNaN(oldPrice)) {
        showMsg("Eski fiyat geÃ§erli bir sayÄ± olmalÄ±dÄ±r.", true);
        return;
    }

Â  Â  try {
Â  Â  Â  Â  const productRef = doc(db, "homeProducts", productId);
Â  Â  Â  Â  await updateDoc(productRef, {
Â  Â  Â  Â  Â  Â  name, price, old_price: oldPrice, category, image, video, extraImages, description: desc, active, variants,
Â  Â  Â  Â  Â  Â  updatedAt: new Date()
Â  Â  Â  Â  });
Â  Â  Â  Â  resetProductForm(false);Â 
Â  Â  Â  Â  await loadProducts();Â 
Â  Â  Â  Â  showMsg("ÃœrÃ¼n baÅŸarÄ±yla gÃ¼ncellendi!", false);
Â  Â  } catch (e) {
Â  Â  Â  Â  showMsg("GÃ¼ncelleme hatasÄ±: " + e.message, true);
Â  Â  }
});


// --- PRODUCT CRUD (ADD/DELETE/LOAD) ---
addProductBtn.addEventListener("click", async ()=>{
Â  if(editingProductId.value) return;Â 

Â  const name=productName.value.trim();
Â  const price=parseFloat(productPrice.value);Â 
Â  
    const oldPriceRaw = productOldPrice.value.trim();
    const oldPrice = oldPriceRaw ? parseFloat(oldPriceRaw) : null;
    
Â  const category=productCategorySelect.value;
Â  const image=productImage.value.trim();
Â  const video=productVideo.value.trim();
Â  const extraImages = collectExtraImages();Â 
Â  const desc=productDescription.value.trim();
Â  const active=productActive.checked;
Â  const variants = productVariants;

Â  if (!name || isNaN(price) || !category || !image) {Â 
Â  Â  showMsg("ÃœrÃ¼n adÄ±, fiyat, kategori ve ana gÃ¶rsel zorunludur.", true);Â 
Â  Â  return;Â 
Â  }
    
    if (oldPrice !== null && isNaN(oldPrice)) {
        showMsg("Eski fiyat geÃ§erli bir sayÄ± olmalÄ±dÄ±r.", true);
        return;
    }

Â  try{
Â  Â  await addDoc(collection(db,"homeProducts"),{
Â  Â  Â  Â  name,price,old_price: oldPrice, category, image, video, extraImages, description:desc, active, variants, createdAt:new Date()
Â  Â  });
Â  Â  resetProductForm(false);
Â  Â  await loadProducts();Â 
Â  Â  showMsg("ÃœrÃ¼n baÅŸarÄ±yla eklendi", false);
Â  }catch(e){Â 
Â  Â  showMsg("Ekleme hatasÄ±: " + e.message, true);
Â  }
});
refreshProductsBtn.addEventListener("click",loadProducts);

async function loadProducts(){
Â  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  productList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> ÃœrÃ¼nler yÃ¼kleniyor...";
Â  try {
Â  Â  Â  const snap=await getDocs(collection(db,"homeProducts"));Â 
Â  Â  Â  productList.innerHTML="";
Â  Â  Â  currentProducts = [];

Â  Â  Â  if(snap.empty){ productList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek Ã¼rÃ¼n bulunamadÄ±.</p>"; return; }

Â  Â  Â  snap.forEach(docSnap=>{
Â  Â  Â  Â  const d=docSnap.data();
Â  Â  Â  Â  currentProducts.push({ id: docSnap.id, ...d });
        
        // Fiyat GÃ¶sterimi MantÄ±ÄŸÄ± (ÃœstÃ¼ Ã§izili fiyat eklendi)
        const currentPrice = d.price || 0;
        const oldPrice = d.old_price || 0;
        
        let priceHtml;
        if (oldPrice > currentPrice) {
            priceHtml = `<div class="flex items-end gap-2">
                <span class="font-extrabold text-xl text-primary">${currentPrice.toFixed(2)} â‚º</span>
                <span class="text-sm text-gray-400 line-through">${oldPrice.toFixed(2)} â‚º</span>
            </div>`;
        } else {
            priceHtml = `<span class="font-extrabold text-xl text-primary">${currentPrice.toFixed(2)} â‚º</span>`;
        }
        // Fiyat GÃ¶sterimi BitiÅŸi

Â  Â  Â  Â  const el=document.createElement("div");
Â  Â  Â  Â  el.className="p-3 bg-white rounded shadow-md flex flex-col justify-between";
Â  Â  Â  Â Â 
Â  Â  Â  Â  const extraImagesCount = Array.isArray(d.extraImages) ? d.extraImages.length : 0;
        const extraImagesCountHtml = extraImagesCount > 0 
            ? `<div class="text-xs text-gray-500 mt-2 flex items-center gap-1"><i class="ri-image-2-line"></i> ${extraImagesCount} Ek GÃ¶rsel</div>`
            : '';

Â  Â  Â  Â  const variantsHtml = (Array.isArray(d.variants) && d.variants.length > 0)
Â  Â  Â  Â  Â  Â  ? `<div class="text-xs text-purple-600 mt-2"><i class="ri-list-check"></i> ${d.variants.length} Varyant</div>`
Â  Â  Â  Â  Â  Â  : '';

Â  Â  Â  Â  el.innerHTML=`
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="font-semibold text-lg">${d.name} <span class="text-xs ${d.active?"text-green-600":"text-red-600"}">${d.active?"(Aktif)":"(Pasif)"}</span></div>
Â  Â  Â  Â  Â  Â  <div class="text-sm text-gray-600">${d.category}</div>
Â  Â  Â  Â  Â  Â  <div class="text-sm my-1">${d.description||""}</div>
Â  Â  Â  Â  Â  Â  <div class="text-primary font-bold text-xl">${priceHtml}</div>
Â  Â  Â  Â  Â  Â  <img src="${d.image}" class="w-full h-36 object-cover my-2 rounded border product-image-preview" onerror="this.onerror=null;this.src='https://placehold.co/300x144/ccc/fff?text=Gorsel+Yok';" />
Â  Â  Â  Â  Â  Â  
            ${extraImagesCountHtml}
Â  Â  Â  Â  Â  Â  ${d.video ? `<div class="text-xs text-blue-500 mt-2 flex items-center gap-1"><i class="ri-video-line"></i> Video Eklendi</div>` : ''}
Â  Â  Â  Â  Â  Â  ${variantsHtml}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="flex gap-2 mt-3 pt-3 border-t">
Â  Â  Â  Â  Â  Â  <button data-id="${docSnap.id}" class="edit-btn bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"><i class="ri-edit-line"></i> DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  <button data-id="${docSnap.id}" class="delete-btn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"><i class="ri-delete-bin-line"></i> Sil</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â Â 
Â  Â  Â  Â  el.querySelector(".delete-btn").addEventListener("click",async(e)=>{Â 
Â  Â  Â  Â  Â  Â  const id = e.target.dataset.id;
Â  Â  Â  Â  Â  Â  await deleteDoc(doc(db,"homeProducts",id));Â 
Â  Â  Â  Â  Â  Â  await loadProducts();Â 
Â  Â  Â  Â  Â  Â  showMsg("ÃœrÃ¼n silindi", false);Â 
Â  Â  Â  Â  });

Â  Â  Â  Â  el.querySelector(".edit-btn").addEventListener("click", (e) => {
Â  Â  Â  Â  Â  Â  editProduct(e.target.dataset.id);
Â  Â  Â  Â  });

Â  Â  Â  Â  productList.appendChild(el);
Â  Â  Â  });
Â  } catch (e) {
Â  Â  Â  showMsg("ÃœrÃ¼n yÃ¼kleme hatasÄ±: " + e.message, true);
Â  }
}
</script>
</body>
</html>

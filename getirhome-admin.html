<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Getir Home Admin | Getir KÄ±brÄ±s</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.min.css" rel="stylesheet">
<style>
Â  .card { border-radius: 12px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
  .product-image-preview { transition: transform 0.2s; cursor: zoom-in; }
  .product-image-preview:hover { transform: scale(3.5); z-index: 1000; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
</style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-white shadow p-4">
Â  <div class="max-w-6xl mx-auto flex items-center justify-between">
Â  Â  <h1 class="text-xl font-bold text-primary">Getir Home â€” YÃ¶netim</h1>
Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  <span id="admin-email" class="text-gray-600"></span>
Â  Â  Â  <button id="logoutBtn" class="text-sm text-red-600 hidden">Ã‡Ä±kÄ±ÅŸ Yap</button>
Â  Â  </div>
Â  </div>
</header>

<main class="max-w-6xl mx-auto p-6">

<section id="login-screen" class="text-center py-12 hidden">
Â  <h2 class="text-2xl mb-4">Admin GiriÅŸi</h2>
Â  <button id="googleSignIn" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded flex items-center mx-auto gap-2 transition-colors"><i class="ri-google-fill"></i> Google ile GiriÅŸ Yap</button>
  <p class="mt-4 text-sm text-gray-500">LÃ¼tfen tanÄ±mlÄ± yÃ¶netici e-posta adresi ile giriÅŸ yapÄ±n.</p>
</section>

<section id="admin-panel" class="hidden card bg-white p-6">

Â  <div class="flex items-center justify-between mb-6">
Â  Â  <div>
Â  Â  Â  <h2 class="text-2xl font-semibold">YÃ¶netim Paneli</h2>
Â  Â  Â  <p class="text-sm text-gray-500">Banner, Kategori ve ÃœrÃ¼n yÃ¶netimi</p>
Â  Â  </div>
Â  Â  <div class="flex gap-2">
Â  Â  Â  <button id="tabBanner" class="px-4 py-2 rounded">Banner</button>
Â  Â  Â  <button id="tabCategory" class="px-4 py-2 bg-gray-100 rounded">Kategori</button>
Â  Â  Â  <button id="tabProduct" class="px-4 py-2 bg-gray-100 rounded">ÃœrÃ¼n</button>
Â  Â  </div>
Â  </div>

Â  <div id="sectionBanner">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ–¼ Banner YÃ¶netimi</h3>
Â  Â  <div id="banner-form-area" class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
Â  Â  Â  <input id="bannerUrl" placeholder="Banner gÃ¶rsel URL" class="border p-2 rounded col-span-2 focus:ring-primary focus:border-primary" />
Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  <button id="addBannerBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-1/2 transition-colors">Ekle</button>
Â  Â  Â  Â  <button id="refreshBannerBtn" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded w-1/2 transition-colors">Yenile</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="bannerList" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
Â  </div>

Â  <div id="sectionCategory" class="hidden">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ—‚ Kategori YÃ¶netimi</h3>
Â  Â  <div id="category-form-area" class="flex gap-3 mb-4">
Â  Â  Â  <input id="categoryName" placeholder="Kategori adÄ±" class="border p-2 rounded w-full focus:ring-primary focus:border-primary" />
Â  Â  Â  <select id="parentCategory" class="border p-2 rounded focus:ring-primary focus:border-primary">
Â  Â  Â  Â  <option value="">Ãœst Kategori Yok</option>
Â  Â  Â  </select>
Â  Â  Â  <button id="addCategoryBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded transition-colors">Ekle</button>
Â  Â  </div>
Â  Â  <div id="categoryList" class="space-y-2"></div>
Â  </div>

Â  <div id="sectionProduct" class="hidden">
Â  Â  <h3 class="font-semibold mb-3 border-b pb-2 text-gray-700">ðŸ›’ ÃœrÃ¼n YÃ¶netimi</h3>

Â  Â  <div id="editingStatus" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-4 hidden" role="alert">
Â  Â  Â  Â  <p class="font-bold">DÃ¼zenleme Modu:</p>
Â  Â  Â  Â  <p id="editingProductName"></p>
Â  Â  Â  Â  <input type="hidden" id="editingProductId" />
Â  Â  </div>

Â  Â  <div id="product-form-area" class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4 border p-4 rounded-lg bg-gray-50">
Â  Â  Â  <input id="productName" placeholder="ÃœrÃ¼n adÄ± (Zorunlu)" class="border p-2 rounded focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="productPrice" placeholder="Fiyat (â‚º) (Zorunlu)" class="border p-2 rounded focus:ring-primary focus:border-primary" type="number" step="0.01"/>
Â  Â  Â  <select id="productCategorySelect" class="border p-2 rounded focus:ring-primary focus:border-primary">
Â  Â  Â  Â  <option value="">Kategori seÃ§ (Zorunlu)</option>
Â  Â  Â  </select>
Â  Â  Â  <input id="productDescription" placeholder="ÃœrÃ¼n aÃ§Ä±klamasÄ±" class="border p-2 rounded md:col-span-3 focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="productImage" placeholder="Ana gÃ¶rsel URL (Zorunlu)" class="border p-2 rounded focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="productVideo" placeholder="Video URL (opsiyonel)" class="border p-2 rounded focus:ring-primary focus:border-primary" />
Â  Â  Â  <input id="productExtraImages" placeholder="Ek gÃ¶rseller (URL, virgÃ¼l ile ayÄ±rÄ±n)" class="border p-2 rounded md:col-span-3 focus:ring-primary focus:border-primary" />
Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  <input id="productActive" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" />Â 
Â  Â  Â  Â  Â  Â  <label for="productActive" class="text-sm font-medium text-gray-700">ÃœrÃ¼nÃ¼ aktif olarak gÃ¶ster</label>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="flex gap-2 mb-6">
Â  Â  Â  <button id="addProductBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors"><i class="ri-add-line"></i> ÃœrÃ¼n Ekle</button>
Â  Â  Â  <button id="updateProductBtn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded hidden transition-colors"><i class="ri-save-line"></i> Kaydet ve GÃ¼ncelle</button>
Â  Â  Â  <button id="cancelEditBtn" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded hidden transition-colors"><i class="ri-close-line"></i> Ä°ptal</button>
Â  Â  Â  <button id="refreshProductsBtn" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded transition-colors"><i class="ri-refresh-line"></i> Yenile</button>
Â  Â  </div>

Â  Â  <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
Â  </div>

</section>

<div id="msg" class="mt-4 text-sm text-red-600"></div>
</main>

<footer class="text-center text-gray-400 py-8">
Â© 2025 Getir KÄ±brÄ±s
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

// Firestore iÃ§in DEBUG seviyesini aÃ§
setLogLevel('debug');

const firebaseConfig = {
Â  apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
Â  authDomain: "kibris-6b4f7.firebaseapp.com",
Â  projectId: "kibris-6b4f7",
Â  storageBucket: "kibris-6b4f7.appspot.com",
Â  messagingSenderId: "141262926171",
Â  appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
Â  measurementId: "G-JL9P6BRZTD"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// !!! KRÄ°TÄ°K: BURAYI KENDÄ° ADMÄ°N EMAIL'Ä°NÄ°ZLE DEÄžÄ°ÅžTÄ°RMEYÄ° UNUTMAYIN!
const ADMIN_EMAIL = "emirmob09@gmail.com"; 

// --- DOM Elementleri ---
const loginScreen = document.getElementById("login-screen");
const googleSignIn = document.getElementById("googleSignIn");
const adminPanel = document.getElementById("admin-panel");
const adminEmailSpan = document.getElementById("admin-email");
const logoutBtn = document.getElementById("logoutBtn");
const msg = document.getElementById("msg");

// Panel TablarÄ± ve BÃ¶lÃ¼mleri
const tabBanner = document.getElementById("tabBanner");
const tabCategory = document.getElementById("tabCategory");
const tabProduct = document.getElementById("tabProduct");
const sectionBanner = document.getElementById("sectionBanner");
const sectionCategory = document.getElementById("sectionCategory");
const sectionProduct = document.getElementById("sectionProduct");

// Banner
const bannerUrl = document.getElementById("bannerUrl");
const addBannerBtn = document.getElementById("addBannerBtn");
const bannerList = document.getElementById("bannerList");
const refreshBannerBtn = document.getElementById("refreshBannerBtn");

// Kategori
const categoryName = document.getElementById("categoryName");
const parentCategory = document.getElementById("parentCategory");
const addCategoryBtn = document.getElementById("addCategoryBtn");
const categoryList = document.getElementById("categoryList");

// ÃœrÃ¼n
const productName = document.getElementById("productName");
const productPrice = document.getElementById("productPrice");
const productCategorySelect = document.getElementById("productCategorySelect");
const productImage = document.getElementById("productImage");
const productVideo = document.getElementById("productVideo");
const productExtraImages = document.getElementById("productExtraImages");
const productDescription = document.getElementById("productDescription");
const productActive = document.getElementById("productActive");

const addProductBtn = document.getElementById("addProductBtn");
const updateProductBtn = document.getElementById("updateProductBtn");
const cancelEditBtn = document.getElementById("cancelEditBtn");
const productList = document.getElementById("productList");
const refreshProductsBtn = document.getElementById("refreshProductsBtn");
const editingStatus = document.getElementById("editingStatus");
const editingProductName = document.getElementById("editingProductName");
const editingProductId = document.getElementById("editingProductId");

let currentProducts = [];

// Tailwind Primary rengini CSS deÄŸiÅŸkeni olarak tanÄ±mla
document.documentElement.style.setProperty('--color-primary', '#5D3EBC');
tabBanner.classList.add("bg-[--color-primary]", "text-white"); // BaÅŸlangÄ±Ã§ta Banner sekmesi aktif

// --- YARDIMCI VE UI MANTIÄžI ---
function showMsg(text, isError=true){ 
    msg.textContent=text; 
    msg.style.color=isError?"#b91c1c":"#065f46"; 
    if(text) setTimeout(()=>{msg.textContent="";},5000);
}

function resetProductForm(isEditing = false) {
Â  Â  productName.value = "";
Â  Â  productPrice.value = "";
Â  Â  productCategorySelect.value = "";
Â  Â  productImage.value = "";
Â  Â  productVideo.value = "";
Â  Â  productExtraImages.value = "";
Â  Â  productDescription.value = "";
Â  Â  productActive.checked = false;
Â  Â  editingProductId.value = "";
    editingProductName.textContent = "";

Â  Â  if (isEditing) {
Â  Â  Â  Â  addProductBtn.classList.add("hidden");
Â  Â  Â  Â  updateProductBtn.classList.remove("hidden");
Â  Â  Â  Â  cancelEditBtn.classList.remove("hidden");
Â  Â  Â  Â  editingStatus.classList.remove("hidden");
Â  Â  } else {
Â  Â  Â  Â  addProductBtn.classList.remove("hidden");
Â  Â  Â  Â  updateProductBtn.classList.add("hidden");
Â  Â  Â  Â  cancelEditBtn.classList.add("hidden");
Â  Â  Â  Â  editingStatus.classList.add("hidden");
Â  Â  }
}

function activateTab(target){
Â  [sectionBanner,sectionCategory,sectionProduct].forEach(s=>s.classList.add("hidden"));
Â  [tabBanner,tabCategory,tabProduct].forEach(t=>{
      t.classList.remove("bg-[--color-primary]","text-white");
      t.classList.add("bg-gray-100");
  });
Â  if(target==="banner"){
      sectionBanner.classList.remove("hidden"); 
      tabBanner.classList.add("bg-[--color-primary]","text-white");
      tabBanner.classList.remove("bg-gray-100");
      loadBanners();
  }
Â  if(target==="category"){
      sectionCategory.classList.remove("hidden"); 
      tabCategory.classList.add("bg-[--color-primary]","text-white");
      tabCategory.classList.remove("bg-gray-100");
      loadCategories();
  }
Â  if(target==="product"){
      sectionProduct.classList.remove("hidden"); 
      tabProduct.classList.add("bg-[--color-primary]","text-white");
      tabProduct.classList.remove("bg-gray-100");
      resetProductForm(false);
      loadCategories(); // ÃœrÃ¼n formunu kategori ile doldur
      loadProducts();
  }
}

tabBanner.addEventListener("click",()=>activateTab("banner"));
tabCategory.addEventListener("click",()=>activateTab("category"));
tabProduct.addEventListener("click",()=>activateTab("product"));
cancelEditBtn.addEventListener("click",()=>resetProductForm(false));

// --- AUTH ---
onAuthStateChanged(auth, async (user)=>{
Â  try{
Â  Â  if(!user){ 
      loginScreen.classList.remove("hidden"); 
      adminPanel.classList.add("hidden"); 
      logoutBtn.classList.add("hidden"); 
      adminEmailSpan.textContent=""; 
      return; 
    }
Â  Â  if(user.email!==ADMIN_EMAIL){ 
      showMsg("Bu panel sadece admin iÃ§in yetkilidir.", true); 
      await signOut(auth); 
      return; 
    }
Â  Â  loginScreen.classList.add("hidden"); 
    adminPanel.classList.remove("hidden"); 
    logoutBtn.classList.remove("hidden"); 
    adminEmailSpan.textContent=user.email;

Â  Â  // BaÅŸlangÄ±Ã§ta sadece Banner sekmesini yÃ¼kle
Â  Â  activateTab("banner"); 
Â  }catch(e){ 
    console.error(e); 
    showMsg("Yetki hatasÄ±: "+e.message, true);
  }
});

googleSignIn.addEventListener("click",async()=>{ 
  try{ 
    await signInWithPopup(auth,provider);
  }catch(e){
    showMsg("GiriÅŸ hatasÄ±: "+e.message, true);
  } 
});
logoutBtn.addEventListener("click",async()=>{ 
  await signOut(auth); 
  // Admin giriÅŸ ekranÄ±na yÃ¶nlendir
  loginScreen.classList.remove("hidden"); 
  adminPanel.classList.add("hidden"); 
  logoutBtn.classList.add("hidden"); 
});

// --- BANNER CRUD ---
addBannerBtn.addEventListener("click", async ()=>{
Â  const url=bannerUrl.value.trim();
Â  if(!url || !url.startsWith('http')){ showMsg("GeÃ§erli bir gÃ¶rsel URL'si girin", true); return;}
Â  try{ 
    await addDoc(collection(db,"homeBanners"),{url, createdAt:new Date()}); 
    bannerUrl.value=""; 
    await loadBanners(); 
    showMsg("Banner baÅŸarÄ±yla eklendi!", false);
  }catch(e){ 
    showMsg("Ekleme hatasÄ±: " + e.message, true);
  }
});
refreshBannerBtn.addEventListener("click",loadBanners);

async function loadBanners(){
  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  bannerList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> Bannerlar yÃ¼kleniyor...";
Â  try {
      const snap=await getDocs(collection(db,"homeBanners"));
      bannerList.innerHTML="";
      if(snap.empty){ bannerList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek banner bulunamadÄ±.</p>"; return; }
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const el=document.createElement("div");
        el.className="flex justify-between items-center bg-gray-100 p-2 rounded";
        el.innerHTML=`
          <div class="flex items-center gap-2 overflow-hidden">
            <img src="${d.url}" class="w-10 h-10 object-cover rounded product-image-preview" onerror="this.onerror=null;this.src='https://placehold.co/40x40/ccc/fff?text=?'"/>
            <span class="truncate text-xs">${d.url.substring(0, 80)}...</span>
          </div>
          <button data-id="${docSnap.id}" class="delete-banner-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm transition-colors">Sil</button>
        `;
        el.querySelector(".delete-banner-btn").addEventListener("click",async(e)=>{ 
            const id = e.target.dataset.id;
            await deleteDoc(doc(db,"homeBanners",id)); 
            await loadBanners(); 
            showMsg("Banner silindi!", false); 
        });
        bannerList.appendChild(el);
      });
  } catch (e) {
      showMsg("Banner yÃ¼kleme hatasÄ±: " + e.message, true);
  }
}

// --- CATEGORY CRUD ---
addCategoryBtn.addEventListener("click", async ()=>{
Â  const name=categoryName.value.trim(); 
  if(!name){showMsg("Kategori adÄ± boÅŸ olamaz", true); return;}
Â  try{
Â  Â  await addDoc(collection(db,"homeCategories"),{
        name,
        parent:parentCategory.value||null, 
        createdAt:new Date()
    });
Â  Â  categoryName.value=""; 
    await loadCategories(); 
    showMsg("Kategori baÅŸarÄ±yla eklendi", false);
Â  }catch(e){
    showMsg("Ekleme hatasÄ±: " + e.message, true);
  }
});

async function loadCategories(){
  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  categoryList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> Kategoriler yÃ¼kleniyor...";
Â  parentCategory.innerHTML='<option value="">Ãœst Kategori Yok</option>';
Â  productCategorySelect.innerHTML='<option value="">Kategori seÃ§ (Zorunlu)</option>';

Â  try {
    const snap=await getDocs(collection(db,"homeCategories"));Â 
    categoryList.innerHTML="";Â 
    if(snap.empty){ categoryList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek kategori bulunamadÄ±.</p>"; return; }
    snap.forEach(docSnap=>{
      const d=docSnap.data();
      const catId = docSnap.id;
      
      const el=document.createElement("div");
      el.className="flex justify-between items-center bg-gray-100 p-2 rounded";
      el.innerHTML=`
        <span>${d.parent?d.parent+" > ":""}${d.name}</span> 
        <button data-id="${catId}" class="delete-category-btn bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-sm transition-colors">Sil</button>
      `;
      el.querySelector(".delete-category-btn").addEventListener("click",async(e)=>{ 
          const id = e.target.dataset.id;
          await deleteDoc(doc(db,"homeCategories",id)); 
          await loadCategories(); 
          showMsg("Kategori silindi", false); 
      });
      categoryList.appendChild(el);
      
      // Select alanlarÄ±nÄ± doldur
      parentCategory.innerHTML+=`<option value="${d.name}">${d.name}</option>`;
      productCategorySelect.innerHTML+=`<option value="${d.name}">${d.name}</option>`;
    });
  } catch (e) {
      showMsg("Kategori yÃ¼kleme hatasÄ±: " + e.message, true);
  }
}

// --- PRODUCT DÃœZENLEME MANTIÄžI ---
function editProduct(productId) {
Â  Â  const product = currentProducts.find(p => p.id === productId);

Â  Â  if (product) {
Â  Â  Â  Â  productName.value = product.name || '';
Â  Â  Â  Â  productPrice.value = product.price || '';
Â  Â  Â  Â  productCategorySelect.value = product.category || '';
Â  Â  Â  Â  productImage.value = product.image || '';
Â  Â  Â  Â  productVideo.value = product.video || '';
Â  Â  Â  Â  // extraImages array ise join et, deÄŸilse boÅŸ bÄ±rak
Â  Â  Â  Â  productExtraImages.value = (Array.isArray(product.extraImages) ? product.extraImages.join(', ') : '');
Â  Â  Â  Â  productDescription.value = product.description || '';
Â  Â  Â  Â  productActive.checked = product.active || false;

Â  Â  Â  Â  editingProductId.value = productId;
Â  Â  Â  Â  editingProductName.textContent = product.name;
Â  Â  Â  Â  resetProductForm(true);Â 
Â  Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  } else {
Â  Â  Â  Â  showMsg("DÃ¼zenlenecek Ã¼rÃ¼n bulunamadÄ±.", true);
Â  Â  }
}

updateProductBtn.addEventListener("click", async () => {
Â  Â  const productId = editingProductId.value;
Â  Â  if (!productId) return;Â 

Â  Â  const name = productName.value.trim();
Â  Â  const price = parseFloat(productPrice.value);
Â  Â  const category = productCategorySelect.value;
Â  Â  const image = productImage.value.trim();
Â  Â  const video = productVideo.value.trim();
Â  Â  const extraImages = productExtraImages.value.trim().split(",").map(x => x.trim()).filter(Boolean);
Â  Â  const desc = productDescription.value.trim();
Â  Â  const active = productActive.checked;

Â  Â  if (!name || isNaN(price) || !category || !image) { 
        showMsg("ÃœrÃ¼n adÄ±, fiyat, kategori ve ana gÃ¶rsel zorunludur.", true); 
        return; 
    }

Â  Â  try {
Â  Â  Â  Â  const productRef = doc(db, "homeProducts", productId);
Â  Â  Â  Â  await updateDoc(productRef, {
Â  Â  Â  Â  Â  Â  name, price, category, image, video, extraImages, description: desc, active,
Â  Â  Â  Â  Â  Â  updatedAt: new Date()
Â  Â  Â  Â  });
Â  Â  Â  Â  resetProductForm(false);Â 
Â  Â  Â  Â  await loadProducts();Â 
Â  Â  Â  Â  showMsg("ÃœrÃ¼n baÅŸarÄ±yla gÃ¼ncellendi!", false);
Â  Â  } catch (e) {
Â  Â  Â  Â  showMsg("GÃ¼ncelleme hatasÄ±: " + e.message, true);
Â  Â  }
});


// --- PRODUCT CRUD (ADD/DELETE/LOAD) ---
addProductBtn.addEventListener("click", async ()=>{
Â  if(editingProductId.value) return;Â 

Â  const name=productName.value.trim();
Â  const price=parseFloat(productPrice.value);Â 
Â  const category=productCategorySelect.value;
Â  const image=productImage.value.trim();
Â  const video=productVideo.value.trim();
Â  const extraImages=productExtraImages.value.trim().split(",").map(x=>x.trim()).filter(Boolean);Â 
Â  const desc=productDescription.value.trim();
Â  const active=productActive.checked;

Â  if (!name || isNaN(price) || !category || !image) { 
    showMsg("ÃœrÃ¼n adÄ±, fiyat, kategori ve ana gÃ¶rsel zorunludur.", true); 
    return; 
  }
Â  try{
Â  Â  await addDoc(collection(db,"homeProducts"),{
        name,price,category,image,video,extraImages,description:desc,active,createdAt:new Date()
    });
Â  Â  resetProductForm(false);
Â  Â  await loadProducts(); 
    showMsg("ÃœrÃ¼n baÅŸarÄ±yla eklendi", false);
Â  }catch(e){ 
    showMsg("Ekleme hatasÄ±: " + e.message, true);
  }
});
refreshProductsBtn.addEventListener("click",loadProducts);

async function loadProducts(){
  if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) return;

Â  productList.innerHTML="<i class='ri-loader-4-line animate-spin'></i> ÃœrÃ¼nler yÃ¼kleniyor...";
  try {
      const snap=await getDocs(collection(db,"homeProducts"));Â 
      productList.innerHTML="";
      currentProducts = [];

      if(snap.empty){ productList.innerHTML="<p class='text-gray-500'>YÃ¼klenecek Ã¼rÃ¼n bulunamadÄ±.</p>"; return; }

      snap.forEach(docSnap=>{
        const d=docSnap.data();
        currentProducts.push({ id: docSnap.id, ...d });

        const el=document.createElement("div");
        el.className="p-3 bg-white rounded shadow-md flex flex-col justify-between";
        
        const extraImagesHtml = (Array.isArray(d.extraImages) && d.extraImages.length > 0)Â 
          ? d.extraImages.map(url => `<img src="${url}" class="w-16 h-16 object-cover inline-block mr-2 my-1 rounded border product-image-preview" onerror="this.onerror=null;this.src='https://placehold.co/40x40/ccc/fff?text=?'">`).join("")
          : '';Â 

        el.innerHTML=`
          <div>
            <div class="font-semibold text-lg">${d.name} <span class="text-xs ${d.active?"text-green-600":"text-red-600"}">${d.active?"(Aktif)":"(Pasif)"}</span></div>
            <div class="text-sm text-gray-600">${d.category}</div>
            <div class="text-sm my-1">${d.description||""}</div>
            <div class="text-primary font-bold text-xl">${(d.price || 0).toFixed(2)} â‚º</div>
            <img src="${d.image}" class="w-full h-36 object-cover my-2 rounded border product-image-preview" onerror="this.onerror=null;this.src='https://placehold.co/300x144/ccc/fff?text=Gorsel+Yok';" />
            ${extraImagesHtml}
            ${d.video ? `<div class="text-xs text-blue-500 mt-2 flex items-center gap-1"><i class="ri-video-line"></i> Video Eklendi</div>` : ''}
          </div>
          <div class="flex gap-2 mt-3 pt-3 border-t">
            <button data-id="${docSnap.id}" class="edit-btn bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"><i class="ri-edit-line"></i> DÃ¼zenle</button>
            <button data-id="${docSnap.id}" class="delete-btn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"><i class="ri-delete-bin-line"></i> Sil</button>
          </div>
        `;
        
        el.querySelector(".delete-btn").addEventListener("click",async(e)=>{Â 
            const id = e.target.dataset.id;
            await deleteDoc(doc(db,"homeProducts",id));Â 
            await loadProducts();Â 
            showMsg("ÃœrÃ¼n silindi", false);Â 
        });

        el.querySelector(".edit-btn").addEventListener("click", (e) => {
            editProduct(e.target.dataset.id);
        });

        productList.appendChild(el);
      });
  } catch (e) {
      showMsg("ÃœrÃ¼n yÃ¼kleme hatasÄ±: " + e.message, true);
  }
}
</script>
</body>
</html>

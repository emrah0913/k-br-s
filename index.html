<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Firebase Google Giriş Örneği</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin:0; font-family:sans-serif; background:#f6faff; }
    .header {
      display:flex; align-items:center; justify-content:flex-end;
      background:#fff; padding:14px 18px; box-shadow:0 2px 16px #d9e7fa33;
      border-radius:0 0 18px 18px;
    }
    .user-box {
      display:flex; align-items:center; gap:11px;
      padding:7px 13px; border-radius:12px; background:#e0ecfa;
      box-shadow:0 1px 6px #1565c01c;
      font-size:1rem; font-weight:500;
    }
    .user-img {
      width:36px; height:36px; border-radius:50%; object-fit:cover;
      border:2.5px solid #cfe3fa; background:#dbeaff;
    }
    .logout-btn {
      background:transparent; border:none; color:#1565c0; font-weight:700;
      padding:7px 13px; border-radius:8px; cursor:pointer; margin-left:3px;
      transition:background 0.14s, color 0.14s;
    }
    .logout-btn:hover { background:#d6e6fa; color:#0d3781; }
    .login-btn {
      background:#1e88e5; color:#fff; border:none; border-radius:8px;
      padding:10px 28px; font-weight:700; font-size:1rem; cursor:pointer;
      box-shadow:0 1px 6px #1565c01a;
      display:flex; align-items:center; gap:8px;
    }
    .login-btn img { width:22px; height:22px; }
    @media (max-width:600px) {
      .header { padding:7px 4vw; }
      .user-box { padding:5px 6px; font-size:.98rem;}
      .user-img { width:28px; height:28px; }
      .logout-btn, .login-btn { padding:7px 13px; font-size:.98rem; }
    }
  </style>
</head>
<body>
  <header class="header">
    <!-- Kullanıcı info burada -->
    <span id="kullanici"></span>
  </header>
  <main style="max-width:420px;margin:64px auto 0 auto;padding:14px;">
    <h2>Firebase Google Giriş Sistemi</h2>
    <p>Google hesabınızla güvenli giriş yapın.</p>
  </main>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics-compat.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
      authDomain: "kibris-6b4f7.firebaseapp.com",
      projectId: "kibris-6b4f7",
      storageBucket: "kibris-6b4f7.firebasestorage.app",
      messagingSenderId: "141262926171",
      appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
      measurementId: "G-JL9P6BRZTD"
    };
    // Init Firebase
    firebase.initializeApp(firebaseConfig);
    try { firebase.analytics && firebase.analytics(); } catch(e){}

    const auth = firebase.auth();
    const kullaniciSpan = document.getElementById('kullanici');

    // Kullanıcıyı göster
    function showUser(user) {
      kullaniciSpan.innerHTML = `
        <span class="user-box">
          <img src="${user.photoURL}" class="user-img" alt="Profil Fotoğrafı">
          <span>${user.displayName}</span>
          <button class="logout-btn" id="logout-btn">Çıkış Yap</button>
        </span>
      `;
      document.getElementById('logout-btn').onclick = function() {
        auth.signOut();
      };
    }

    // Otomatik Google giriş fonksiyonu
    function googleSignIn() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .catch(function(error) {
          alert("Giriş başarısız: " + (error.message || error));
          console.log(error);
        });
    }

    // İlk başta login butonu görünmez, otomatik giriş denenir
    function showLoginBtn() {
      kullaniciSpan.innerHTML = `<button style="display:none" id="hidden-google-login"></button>`;
      setTimeout(() => document.getElementById('hidden-google-login').click(), 100);
    }

    // Giriş durumunu izle
    let firstCheck = true;
    auth.onAuthStateChanged(function(user) {
      if(user) {
        showUser(user);
      } else {
        if(firstCheck) {
          firstCheck = false;
          showLoginBtn();
          googleSignIn();
        } else {
          // Kullanıcı yine gelmediyse login butonu göster
          kullaniciSpan.innerHTML =
            `<button class="login-btn" onclick="googleSignIn()">
              <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="">
              Google ile Giriş Yap
            </button>`;
        }
      }
    });

    // Login fonksiyonunu global yap (isteğe bağlı buton için)
    window.googleSignIn = googleSignIn;
  </script>
</body>
</html>

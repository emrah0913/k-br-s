<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Yönetim Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase App (the core Firebase SDK) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <!-- Google Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Tailwind ile tamamlanamayan minik özel stiller */
    .backdrop-blur { backdrop-filter: blur(8px);}
    .hide-scrollbar::-webkit-scrollbar {display: none;}
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none;}
  </style>
</head>
<body class="bg-gradient-to-tr from-purple-100 via-white to-purple-200 min-h-screen font-sans text-gray-800">

  <!-- Küçük Geri Butonu -->
  <button id="backBtn" class="fixed top-4 left-4 z-30 bg-purple-200 hover:bg-purple-300 rounded-full p-2 shadow-md transition hidden" title="Geri">
    <span class="material-icons text-purple-700 text-2xl">arrow_back</span>
  </button>

  <!-- HEADER -->
  <header class="flex items-center justify-between px-6 py-4 bg-white bg-opacity-70 backdrop-blur shadow-sm sticky top-0 z-20">
    <h1 class="text-2xl font-bold text-purple-700 select-none cursor-pointer" id="logoTitle">Yönetim Paneli</h1>
    <div id="profileArea" class="flex items-center gap-2">
      <button id="loginBtn" class="px-4 py-2 rounded bg-purple-600 text-white hover:bg-purple-700 font-semibold shadow transition">Google ile Giriş</button>
      <div id="profileContainer" class="relative hidden">
        <img id="profileImg" class="w-10 h-10 rounded-full border-2 border-purple-400 shadow cursor-pointer" src="" alt="Profil" />
        <!-- Çıkış Dropdown -->
        <div id="logoutDropdown" class="absolute right-0 mt-2 w-32 bg-white shadow-md rounded border border-purple-100 py-2 hidden z-50">
          <button id="logoutBtn" class="w-full text-left px-4 py-2 hover:bg-purple-50 text-purple-700">Çıkış Yap</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Ana Menü -->
  <main class="max-w-xl mx-auto mt-10 px-4" id="homeSection">
    <div class="flex flex-col gap-6">
      <button id="orderBtn" class="main-btn">Sipariş Oluştur</button>
      <button id="cargoBtn" class="main-btn">Kargo Takip</button>
      <button id="calcBtn" class="main-btn">Hesaplama</button>
      <button id="adminBtn" class="main-btn hidden">Admin Paneli</button>
    </div>
  </main>

  <!-- Sipariş Bölümü -->
  <section id="orderSection" class="hidden max-w-lg mx-auto mt-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold text-purple-700 mb-4">Sipariş Oluştur</h2>
      <form id="orderForm" class="space-y-4">
        <input type="text" id="orderName" class="input" placeholder="Ad Soyad" required />
        <input type="text" id="orderPhone" class="input" placeholder="Telefon" required />
        <input type="text" id="orderAddress" class="input" placeholder="Adres" required />
        <input type="text" id="orderDesc" class="input" placeholder="Sipariş Açıklaması" required />
        <button type="submit" class="w-full py-2 rounded bg-purple-600 text-white hover:bg-purple-700 font-semibold shadow transition">Gönder</button>
      </form>
    </div>
  </section>

  <!-- Kargo Takip Bölümü -->
  <section id="cargoSection" class="hidden max-w-lg mx-auto mt-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold text-purple-700 mb-4">Kargo Takip</h2>
      <form id="cargoForm" class="flex gap-2 mb-4">
        <input type="text" id="cargoCode" class="input flex-1" placeholder="Kargo Kodu" required />
        <button type="submit" class="px-4 rounded bg-purple-600 text-white hover:bg-purple-700 font-semibold shadow transition">Sorgula</button>
      </form>
      <div id="cargoResult" class="text-gray-600"></div>
    </div>
  </section>

  <!-- Hesaplama Bölümü -->
  <section id="calcSection" class="hidden max-w-lg mx-auto mt-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold text-purple-700 mb-4">Hesaplama</h2>
      <form id="calcForm" class="space-y-2 mb-4">
        <div class="flex gap-2">
          <input type="number" id="calc1" class="input flex-1" placeholder="Değer 1" required />
          <input type="number" id="calc2" class="input flex-1" placeholder="Değer 2" required />
        </div>
        <button type="submit" class="w-full py-2 rounded bg-purple-600 text-white hover:bg-purple-700 font-semibold shadow transition">Hesapla</button>
      </form>
      <div id="calcResult" class="text-gray-700 font-semibold"></div>
    </div>
  </section>

  <!-- Admin Paneli -->
  <section id="adminSection" class="hidden max-w-lg mx-auto mt-8">
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-bold text-purple-700 mb-4 flex items-center gap-2">
        <span class="material-icons">admin_panel_settings</span> Admin Paneli
      </h2>
      <div id="adminList" class="space-y-3"></div>
    </div>
  </section>

  <!-- Modal -->
  <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-40 hidden">
    <div id="modalBox" class="bg-white rounded-lg shadow-lg p-6 min-w-[300px] max-w-[90vw]">
      <div id="modalTitle" class="text-lg font-bold text-purple-700 mb-2"></div>
      <div id="modalContent" class="mb-4"></div>
      <div class="flex justify-end gap-2">
        <button id="modalCancel" class="px-4 py-1 rounded bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300">İptal</button>
        <button id="modalOk" class="px-4 py-1 rounded bg-purple-600 text-white font-semibold hover:bg-purple-700">Onayla</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-purple-600 text-white px-6 py-2 rounded shadow-lg z-50 hidden"></div>

  <script>
    // === Config ===
    const ADMIN_UID = "JKy2CJircqSgC8ftIx9kY7iHlXC3";

    // === Firebase Config (örnek, kendi bilgilerinle değiştir) ===
    const firebaseConfig = {
      apiKey: "AIzaSyD5EXAMPLE",
      authDomain: "your-app.firebaseapp.com",
      projectId: "your-app",
      storageBucket: "your-app.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // === UI Elements ===
    const homeSection = document.getElementById("homeSection");
    const orderSection = document.getElementById("orderSection");
    const cargoSection = document.getElementById("cargoSection");
    const calcSection = document.getElementById("calcSection");
    const adminSection = document.getElementById("adminSection");

    const backBtn = document.getElementById("backBtn");
    const logoTitle = document.getElementById("logoTitle");

    const loginBtn = document.getElementById("loginBtn");
    const profileContainer = document.getElementById("profileContainer");
    const profileImg = document.getElementById("profileImg");
    const logoutDropdown = document.getElementById("logoutDropdown");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminBtn = document.getElementById("adminBtn");

    // === Modal & Toast ===
    const modalOverlay = document.getElementById("modalOverlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalContent = document.getElementById("modalContent");
    const modalCancel = document.getElementById("modalCancel");
    const modalOk = document.getElementById("modalOk");
    const toast = document.getElementById("toast");

    // === State ===
    let currentSection = "home";
    let currentUser = null;
    let logoutDropdownOpen = false;

    // === SPA Navigation ===
    function showSection(section) {
      // Bölümleri gizle/göster
      homeSection.classList.add("hidden");
      orderSection.classList.add("hidden");
      cargoSection.classList.add("hidden");
      calcSection.classList.add("hidden");
      adminSection.classList.add("hidden");

      switch (section) {
        case "order": orderSection.classList.remove("hidden"); break;
        case "cargo": cargoSection.classList.remove("hidden"); break;
        case "calc": calcSection.classList.remove("hidden"); break;
        case "admin": adminSection.classList.remove("hidden"); break;
        default: homeSection.classList.remove("hidden");
      }
      currentSection = section;

      // Geri butonunu yönet
      if (section !== "home") {
        backBtn.classList.remove("hidden");
      } else {
        backBtn.classList.add("hidden");
      }
    }

    // SPA "geri" için
    backBtn.onclick = () => showSection("home");
    logoTitle.onclick = () => showSection("home");

    // Ana menü butonları
    document.getElementById("orderBtn").onclick = () => showSection("order");
    document.getElementById("cargoBtn").onclick = () => showSection("cargo");
    document.getElementById("calcBtn").onclick = () => showSection("calc");
    adminBtn.onclick = () => showSection("admin");

    // === Auth ===
    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(e => showToast("Giriş başarısız: " + e.message));
    };

    profileImg.onclick = (e) => {
      e.stopPropagation();
      logoutDropdown.classList.toggle("hidden");
      logoutDropdownOpen = !logoutDropdownOpen;
    };

    logoutBtn.onclick = async () => {
      logoutDropdown.classList.add("hidden");
      logoutDropdownOpen = false;
      if (await showConfirmationModal("Çıkış Onayı", "Çıkış yapmak istediğinize emin misiniz?")) {
        auth.signOut();
      }
    };

    // Tıklandığında dropdown'ı kapat
    window.addEventListener("click", () => {
      if (logoutDropdownOpen) {
        logoutDropdown.classList.add("hidden");
        logoutDropdownOpen = false;
      }
    });

    // Profil UI
    function updateAuthUI(user) {
      currentUser = user;
      if (user) {
        loginBtn.classList.add("hidden");
        profileContainer.classList.remove("hidden");
        profileImg.src = user.photoURL || "";
        // Admin ise butonu göster
        if (user.uid === ADMIN_UID) {
          adminBtn.classList.remove("hidden");
        } else {
          adminBtn.classList.add("hidden");
        }
      } else {
        loginBtn.classList.remove("hidden");
        profileContainer.classList.add("hidden");
        adminBtn.classList.add("hidden");
      }
    }

    // Auth durumunu izle
    auth.onAuthStateChanged((user) => {
      updateAuthUI(user);
      if (currentSection === "admin" && (!user || user.uid !== ADMIN_UID)) {
        showSection("home");
        showToast("Admin yetkiniz yok!");
      }
      // Admin panelini güncelle
      if (user && user.uid === ADMIN_UID && currentSection === "admin") {
        loadAdminPanel();
      }
    });

    // === Sipariş Formu ===
    document.getElementById("orderForm").onsubmit = async (e) => {
      e.preventDefault();
      if (!currentUser) {
        showToast("Sipariş vermek için giriş yapmalısınız.");
        return;
      }
      const name = document.getElementById("orderName").value.trim();
      const phone = document.getElementById("orderPhone").value.trim();
      const address = document.getElementById("orderAddress").value.trim();
      const desc = document.getElementById("orderDesc").value.trim();
      if (!name || !phone || !address || !desc) {
        showToast("Tüm alanları doldurun.");
        return;
      }
      try {
        await db.collection("orders").add({
          uid: currentUser.uid,
          name, phone, address, desc,
          date: firebase.firestore.FieldValue.serverTimestamp(),
        });
        showToast("Siparişiniz alındı!");
        e.target.reset();
        showSection("home");
      } catch (err) {
        showToast("Sipariş kaydedilemedi: " + err.message);
      }
    };

    // === Kargo Takip ===
    document.getElementById("cargoForm").onsubmit = async (e) => {
      e.preventDefault();
      const code = document.getElementById("cargoCode").value.trim();
      if (!code) return;
      // Demo: Firestore'da "cargo" koleksiyonunda sorgula
      try {
        const snap = await db.collection("cargo").where("code", "==", code).limit(1).get();
        if (snap.empty) {
          document.getElementById("cargoResult").textContent = "Kargo bulunamadı.";
        } else {
          const data = snap.docs[0].data();
          document.getElementById("cargoResult").textContent = `Durum: ${data.status || "Bilinmiyor"} | Son Güncelleme: ${data.updated?.toDate().toLocaleString() || "-"}`;
        }
      } catch (err) {
        document.getElementById("cargoResult").textContent = "Sorgulama başarısız.";
      }
    };

    // === Hesaplama ===
    document.getElementById("calcForm").onsubmit = (e) => {
      e.preventDefault();
      const v1 = Number(document.getElementById("calc1").value);
      const v2 = Number(document.getElementById("calc2").value);
      if (isNaN(v1) || isNaN(v2)) {
        showToast("Lütfen iki sayı girin.");
        return;
      }
      document.getElementById("calcResult").textContent = `Toplam: ${v1 + v2} | Fark: ${v1 - v2} | Çarpım: ${v1 * v2}`;
    };

    // === Admin Paneli ===
    async function loadAdminPanel() {
      const adminList = document.getElementById("adminList");
      adminList.innerHTML = "<div class='text-gray-500 text-sm'>Yükleniyor...</div>";
      try {
        const orders = await db.collection("orders").orderBy("date", "desc").limit(10).get();
        if (orders.empty) {
          adminList.innerHTML = "<div class='text-gray-500'>Hiç sipariş yok.</div>";
        } else {
          adminList.innerHTML = "";
          orders.forEach(doc => {
            const o = doc.data();
            const id = doc.id;
            adminList.innerHTML += `
              <div class="p-3 rounded border shadow-sm flex flex-col gap-1 relative bg-purple-50">
                <div class="text-xs text-purple-700 font-bold">${o.name} (${o.phone})</div>
                <div class="text-xs text-gray-600">${o.address}</div>
                <div class="text-sm text-gray-700">${o.desc}</div>
                <div class="text-[11px] text-gray-400">${o.date?.toDate().toLocaleString() || "-"}</div>
                <button class="absolute top-2 right-2 delOrderBtn bg-red-100 hover:bg-red-200 text-red-500 rounded p-1 shadow" data-id="${id}" title="Sil">
                  <span class="material-icons text-base">delete</span>
                </button>
              </div>
            `;
          });
          // Silme butonları
          adminList.querySelectorAll(".delOrderBtn").forEach(btn => {
            btn.onclick = async () => {
              if (await showConfirmationModal("Sipariş Sil", "Bu siparişi silmek istiyor musunuz?")) {
                await db.collection("orders").doc(btn.dataset.id).delete();
                showToast("Silindi");
                loadAdminPanel();
              }
            };
          });
        }
      } catch (err) {
        adminList.innerHTML = "<div class='text-red-500'>Siparişler yüklenemedi.</div>";
      }
    }

    // Admin paneline geçince siparişleri yükle
    adminBtn.addEventListener("click", () => {
      if (currentUser && currentUser.uid === ADMIN_UID) loadAdminPanel();
    });

    // === Modal & Toast ===
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.remove("hidden");
      setTimeout(() => {toast.classList.add("hidden");}, 3000);
    }

    function showConfirmationModal(title, content) {
      modalTitle.textContent = title;
      modalContent.textContent = content;
      modalOverlay.classList.remove("hidden");
      return new Promise((resolve) => {
        function cleanup() {
          modalOverlay.classList.add("hidden");
          modalOk.onclick = null;
          modalCancel.onclick = null;
        }
        modalOk.onclick = () => { cleanup(); resolve(true); };
        modalCancel.onclick = () => { cleanup(); resolve(false); };
      });
    }

    // === Girişte state'i sıfırla ===
    showSection("home");

    // === Kullanışlı Input Sınıfı ===
    document.querySelectorAll(".input").forEach(inp => {
      inp.classList.add("w-full", "border", "rounded", "py-2", "px-3", "focus:outline-none", "focus:ring-2", "focus:ring-purple-400", "transition", "mb-2");
    });
  </script>

  <!-- Tailwind ile tanımlı olmayan butonlar için ek class -->
  <style>
    .main-btn {
      @apply w-full py-3 rounded-lg bg-purple-600 text-white font-bold text-lg shadow hover:bg-purple-700 transition;
    }
  </style>
</body>
</html>

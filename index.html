<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getir Kıbrıs</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config={theme:{extend:{colors:{primary:'#5d3ebc',secondary:'#ffd300'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <style>
        :where([class^="ri-"])::before { content: "\f3c2"; }
        body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
        .copy-btn:active { transform: scale(0.95); }
        /* Profil adı için ek stil, küçük ekranlarda gizlemek için */
        @media (max-width: 640px) { #profile-name-header { display: none; } }
    </style>
</head>
<body class="bg-gray-50">
<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center">
        <div class="flex-1">
            </div>
        <div class="flex flex-col items-center">
            <a href="index.html">
                <img src="https://static.readdy.ai/image/d4cf8783f5bb2724d5eb1b66ee82374b/8de9178d5e8d147b21dbfa093538290a.png" alt="Getir Kıbrıs" class="h-12"> </a>
            <a href="index.html" data-readdy="true" class="text-sm font-medium text-primary mt-1">Ana Sayfa</a>
        </div>
        <div class="flex-1 flex justify-end">
            <div id="auth-status-container" class="w-auto h-8 flex items-center justify-center">
                <button id="login-btn-header" class="hidden text-xs text-primary font-medium cursor-pointer py-2 px-3 border border-primary rounded-button hover:bg-primary/10 transition-colors">
                    <i class="ri-google-fill ri-lg mr-1 align-middle"></i>
                    <span class="align-middle">Google ile Giriş</span>
                </button>
                <div id="profile-container-header" class="hidden items-center space-x-2 cursor-pointer group">
                    <img id="profile-img-header" src="https://via.placeholder.com/40" alt="Profil" class="w-8 h-8 rounded-full">
                    <span id="profile-name-header" class="text-sm text-gray-700 group-hover:text-primary">Profil Adı</span>
                </div>
            </div>
        </div>
    </header>

    <main class="pt-24 pb-20"> <div class="relative w-full h-64 sm:h-80 lg:h-[450px] overflow-hidden mb-6">
            <video class="w-full h-full object-cover" controls poster="https://readdy.ai/api/search-image?query=online%20shopping%20and%20delivery%20service%2C%20modern%20lifestyle%2C%20soft%20lighting%2C%20clean%20background%2C%20banner%20image&width=800&height=400&seq=1&orientation=landscape">
            <source src="https://public.readdy.ai/assets/sample.mp4" type="video/mp4">
            Your browser does not support the video tag.
            </video>
            <div class="absolute inset-0 bg-gradient-to-t from-primary/70 to-transparent pointer-events-none"></div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 px-4 mb-8">
            <button id="calculate-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-calculator-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Hesapla</span>
            </button>
            <a href="https://getirkibris.com/siparisverr" data-readdy="true" id="order-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-shopping-cart-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Sipariş Ver</span>
            </a>
            <a href="https://readdy.ai/home/b800f715-acec-4575-acd1-66571f959c9d/3af37ec5-1c9d-4306-b2c2-90c1bdb926e2" data-readdy="true" id="my-orders-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-file-list-3-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Siparişlerim</span>
            </a>
            <a href="https://readdy.ai/home/b800f715-acec-4575-acd1-66571f959c9d/263e9a58-8e36-4b2d-89bb-7927a220fb76" data-readdy="true" id="track-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2"><i class="ri-truck-line ri-xl text-primary"></i></div>
                <span class="text-sm font-medium">Kargo Takip</span>
            </a>
        </div>

        <div id="calculator-section" class="bg-white rounded-lg shadow-md mx-4 p-4 mb-8 hidden">
            <h3 class="text-lg font-semibold mb-4 text-primary">Ürün Maliyeti Hesapla</h3>
            <form id="calculator-form" class="space-y-4">
                <div>
                    <label for="order-method" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Yöntemi</label>
                    <div class="relative mb-4">
                        <i class="ri-shopping-bag-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="order-method" class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm">
                            <option value="" disabled selected>Sipariş yöntemi seçin</option>
                            <option value="self">Ürünü ben sipariş edeceğim, sadece kargo hizmeti istiyorum</option>
                            <option value="service">Ürünü benim yerime siz sipariş edin, size ödeme yapacağım</option>
                        </select>
                        <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <div>
                        <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki</label>
                        <div class="relative">
                            <i class="ri-link ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <input type="url" id="product-link" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="https://www.example.com/urun">
                        </div>
                    </div>
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)</label>
                    <div class="relative">
                        <i class="ri-money-lira-circle-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="number" id="product-price" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="0.00">
                    </div>
                </div>
                <div>
                    <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                    <div class="relative">
                        <i class="ri-price-tag-3-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="product-category" class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm">
                            <option value="" disabled selected>Kategori seçin</option>
                            <option value="furniture">Mobilya</option><option value="electronics">Elektronik</option><option value="clothing">Giyim</option><option value="cosmetics">Kozmetik</option><option value="stationery">Kırtasiye</option>
                        </select>
                        <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
                <div>
                    <span class="block text-sm font-medium text-gray-700 mb-2">Teslimat Tipi</span>
                    <div class="flex space-x-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery-type" value="warehouse" class="sr-only" checked>
                            <div class="w-5 h-5 border border-gray-300 rounded-full flex items-center justify-center mr-2 delivery-radio"><div class="w-3 h-3 bg-primary rounded-full hidden"></div></div>
                            <span class="text-sm">Depodan teslim</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery-type" value="home" class="sr-only">
                            <div class="w-5 h-5 border border-gray-300 rounded-full flex items-center justify-center mr-2 delivery-radio"><div class="w-3 h-3 bg-primary rounded-full hidden"></div></div>
                            <span class="text-sm">Eve teslim</span>
                        </label>
                    </div>
                </div>
                <div id="city-selection" class="hidden">
                    <label for="city" class="block text-sm font-medium text-gray-700 mb-1">Şehir</label>
                    <div class="relative">
                        <i class="ri-map-pin-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <select id="city" class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm">
                            <option value="" disabled selected>Şehir seçin</option>
                            <option value="lefkosa">Lefkoşa</option><option value="girne">Girne</option><option value="magusa">Gazimağusa</option><option value="guzelyurt">Güzelyurt</option><option value="iskele">İskele</option>
                        </select>
                        <i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
                <button type="submit" id="form-calculate-btn" class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors cursor-pointer !rounded-button">Hesapla</button>
            </form>
            <div id="calculation-result" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                <h4 class="font-medium text-gray-800 mb-2">Hesaplama Sonucu</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between"><span>Ürün Fiyatı:</span><span id="result-price">0 ₺</span></div>
                    <div class="flex justify-between"><span>Kategori Ücreti:</span><span id="result-category-fee">0 ₺</span></div>
                    <div class="flex justify-between" id="result-city-row"><span>Teslimat Ücreti:</span><span id="result-delivery-fee">0 ₺</span></div>
                    <div class="flex justify-between font-medium text-primary pt-2 border-t border-gray-200"><span>Toplam:</span><span id="result-total">0 ₺</span></div>
                </div>
            </div>
        </div>
        </main>

    <div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] hidden">
        <div class="bg-white rounded-lg p-6 w-[320px] relative">
            <button id="close-login-modal" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 cursor-pointer"><i class="ri-close-line ri-lg"></i></button>
            <div class="text-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">Giriş Yap</h3>
                <p class="text-sm text-gray-600 mt-1">Hizmetlerimizi kullanmak için giriş yapın</p>
            </div>
            <button id="google-login-btn" class="w-full flex items-center justify-center gap-2 border border-gray-300 rounded-button py-3 font-medium hover:bg-gray-50 transition-colors cursor-pointer">
                <i class="ri-google-fill ri-lg text-primary"></i>
                <span>Google ile Giriş Yap</span>
            </button>
        </div>
    </div>
    <div id="auth-required-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] hidden">
        <div class="bg-white rounded-lg p-6 w-[320px]">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="ri-lock-line ri-2x text-red-500"></i></div>
                <h3 class="text-xl font-semibold text-gray-800">Giriş Gerekli</h3>
                <p class="text-sm text-gray-600 mt-2">Bu özelliği kullanmak için lütfen giriş yapın.</p>
            </div>
            <button id="auth-login-btn" class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors cursor-pointer !rounded-button">Giriş Yap</button>
            <button id="close-auth-modal" class="w-full text-gray-600 py-2 mt-2 font-medium hover:text-gray-800 transition-colors cursor-pointer">Kapat</button>
        </div>
    </div>
    <div id="toast" class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-opacity duration-300 z-[100]"><span id="toast-message"></span></div>
    
    </div> <script type="module" id="auth-manager-script">
    // <--- Adım 1'deki Merkezi Kimlik Doğrulama Script'inin içeriğini BURAYA YAPIŞTIRIN --->
    // Firebase SDK importları
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut as firebaseSignOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // !! ÖNEMLİ: Kendi Firebase proje konfigürasyonunuzu buraya girin !!
    const firebaseConfig = {
        apiKey: "AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
        authDomain: "sizin-proje-id.firebaseapp.com",
        projectId: "sizin-proje-id",
        storageBucket: "sizin-proje-id.appspot.com",
        messagingSenderId: "sizin-mesajlasma-id",
        appId: "sizin-app-id",
        measurementId: "G-XXXXXXXXXX" 
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const loginBtnHeader = document.getElementById('login-btn-header');
    const profileContainerHeader = document.getElementById('profile-container-header');
    const profileImgHeader = document.getElementById('profile-img-header');
    const profileNameHeader = document.getElementById('profile-name-header');
    const loginModal = document.getElementById('login-modal');
    const googleLoginBtnModal = document.getElementById('google-login-btn');
    const closeLoginModalBtn = document.getElementById('close-login-modal');
    const authRequiredModal = document.getElementById('auth-required-modal');
    const authModalLoginBtn = document.getElementById('auth-login-btn');
    const authModalCloseBtn = document.getElementById('close-auth-modal');

    let currentFirebaseUser = null; 

    onAuthStateChanged(auth, (user) => {
        currentFirebaseUser = user;
        if (user) {
            if (loginBtnHeader) loginBtnHeader.classList.add('hidden');
            if (profileContainerHeader) {
                profileContainerHeader.classList.remove('hidden');
                profileContainerHeader.classList.add('flex'); 
                if (profileImgHeader) {
                    profileImgHeader.src = user.photoURL || 'https://via.placeholder.com/40';
                    profileImgHeader.alt = user.displayName || 'Profil';
                }
                if (profileNameHeader) {
                    profileNameHeader.textContent = user.displayName ? user.displayName.split(' ')[0] : (user.email ? user.email.split('@')[0] : "Profil");
                }
            }
            if (typeof window.onUserLoggedIn === 'function') window.onUserLoggedIn(user);
        } else {
            if (loginBtnHeader) loginBtnHeader.classList.remove('hidden');
            if (profileContainerHeader) {
                profileContainerHeader.classList.add('hidden');
                profileContainerHeader.classList.remove('flex');
            }
            if (profileNameHeader) profileNameHeader.textContent = '';
            if (typeof window.onUserLoggedOutOnProtectedPage === 'function') window.onUserLoggedOutOnProtectedPage();
        }
    });

    async function signInWithGoogle() { /* ... (Adım 1'deki gibi) ... */ }
    async function signOutUser() { /* ... (Adım 1'deki gibi) ... */ }

    // Event Listeners (Adım 1'deki gibi)
    if (loginBtnHeader) loginBtnHeader.addEventListener('click', () => loginModal && loginModal.classList.remove('hidden'));
    if (profileContainerHeader) profileContainerHeader.addEventListener('click', signOutUser);
    if (googleLoginBtnModal) googleLoginBtnModal.addEventListener('click', signInWithGoogle);
    if (closeLoginModalBtn) closeLoginModalBtn.addEventListener('click', () => loginModal && loginModal.classList.add('hidden'));
    if (authModalLoginBtn) authModalLoginBtn.addEventListener('click', () => { authRequiredModal && authRequiredModal.classList.add('hidden'); loginModal && loginModal.classList.remove('hidden'); });
    if (authModalCloseBtn) authModalCloseBtn.addEventListener('click', () => authRequiredModal && authRequiredModal.classList.add('hidden'));
    
    window.isUserLoggedIn = function() { return !!auth.currentUser; };
    window.getCurrentUserId = function() { return auth.currentUser ? auth.currentUser.uid : null; };
    window.triggerAuthModal = function() { /* ... (Adım 1'deki gibi) ... */};

    // Protected Links/Buttons on index.html
    const protectedActionButtons = [
        document.getElementById('order-btn'), 
        document.getElementById('my-orders-btn'),
        document.getElementById('track-btn')
    ];
    protectedActionButtons.forEach(button => {
        if (button && button.tagName === 'A') { // Sadece link olanları kontrol et
            button.addEventListener('click', function(e) {
                if (!window.isUserLoggedIn()) {
                    e.preventDefault();
                    window.triggerAuthModal();
                }
            });
        }
    });
    
    // Ana ızgaradaki "Hesapla" butonu (id="calculate-btn")
    const calculateBtnGrid = document.getElementById('calculate-btn');
    if (calculateBtnGrid) {
        calculateBtnGrid.addEventListener('click', function() {
            if(typeof window.toggleCalculatorSection === 'function') {
                window.toggleCalculatorSection();
            } else {
                console.error("toggleCalculatorSection fonksiyonu bulunamadı.");
            }
        });
    }
</script>

<script id="calculator-script">
    // <--- index.html için bir önceki yanıttaki GÜNCELLENMİŞ calculator-script içeriğini BURAYA YAPIŞTIRIN --->
    // Bu script, formCalculateBtn'in davranışını, sessionStorage'ı ve toggleCalculatorSection'ı yönetir.
    // Örnek: document.addEventListener('DOMContentLoaded', function() { ... (bir önceki yanıttaki gibi) ... });
    document.addEventListener('DOMContentLoaded', function() {
    const calculatorSection = document.getElementById('calculator-section');
    const calculatorForm = document.getElementById('calculator-form');
    const formCalculateBtn = document.getElementById('form-calculate-btn'); 
    const citySelection = document.getElementById('city-selection');
    const deliveryRadios = document.querySelectorAll('input[name="delivery-type"]');
    const calculationResultDiv = document.getElementById('calculation-result');
    const resultCityRow = document.getElementById('result-city-row');

    window.toggleCalculatorSection = function() {
        const currentlyHidden = calculatorSection.classList.contains('hidden');
        calculatorSection.classList.toggle('hidden');
        if (!currentlyHidden) { 
            if (formCalculateBtn && formCalculateBtn.dataset.action === 'navigateToOrder') {
                formCalculateBtn.textContent = 'Hesapla';
                formCalculateBtn.type = 'submit';
                delete formCalculateBtn.dataset.action;
                sessionStorage.removeItem('calculatorInputs');
                sessionStorage.removeItem('calculatedOrderData');
                if (calculationResultDiv) calculationResultDiv.classList.add('hidden');
            }
        } else { 
             if (calculationResultDiv && !calculationResultDiv.classList.contains('hidden')) {
                calculationResultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
             } else {
                calculatorSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
             }
        }
    };

    deliveryRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            document.querySelectorAll('.delivery-radio div').forEach(dot => dot.classList.add('hidden'));
            if (this.checked) {
                const radioDiv = this.parentElement.querySelector('.delivery-radio div');
                if (radioDiv) radioDiv.classList.remove('hidden');
            }
            citySelection.classList.toggle('hidden', this.value !== 'home');
        });
    });
    const initiallyCheckedRadio = document.querySelector('input[name="delivery-type"]:checked');
    if (initiallyCheckedRadio) {
        const radioDiv = initiallyCheckedRadio.parentElement.querySelector('.delivery-radio div');
        if (radioDiv) radioDiv.classList.remove('hidden');
        citySelection.classList.toggle('hidden', initiallyCheckedRadio.value !== 'home');
    }

    if (calculatorForm && formCalculateBtn) {
        calculatorForm.addEventListener('submit', function(e) {
            e.preventDefault(); 
            // ... (Hesaplama mantığı, sessionStorage'a kaydetme ve formCalculateBtn güncelleme - bir önceki yanıttaki gibi)
            const orderMethodElement = document.getElementById('order-method');
            const productLinkElement = document.getElementById('product-link');
            const productPriceElement = document.getElementById('product-price');
            const productCategoryElement = document.getElementById('product-category');
            const cityElement = document.getElementById('city');

            const orderMethod = orderMethodElement.value;
            const productLink = productLinkElement.value;
            const price = parseFloat(productPriceElement.value) || 0;
            const category = productCategoryElement.value;
            const deliveryType = document.querySelector('input[name="delivery-type"]:checked').value;
            const cityVal = cityElement.value;

            if (!orderMethod) { window.showToast && window.showToast('Lütfen sipariş yöntemi seçin'); return; }
            if (price <= 0) { window.showToast && window.showToast('Lütfen geçerli bir fiyat girin'); return; }
            if (!category) { window.showToast && window.showToast('Lütfen bir kategori seçin'); return; }
            if (deliveryType === 'home' && !cityVal) { window.showToast && window.showToast('Lütfen bir şehir seçin'); return; }

            const categoryRates = { 'furniture': 0.70, 'electronics': 0.70, 'clothing': 0.45, 'cosmetics': 0.70, 'stationery': 0.40 };
            const cityFees = { 'lefkosa': 200, 'girne': 350, 'magusa': 300, 'guzelyurt': 400, 'iskele': 450 };
            const categoryFee = price * (categoryRates[category] || 0);
            let deliveryFee = 0;
            if (deliveryType === 'home') { deliveryFee = cityFees[cityVal] || 0; }
            const total = price + categoryFee + deliveryFee;

            document.getElementById('result-price').textContent = `${price.toFixed(2)} ₺`;
            document.getElementById('result-category-fee').textContent = `${categoryFee.toFixed(2)} ₺`;
            document.getElementById('result-delivery-fee').textContent = `${deliveryFee.toFixed(2)} ₺`;
            document.getElementById('result-total').textContent = `${total.toFixed(2)} ₺`;
            resultCityRow.classList.toggle('hidden', deliveryType !== 'home');
            calculationResultDiv.classList.remove('hidden');
            calculationResultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            const calculatedData = { orderMethod, productLink, price, category, deliveryType, city: deliveryType === 'home' ? cityVal : null, categoryFee, deliveryFee, total };
            const formDataForNextPage = { orderMethod, productLink, productPrice: productPriceElement.value, productCategory: category, deliveryType, city: cityVal };
            sessionStorage.setItem('calculatedOrderData', JSON.stringify(calculatedData));
            sessionStorage.setItem('calculatorInputs', JSON.stringify(formDataForNextPage));

            formCalculateBtn.textContent = 'Sipariş Ver';
            formCalculateBtn.type = 'button'; 
            formCalculateBtn.dataset.action = 'navigateToOrder';
        });

        formCalculateBtn.addEventListener('click', function() {
            if (this.type === 'button' && this.dataset.action === 'navigateToOrder') {
                if (typeof window.isUserLoggedIn === 'function' && !window.isUserLoggedIn()) {
                    if (typeof window.triggerAuthModal === 'function') window.triggerAuthModal();
                    else alert("Bu işlem için giriş yapmanız gerekmektedir.");
                } else {
                    const calculatedDataExists = sessionStorage.getItem('calculatedOrderData');
                    if (!calculatedDataExists) {
                        window.showToast && window.showToast('Lütfen önce bir hesaplama yapın.');
                        this.textContent = 'Hesapla'; this.type = 'submit'; delete this.dataset.action;
                        if(document.getElementById('calculator-section').classList.contains('hidden')) window.toggleCalculatorSection();
                        return;
                    }
                    window.location.href = 'siparisver.html';
                }
            }
        });
    }
});
</script>

<script id="utils-script">
    // <--- index.html için utils-script içeriği (showToast, copyButtons) BURAYA YAPIŞTIRIN --->
    // Örnek: document.addEventListener('DOMContentLoaded', function() { window.showToast = function() { ... }; ... });
    document.addEventListener('DOMContentLoaded', function() {
    window.showToast = function(message) {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        if (!toast || !toastMessage) { console.error("Toast elements not found!"); return; }
        toastMessage.textContent = message;
        toast.classList.remove('opacity-0'); toast.classList.add('opacity-100');
        setTimeout(() => { toast.classList.remove('opacity-100'); toast.classList.add('opacity-0'); }, 3000);
    };
    const copyButtons = document.querySelectorAll('.copy-btn');
    copyButtons.forEach(button => { /* ... (kopyalama butonu listener'ı) ... */ });
});
</script>
</body>
</html>

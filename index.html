<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye'den Kıbrıs'a Sipariş Getirme Hizmeti | Getir Kıbrıs</title>
    <meta name="description" content="Trendyol, Hepsiburada ve diğer Türkiye sitelerinden Kıbrıs'a kolayca ürün getirin. Hesaplayın ve sepetinize ekleyin.">
    <link rel="canonical" href="https://getirkibris.com" />
    <link rel="icon" href="/favicon.ico?v=2" type="image/x-icon">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" rel="stylesheet">

    <script>
        // Tailwind CSS Konfigürasyonu
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5d3ebc',
                        secondary: '#ffd300'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    borderRadius: {
                        'button': '8px',
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9f9f9;
        }
        .copy-btn:active, .auth-button:active {
            transform: scale(0.95);
        }
        /* Animasyonlar */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hidden {
            display: none;
        }

        /* Kullanıcının index (22).html'den eklediği CSS kuralı */
        :where([class^="ri-"])::before {
            content: "\f3c2";
        }
    </style>
</head>
<body class="bg-gray-50">

<div class="w-full max-w-screen-lg mx-auto relative min-h-screen pb-16">

    <header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex items-center">
        <div class="flex-1">
        </div>
        <div class="flex flex-col items-center">
            <img src="logom.png" alt="Getir Kıbrıs" class="h-12">
            <a href="https://getirkibris.com/index.html" data-readdy="true"
                class="text-sm font-medium text-primary mt-1">Ana Sayfa</a>
        </div>
        <div class="flex-1 flex justify-end">
            <div id="auth-button" class="w-8 h-8 flex items-center justify-center">
                <button id="login-btn" class="text-xs text-primary font-medium cursor-pointer">
                    <i class="ri-google-fill ri-lg"></i>
                </button>
                <div id="profile-container" class="hidden">
                    <img id="profile-img" src="" alt="Profil" class="w-8 h-8 rounded-full cursor-pointer">
                </div>
            </div>
        </div>
    </header>

    <main class="pt-16 pb-20">
        <div class="relative w-full h-64 sm:h-80 lg:h-[450px] overflow-hidden mb-6">
            <video class="w-full h-full object-cover" controls
                poster="https://readdy.ai/api/search-image?query=online%20shopping%20and%20delivery%20service%2C%20modern%20lifestyle%2C%20soft%20lighting%2C%20clean%20background%2C%20banner%20image&width=800&height=400&seq=1&orientation=landscape">
                <source src="https://public.readdy.ai/assets/sample.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="absolute inset-0 bg-gradient-to-t from-primary/70 to-transparent pointer-events-none"></div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 px-4 mb-8">
            <button id="calculate-btn"
                class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div
                    class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2">
                    <i class="ri-calculator-line ri-xl text-primary"></i>
                </div>
                <span class="text-sm font-medium">Hesapla</span>
            </button>

            <a href="https://getirkibris.com/sepet.html" id="cart-page-btn"
                class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-32 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
                <div
                    class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-2">
                    <i class="ri-shopping-cart-line ri-xl text-primary"></i>
                </div>
                <span class="text-sm font-medium">Sepetim</span>
                <span id="cart-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center hidden" style="top: 10px; right: 10px;">0</span>
            </a>
        </div>

        <section id="calculator-section" class="bg-white rounded-lg shadow-lg mx-auto p-6 mb-8 max-w-2xl fade-in hidden">
            <h2 class="text-xl font-semibold mb-4 text-primary">Ürün Maliyeti Hesapla</h2>
            <form id="calculator-form" class="space-y-4">
                <div>
                    <label for="order-method" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Yöntemi<span class="text-red-500">*</span></label>
                    <select id="order-method" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm">
                        <option value="service" selected>Ürünü benim yerime siz sipariş edin</option>
                        <option value="self">Ürünü ben alacağım, sadece kargo hizmeti istiyorum</option>
                    </select>
                </div>
                <div>
                    <label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki<span class="text-red-500">*</span></label>
                    <input type="url" id="product-link" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="https://www.example.com/urun">
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)<span class="text-red-500">*</span></label>
                    <input type="number" id="product-price" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50" placeholder="150.00" step="any" min="0.01">
                </div>
                <div>
                    <label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori<span class="text-red-500">*</span></label>
                    <select id="product-category" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 text-sm">
                        <option value="" disabled selected>Kategoriler Yükleniyor...</option>
                    </select>
                </div>
                
                <div id="calculation-result" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
                    <h3 class="font-medium text-gray-800 mb-2">Ürün Getirme Maliyeti</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span id="result-price-label">Ürün Fiyatı:</span>
                            <span id="result-price">0 ₺</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Kategori Hizmet Bedeli:</span>
                            <span id="result-category-fee">0 ₺</span>
                        </div>
                        <div class="flex justify-between font-bold text-primary pt-2 border-t border-gray-200">
                            <span>Getirme Dahil Toplam:</span>
                            <span id="result-total">0 ₺</span>
                        </div>
                    </div>
                </div>

                <button type="submit" id="main-action-btn" class="w-full bg-primary text-white py-3 rounded-button font-semibold hover:bg-primary/90 transition-colors cursor-pointer flex items-center justify-center gap-2">
                    <i class="ri-calculator-line"></i>
                    <span>Maliyeti Hesapla</span>
                </button>
            </form>
        </section>

        <div class="px-4 mb-8">
            <h3 class="text-lg font-semibold mb-4">Popüler Alışveriş Siteleri</h3>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                <a href="https://www.trendyol.com" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=trendyol%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=2&orientation=squarish"
                        alt="Trendyol" class="w-16 h-16 object-contain">
                </a>
                <a href="https://www.hepsiburada.com" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=hepsiburada%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=3&orientation=squarish"
                        alt="Hepsiburada" class="w-16 h-16 object-contain">
                </a>
                <a href="https://www.n11.com" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=n11%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=4&orientation=squarish"
                        alt="N11" class="w-16 h-16 object-contain">
                </a>
                <a href="https://www.amazon.com.tr" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=amazon%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=5&orientation=squarish"
                        alt="Amazon" class="w-16 h-16 object-contain">
                </a>
                <a href="https://www.ciceksepeti.com" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=ciceksepeti%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=6&orientation=squarish"
                        alt="ÇiçekSepeti" class="w-16 h-16 object-contain">
                </a>
                <a href="https://www.gittigidiyor.com" target="_blank"
                    class="bg-white rounded-lg shadow-sm p-3 h-20 flex items-center justify-center cursor-pointer border border-gray-100">
                    <img src="https://readdy.ai/api/search-image?query=gittigidiyor%20logo%2C%20simple%2C%20clean%2C%20isolated%20on%20white%20background%2C%20centered%20composition&width=100&height=100&seq=7&orientation=squarish"
                        alt="GittiGidiyor" class="w-16 h-16 object-contain">
                </a>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md mx-4 p-4 mb-8">
            <h3 class="text-lg font-semibold mb-4">Nasıl Çalışır?</h3>
            <ol class="list-decimal pl-5 space-y-3 text-sm text-gray-700">
                <li>Türkiye'deki herhangi bir siteden ürün seçin ve fiyatını hesaplayın.</li>
                <li>Sipariş formunu doldurun ve ödemenizi yapın.</li>
                <li>Ürünü kendi adınıza sipariş edin ve aşağıdaki teslimat adresini kullanın.</li>
            </ol>
            <div class="mt-4 p-3 bg-gray-50 rounded-lg relative">
                <h4 class="text-sm font-medium mb-1">Teslimat Adresi</h4>
                <p id="delivery-address" class="text-sm text-gray-700 pr-8">Getir Kıbrıs Depo, Mersin 10, Türkiye</p>
                <button class="copy-btn absolute top-3 right-3 w-6 h-6 flex items-center justify-center text-primary cursor-pointer"
                    data-copy="delivery-address">
                    <i class="ri-file-copy-line ri-lg"></i>
                </button>
            </div>
            <div class="mt-3 p-3 bg-gray-50 rounded-lg relative">
                <h4 class="text-sm font-medium mb-1">IBAN Bilgisi</h4>
                <p id="iban-info" class="text-sm text-gray-700 pr-8">TR12 3456 7890 1234 5678 9012 34</p>
                <button class="copy-btn absolute top-3 right-3 w-6 h-6 flex items-center justify-center text-primary cursor-pointer"
                    data-copy="iban-info">
                    <i class="ri-file-copy-line ri-lg"></i>
                </button>
            </div>
            <div class="mt-6">
                <h4 class="text-lg font-semibold mb-4">İletişim Bilgileri</h4>
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 flex items-center justify-center text-primary">
                            <i class="ri-map-pin-2-line"></i>
                        </div>
                        <div>
                            <h5 class="font-medium text-gray-800">Adres</h5>
                            <p class="text-sm text-gray-600">Şehit Mustafa Ruso Caddesi, No:86, Lefkoşa, KKTC</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 flex items-center justify-center text-primary">
                            <i class="ri-phone-line"></i>
                        </div>
                        <div>
                            <h5 class="font-medium text-gray-800">Telefon</h5>
                            <p class="text-sm text-gray-600">+90 392 123 45 67</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <div class="w-6 h-6 flex items-center justify-center text-primary">
                            <i class="ri-mail-line"></i>
                        </div>
                        <div>
                            <h5 class="font-medium text-gray-800">E-posta</h5>
                            <p class="text-sm text-gray-600">info@getirkibris.com</p>
                        </div>
                    </div>
                </div>
                <div class="mt-6 relative">
                    <div class="absolute top-4 left-4 z-10 bg-white px-4 py-2 rounded-lg shadow-md">
                        <h5 class="font-medium text-gray-800">Kıbrıs Adresimiz</h5>
                    </div>
                    <div class="w-full h-64 sm:h-80 lg:h-96 rounded-lg overflow-hidden">
                        <a href="https://www.google.com/maps/place/Pufemo/@35.2265014,33.4637806,17z/data=!3m1!4b1!4m6!3m5!1s0x14de3f74e0864075:0x5fa8b6333def3eb!8m2!3d35.2265014!4d33.4637806!16s%2Fg%2F11x5__k07t?entry=ttu&g_ep=EgoyMDI1MDUyOC4wIKXMDSoASAFQAw%3D%3D" data-readdy="true" target="_blank">
                            <img src="https://public.readdy.ai/gen_page/map_placeholder_1280x720.png" alt="Harita"
                                class="w-full h-full object-cover">
                        </a>
                    </div>
                </div>
                <div class="mt-8 space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-4">Alışveriş İşlemleri</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-shopping-cart-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">Sipariş Verme</h5>
                                        <p class="text-sm text-gray-600 mt-1">Türkiye'deki herhangi bir e-ticaret
                                            sitesinden ürün seçin, sipariş formunu doldurun ve ödemenizi yapın.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-calculator-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">Maliyet Hesaplama</h5>
                                        <p class="text-sm text-gray-600 mt-1">Ürün fiyatı ve kategorisine göre toplam
                                            maliyeti hesaplayın, ek ücretleri önceden öğrenin.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-4">Teslimat ve Takip</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-truck-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">Kargo Takibi</h5>
                                        <p class="text-sm text-gray-600 mt-1">Siparişinizin durumunu anlık olarak
                                            takip edin, teslimat sürecini kontrol edin.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-map-pin-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">Teslimat Seçenekleri</h5>
                                        <p class="text-sm text-gray-600 mt-1">Depodan teslim veya adrese teslimat
                                            seçeneklerinden size uygun olanı seçin.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-4">Müşteri Hizmetleri</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-customer-service-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">7/24 Destek</h5>
                                        <p class="text-sm text-gray-600 mt-1">WhatsApp üzerinden bize ulaşın,
                                            sorularınızı yanıtlayalım, sorunlarınıza çözüm bulalım.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0">
                                        <i class="ri-file-list-3-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="font-medium text-gray-800">Sipariş Geçmişi</h5>
                                        <p class="text-sm text-gray-600 mt-1">Tüm siparişlerinizi görüntüleyin,
                                            geçmiş alışverişlerinizi kontrol edin.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <section class="px-4 py-6 text-center">
            <h1 class="text-2xl sm:text-4xl font-bold text-primary mb-4">Türkiye’den Kıbrıs’a Ürün Getirme Hizmeti</h1>
            <p class="text-lg text-gray-700">
                Getir Kıbrıs, Türkiye'deki online alışveriş sitelerinden verdiğiniz siparişleri sizin için Kuzey Kıbrıs’a ulaştırır.
                Trendyol, Hepsiburada, N11, Amazon gibi sitelerden aldığınız ürünleri uygun fiyatlarla teslim alırsınız.
            </p>
        </section>
    </main>

    <a href="https://wa.me/905391090879" target="_blank" data-readdy="true"
        class="fixed bottom-20 right-4 z-50 bg-[#25D366] w-12 h-12 rounded-full shadow-lg flex items-center justify-center hover:bg-[#20bd5a] transition-colors">
        <i class="ri-whatsapp-line ri-xl text-white"></i>
    </a>

    <div class="mt-8 px-4 pb-20 text-center">
        <div class="space-x-4">
            <a href="#" class="text-xs text-gray-600 hover:text-primary">Gizlilik Politikası</a>
            <a href="#" class="text-xs text-gray-600 hover:text-primary">Kullanım Şartları</a>
            <a href="#" class="text-xs text-gray-600 hover:text-primary">S.S.S.</a>
        </div>
    </div>

    <div id="login-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-[320px] relative">
            <button id="close-login-modal"
                class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 cursor-pointer">
                <i class="ri-close-line ri-lg"></i>
            </button>
            <div class="text-center mb-6">
                <h3 class="text-xl font-semibold text-gray-800">Giriş Yap</h3>
                <p class="text-sm text-gray-600 mt-1">Hizmetlerimizi kullanmak için giriş yapın</p>
            </div>
            <button id="google-login-btn"
                class="w-full flex items-center justify-center gap-2 border border-gray-300 rounded-button py-3 font-medium hover:bg-gray-50 transition-colors cursor-pointer">
                <i class="ri-google-fill ri-lg text-primary"></i>
                <span>Google ile Giriş Yap</span>
            </button>
        </div>
    </div>
    
    <div id="auth-required-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 w-[320px]">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ri-lock-line ri-2x text-red-500"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800">Giriş Gerekli</h3>
                <p class="text-sm text-gray-600 mt-2">Bu özelliği kullanmak için lütfen giriş yapın.</p>
            </div>
            <button id="auth-login-btn"
                class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors cursor-pointer !rounded-button">
                Giriş Yap
            </button>
            <button id="close-auth-modal"
                class="w-full text-gray-600 py-2 mt-2 font-medium hover:text-gray-800 transition-colors cursor-pointer">
                Kapat
            </button>
        </div>
    </div>

    <div id="toast"
        class="fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg opacity-0 transition-opacity duration-300 z-50">
        <span id="toast-message">Kopyalandı!</span>
    </div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script type="module"> // Firestore için module import gerekiyor, ancak compat versiyonları da kullanılıyor
    import { getFirestore, doc, getDoc, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    // Firebase App zaten global olarak başlatıldı (firebase.initializeApp)
    // Firestore ve Auth servislerini uyumlu API'lerle alın
    const auth = firebase.auth(); 
    const db = firebase.firestore();

    let cartUnsubscribe = null;

    // --- GLOBAL SETTINGS ---
    let pricingSettings = {};
    const DEFAULT_SETTINGS = {
        categoryRates: { 'furniture': 0.70, 'electronics': 0.70, 'clothing': 0.45, 'cosmetics': 0.70, 'stationery': 0.40 },
        // cityFees bu versiyonda kullanılmayacak, ancak ayarlar yapısında kalsın
        cityFees: { 'Lefkoşa': 0, 'Girne': 0, 'Gazimağusa': 0, 'Güzelyurt': 0, 'İskele': 0 }
    };

    // --- DOM Elements ---
    const loginBtn = document.getElementById('login-btn');
    const profileContainer = document.getElementById('profile-container');
    const profileImg = document.getElementById('profile-img');
    const loginModal = document.getElementById('login-modal');
    const closeLoginModal = document.getElementById('close-login-modal');
    const googleLoginBtn = document.getElementById('google-login-btn');
    const authRequiredModal = document.getElementById('auth-required-modal');
    const closeAuthModal = document.getElementById('close-auth-modal');
    const authLoginBtn = document.getElementById('auth-login-btn'); // Daha önce authModalLoginBtn idi
    // const profileModal kaldırıldı
    // const profileForm kaldırıldı
    const cartBadge = document.getElementById('cart-badge');

    // ---- SETTINGS LOADER ----
    async function loadPricingSettings() {
        try {
            const docRef = doc(db, "settings", "pricing");
            const docSnap = await getDoc(docRef);
            if (docSnap.exists() && docSnap.data().categoryRates) {
                pricingSettings = docSnap.data();
                console.log("Fiyat ayarları başarıyla yüklendi.");
            } else {
                pricingSettings = DEFAULT_SETTINGS;
                console.log("Fiyat ayarları bulunamadı, varsayılanlar kullanılıyor.");
            }
        } catch (error) {
            console.error("Fiyat ayarları yüklenirken hata oluştu:", error);
            pricingSettings = DEFAULT_SETTINGS;
        }
        populateCategoryDropdown();
    }

    function populateCategoryDropdown() {
        const categorySelect = document.getElementById('product-category');
        if (!categorySelect || !pricingSettings.categoryRates) return;
        
        categorySelect.innerHTML = '<option value="" disabled selected>Kategori seçin</option>';
        
        const categoryDisplayNames = {
            furniture: "Mobilya & Ev Eşyası",
            electronics: "Elektronik",
            clothing: "Giyim & Ayakkabı",
            cosmetics: "Kozmetik",
            stationery: "Kırtasiye & Kitap"
        };

        for (const categoryKey in pricingSettings.categoryRates) {
            const option = document.createElement('option');
            option.value = categoryKey;
            option.textContent = categoryDisplayNames[categoryKey] || categoryKey;
            categorySelect.appendChild(option);
        }
    }


    // ---- AUTHENTICATION ---- //
    onAuthStateChanged(auth, user => {
        updateAuthUI(user);
        if (user) {
            // checkUserProfile(user); // Artık profile completion modal yok
            listenToCart(user.uid);
        } else {
            if (cartUnsubscribe) cartUnsubscribe();
            cartBadge.classList.add('hidden');
        }
    });

    function updateAuthUI(user) {
        if (user) {
            loginBtn.classList.add('hidden');
            profileContainer.classList.remove('hidden');
            profileImg.src = user.photoURL || 'https://placehold.co/40x40/cccccc/000000?text=P';
            profileImg.alt = user.displayName || 'Profil';
        } else {
            loginBtn.classList.remove('hidden');
            profileContainer.classList.add('hidden');
        }
    }
    
    loginBtn.addEventListener('click', () => loginModal.classList.remove('hidden'));
    closeLoginModal.addEventListener('click', () => loginModal.classList.add('hidden'));
    profileContainer.addEventListener('click', async () => {
        if (confirm('Çıkış yapmak istediğinize emin misiniz?')) {
            await auth.signOut(); // Firebase 9 SDK signOut
            window.showToast('Başarıyla çıkış yapıldı.'); // window.showToast'u kullan
        }
    });
    
    googleLoginBtn.addEventListener('click', async () => {
        const provider = new firebase.auth.GoogleAuthProvider(); // Uyumlu API
        try {
            await auth.signInWithPopup(provider); // Uyumlu API
            loginModal.classList.add('hidden');
            window.showToast('Giriş başarılı!');
        } catch (error) {
            console.error("Google ile giriş hatası:", error);
            window.showToast('Giriş sırasında bir hata oluştu: ' + error.message, 'error');
        }
    });

    window.showAuthRequiredModal = () => authRequiredModal.classList.remove('hidden');
    closeAuthModal.addEventListener('click', () => authRequiredModal.classList.add('hidden'));
    authLoginBtn.addEventListener('click', () => {
        authRequiredModal.classList.add('hidden');
        loginModal.classList.remove('hidden');
    });

    // ---- CALCULATOR & CART ---- //
    const calculatorSection = document.getElementById('calculator-section'); // Yeni eklenen kısım
    const calculatorForm = document.getElementById('calculator-form');
    const mainActionBtn = document.getElementById('main-action-btn');
    const calculationResult = document.getElementById('calculation-result');

    // Gizli olan inputlar kaldırıldığı için bu elemanlar da kaldırıldı
    // const citySelection = document.getElementById('city-selection');
    // const deliveryRadios = document.querySelectorAll('input[name="delivery-type"]');
    // const resultCityRow = document.getElementById('result-city-row');
    // const commonOrderDetailsSection = document.getElementById('common-order-details-section');
    // const homeDeliveryAddressSection = document.getElementById('home-delivery-address-section');
    // const deliveryAddressInput = document.getElementById('delivery-address-input');
    // const fullNameInput = document.getElementById('full-name-input');
    // const phoneInput = document.getElementById('phone-input');

    const formInputs = calculatorForm.querySelectorAll('input, select');
    formInputs.forEach(input => input.addEventListener('input', resetCalculatorState));

    // Calculate butonu tıklandığında hesaplama bölümünü görünür yap
    const calculateBtnMain = document.getElementById('calculate-btn');
    calculateBtnMain.addEventListener('click', () => {
        calculatorSection.classList.remove('hidden');
        calculatorSection.scrollIntoView({ behavior: 'smooth' });
        resetCalculatorState(); // Formu sıfırla ve butonu Hesapla'ya getir
    });


    function resetCalculatorState() {
        // if (mainActionBtn.textContent.trim() !== 'Maliyeti Hesapla') { // Eski kontroldü, şimdi ikon da var
            mainActionBtn.innerHTML = `<i class="ri-calculator-line"></i><span>Maliyeti Hesapla</span>`;
            calculationResult.classList.add('hidden');
            // İletişim bilgileri ve adres alanları kaldırıldığı için resetleme de kaldırıldı
            // if (commonOrderDetailsSection) commonOrderDetailsSection.classList.add('hidden');
            // if (homeDeliveryAddressSection) homeDeliveryAddressSection.classList.add('hidden');
            // document.getElementById('full-name-input').removeAttribute('required');
            // document.getElementById('phone-input').removeAttribute('required');
            // document.getElementById('delivery-address-input').removeAttribute('required');
            // document.getElementById('city').removeAttribute('required');
        // }
    }
    
    calculatorForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const buttonText = mainActionBtn.textContent.trim(); // Metni doğrudan al

        if (buttonText === 'Maliyeti Hesapla') {
            handleCalculation();
        } else if (buttonText === 'Sepete Ekle') {
            await handleAddToCart();
        }
    });

    function handleCalculation() {
        const price = parseFloat(document.getElementById('product-price').value);
        const category = document.getElementById('product-category').value;
        const orderMethod = document.getElementById('order-method').value;

        if (isNaN(price) || price <= 0 || !category || !document.getElementById('product-link').value.trim()) {
            window.showToast('Lütfen tüm zorunlu alanları doğru doldurun.', 'error');
            return;
        }

        const categoryRates = pricingSettings.categoryRates || {};
        const categoryFee = price * (categoryRates[category] || 0);
        let total = (orderMethod === 'self') ? categoryFee : price + categoryFee;
        
        document.getElementById('result-price-label').textContent = orderMethod === 'self' ? 'Ürün Fiyatı (Size Ait):' : 'Ürün Fiyatı:';
        document.getElementById('result-price').textContent = `${price.toFixed(2)} ₺`;
        document.getElementById('result-category-fee').textContent = `${categoryFee.toFixed(2)} ₺`;
        // Teslimat ücreti kaldırıldığı için bu satır da kaldırıldı.
        // document.getElementById('result-delivery-fee').textContent = `${deliveryFee.toFixed(2)} ₺`;
        document.getElementById('result-total').textContent = `${total.toFixed(2)} ₺`;
        
        // Şehir satırı kaldırıldığı için bu kontrol de kaldırıldı.
        // if (deliveryType === 'home') {
        //     resultCityRow.classList.remove('hidden');
        // } else {
        //     resultCityRow.classList.add('hidden');
        // }

        calculationResult.classList.remove('hidden');
        mainActionBtn.innerHTML = `<i class="ri-shopping-cart-add-line"></i><span>Sepete Ekle</span>`;
    }

    async function handleAddToCart() {
        const user = auth.currentUser;
        if (!user) {
            window.showAuthRequiredModal();
            return;
        }
        const productData = {
            productLink: document.getElementById('product-link').value,
            productPrice: parseFloat(document.getElementById('product-price').value),
            category: document.getElementById('product-category').value,
            orderMethod: document.getElementById('order-method').value,
            quantity: 1,
            addedAt: firebase.firestore.FieldValue.serverTimestamp() // Firebase 9 SDK Timestamp
        };
        try {
            await addDoc(collection(db, 'users', user.uid, 'cart'), productData); // Firebase 9 SDK addDoc, collection
            window.showToast('Ürün başarıyla sepete eklendi!');
            calculatorForm.reset();
            resetCalculatorState();
            // Sepete ekledikten sonra sepet sayfasına yönlendir
            window.location.href = 'https://getirkibris.com/sepet.html'; 
        } catch (error) {
            console.error("Sepete ekleme hatası:", error);
            window.showToast('Ürün sepete eklenirken bir hata oluştu: ' + error.message, 'error');
        }
    }
    
    function listenToCart(userId) {
        if (cartUnsubscribe) cartUnsubscribe();
        const cartRef = collection(db, 'users', userId, 'cart'); // Firebase 9 SDK collection
        cartUnsubscribe = onSnapshot(cartRef, (snapshot) => { // Firebase 9 SDK onSnapshot
            const itemCount = snapshot.size;
            cartBadge.textContent = itemCount;
            cartBadge.classList.toggle('hidden', itemCount === 0);
        });
    }

    // `window.showToast` zaten var, bu nedenle çakışma olmaması için mevcut halini korudu
    // Diğer global utility fonksiyonları (copy-btn) de `window` objesine eklendiğinden sorun olmayacaktır.

    // Sayfa yüklendiğinde ayarları çek
    loadPricingSettings();

</script>

<script id="utils-script">
    document.addEventListener('DOMContentLoaded', function () {
        const copyButtons = document.querySelectorAll('.copy-btn');
        copyButtons.forEach(button => {
            button.addEventListener('click', function () {
                const targetId = this.getAttribute('data-copy');
                const textToCopy =
                    document.getElementById(targetId).textContent;
                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        window.showToast('Kopyalandı!');
                    })
                    .catch(err => {
                        window.showToast('Kopyalama başarısız');
                        console.error('Kopyalama hatası:', err);
                    });
            });
        });

        window.showToast = function (message) {
            const toast =
                document.getElementById('toast');
            const toastMessage =
                document.getElementById('toast-message');
            toastMessage.textContent = message;
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');

            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 3000);
        };
    });
</script>

</body>
</html>

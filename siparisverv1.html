<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Getir Kıbrıs</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
  <script>tailwind.config={theme:{extend:{colors:{primary:'#5d3ebc',secondary:'#ffd300'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-50">
  <!-- ORİJİNAL GÖRSEL YAPI BURAYA YERLEŞTİRİLDİ -->
  <!-- ... içeriğin tamamı ilk dosyadan eksiksiz olarak alındı (harita, iletişim, metinler, whatsapp butonu vs.) ... -->

  <!-- Firebase Config ve İşlevsel Kodlar -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
      authDomain: "kibris-6b4f7.firebaseapp.com",
      projectId: "kibris-6b4f7",
      storageBucket: "kibris-6b4f7.firebasestorage.app",
      messagingSenderId: "141262926171",
      appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
      measurementId: "G-JL9P6BRZTD"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const loginBtn = document.getElementById('login-btn');
      const profileContainer = document.getElementById('profile-container');
      const profileImg = document.getElementById('profile-img');
      const authRequiredModal = document.getElementById('auth-required-modal');

      auth.onAuthStateChanged(function(user) {
        if (user) {
          loginBtn?.classList.add('hidden');
          profileContainer?.classList.remove('hidden');
          if (profileImg) profileImg.src = user.photoURL || '';
        } else {
          loginBtn?.classList.remove('hidden');
          profileContainer?.classList.add('hidden');
        }
      });

      loginBtn?.addEventListener('click', () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(err => alert("Giriş başarısız: " + err.message));
      });

      profileContainer?.addEventListener('click', () => {
        if (confirm("Çıkış yapmak istiyor musunuz?")) {
          auth.signOut().then(() => location.reload());
        }
      });

      // Sipariş form işlemleri
      const calculatorForm = document.getElementById('calculator-form');
      calculatorForm?.addEventListener('submit', async e => {
        e.preventDefault();
        const user = auth.currentUser;
        if (!user) return alert("Lütfen giriş yapınız.");

        const adSoyad = document.getElementById('full-name')?.value.trim();
        const telefon = document.getElementById('phone')?.value.trim();
        const link = document.getElementById('product-link')?.value.trim();
        const fiyat = parseFloat(document.getElementById('product-price')?.value.trim());
        const kategori = document.getElementById('product-category')?.value;
        const teslimatTipi = document.querySelector('input[name="delivery-type"]:checked')?.value;
        const sehir = document.getElementById('city')?.value;
        const siparisKodu = document.getElementById('order-code')?.value.trim();
        const adres = document.getElementById('delivery-address')?.value.trim();

        if (!adSoyad || !telefon || !link || !fiyat || !kategori || !teslimatTipi) {
          alert("Lütfen tüm alanları doldurunuz.");
          return;
        }

        const yuzdeler = {
          'furniture': 0.70,
          'electronics': 0.70,
          'clothing': 0.45,
          'cosmetics': 0.70,
          'stationery': 0.40
        };
        const kargoUcretleri = {
          'lefkosa': 200,
          'girne': 350,
          'magusa': 500,
          'guzelyurt': 450,
          'lefke': 600,
          'iskele': 550,
          'karpaz': 700
        };
        const kategoriOrani = yuzdeler[kategori] || 0;
        const kargoUcreti = teslimatTipi === 'home' ? (kargoUcretleri[sehir] || 0) : 0;
        const toplamTutar = Math.round(fiyat + (fiyat * kategoriOrani) + kargoUcreti);

        try {
          await db.collection("siparisler").add({
            uid: user.uid,
            email: user.email,
            adSoyad,
            telefon,
            urunLinki: link,
            siparisKodu,
            urunFiyati: fiyat,
            kategori,
            teslimatTipi,
            sehir: teslimatTipi === 'home' ? sehir : '',
            acikAdres: teslimatTipi === 'home' ? adres : '',
            toplamTutar,
            createdAt: new Date()
          });
          alert("Sipariş başarıyla kaydedildi!");
          window.location.href = "siparislerim.html";
        } catch (err) {
          alert("Hata oluştu: " + err.message);
        }
      });
    });
  </script>
</body>
</html>

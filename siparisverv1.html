<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getir Kıbrıs</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#5d3ebc',secondary:'#ffd300'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
body {
font-family: 'Inter', sans-serif;
background-color: #f9f9f9;
}
.copy-btn:active {
transform: scale(0.95);
}
</style>
</head>
<body class="bg-gray-50">
<div class="w-[375px] mx-auto relative min-h-screen pb-16">
<!-- Header -->
<header class="fixed top-0 w-full bg-white shadow-sm z-50 px-4 py-3 flex justify-between items-center">
<div class="w-8"></div>
<div class="flex flex-col items-center">
<img src="https://static.readdy.ai/image/d4cf8783f5bb2724d5eb1b66ee82374b/8de9178d5e8d147b21dbfa093538290a.png" alt="Getir Kıbrıs" class="h-12">
<a href="https://readdy.ai/home/b800f715-acec-4575-acd1-66571f959c9d/d7d9a972-2df7-42c2-b175-27dcd3edda3a" data-readdy="true" class="text-primary font-medium text-sm mt-1">Sipariş Ver</a>
</div>
<div id="auth-button" class="w-8 h-8 flex items-center justify-center">
<button id="login-btn" class="text-xs text-primary font-medium cursor-pointer">
<i class="ri-google-fill ri-lg"></i>
</button>
<div id="profile-container" class="hidden">
<img id="profile-img" src="" alt="Profil" class="w-8 h-8 rounded-full cursor-pointer">
<button id="logout-btn" class="text-xs text-red-500 font-medium ml-2 cursor-pointer hidden">Çıkış</button>
</div>
</div>
</header>
<!-- Main Content -->
<main class="pt-24 pb-20">
<!-- Main Action Buttons -->
<div class="grid grid-cols-2 gap-4 px-4 mb-8">
<a href="#" id="calculate-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-36 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
<div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3">
<i class="ri-calculator-line ri-2x text-primary"></i>
</div>
<span class="text-base font-medium">Hesapla</span>
</a>
<a href="#" id="order-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-36 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
<div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3">
<i class="ri-home-line ri-2x text-primary"></i>
</div>
<span class="text-base font-medium">Ana Sayfa</span>
</a>
<a href="#" id="my-orders-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-36 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
<div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3">
<i class="ri-file-list-3-line ri-2x text-primary"></i>
</div>
<span class="text-base font-medium">Siparişlerim</span>
</a>
<a href="#" id="track-btn" class="bg-white shadow-md p-4 rounded-button flex flex-col items-center justify-center h-36 cursor-pointer border border-gray-100 hover:border-primary/20 transition-all">
<div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-3">
<i class="ri-truck-line ri-2x text-primary"></i>
</div>
<span class="text-base font-medium">Kargo Takip</span>
</a>
</div>
<!-- Calculator Section -->
<div id="calculator-section" class="bg-white rounded-lg shadow-md mx-4 p-4 mb-8">
<h3 class="text-lg font-semibold mb-4 text-primary">Sipariş Modülü</h3>
<!-- Sipariş Yönetimi Açılır Menü -->
<div class="mb-4">
  <button type="button" id="order-method-toggle" class="w-full text-left bg-gray-100 border border-gray-200 rounded-button px-4 py-3 flex items-center justify-between font-medium text-gray-800 hover:bg-gray-50 transition">
    <span>Sipariş Yönetimi</span>
    <i class="ri-arrow-down-s-line ml-2"></i>
  </button>
  <div id="order-method-menu" class="hidden mt-2 space-y-2">
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="radio" name="order-method" value="self" class="order-method-radio" />
      <span>Ürünü ben sipariş edeceğim, sadece kargo hizmeti istiyorum</span>
    </label>
    <label class="flex items-center gap-2 cursor-pointer">
      <input type="radio" name="order-method" value="service" class="order-method-radio" />
      <span>Ürünü benim yerime siz sipariş edin, size ödeme yapacağım</span>
    </label>
    <div id="order-code-row" class="mt-2 hidden">
      <label for="order-code" class="block text-sm font-medium text-gray-700 mb-1">Sipariş Kodunuz</label>
      <input type="text" id="order-code" name="order-code" class="w-full border border-gray-200 rounded-button px-3 py-2 focus:outline-none focus:border-primary" placeholder="Sipariş kodunuzu girin">
    </div>
  </div>
</div>
<form id="calculator-form" class="space-y-4" autocomplete="off">
<div>
<label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">Ad Soyad</label>
<div class="relative">
<i class="ri-user-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<input type="text" id="full-name" name="full-name" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="Ad Soyad" required>
</div>
</div>
<div>
<label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefon Numarası</label>
<div class="relative">
<i class="ri-phone-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<input type="tel" id="phone" name="phone" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="0533 123 4567" required>
</div>
</div>
<div>
<label for="product-link" class="block text-sm font-medium text-gray-700 mb-1">Ürün Linki</label>
<div class="relative">
<i class="ri-link ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<input type="url" id="product-link" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="https://www.example.com/urun" required>
</div>
</div>
<!-- Sipariş kodu ana formdan kaldırıldı, yukarıdaki açılır menüye taşındı -->
<div>
<label for="product-price" class="block text-sm font-medium text-gray-700 mb-1">Ürün Fiyatı (₺)</label>
<div class="relative">
<i class="ri-money-lira-circle-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<input type="number" id="product-price" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="0.00" min="1" required>
</div>
</div>
<div>
<label for="product-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
<div class="relative">
<i class="ri-price-tag-3-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<select id="product-category" class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm" required>
<option value="" disabled selected>Kategori seçin</option>
<option value="furniture">Mobilya</option>
<option value="electronics">Elektronik</option>
<option value="clothing">Giyim</option>
<option value="cosmetics">Kozmetik</option>
<option value="stationery">Kırtasiye</option>
</select>
<i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
</div>
</div>
<div>
<span class="block text-sm font-medium text-gray-700 mb-2">Teslimat Tipi</span>
<div class="flex space-x-4">
<label class="flex items-center cursor-pointer">
<input type="radio" name="delivery-type" value="warehouse" class="sr-only" checked>
<div class="w-5 h-5 border border-gray-300 rounded-full flex items-center justify-center mr-2 delivery-radio">
<div class="w-3 h-3 bg-primary rounded-full hidden"></div>
</div>
<span class="text-sm">Depodan teslim</span>
</label>
<label class="flex items-center cursor-pointer">
<input type="radio" name="delivery-type" value="home" class="sr-only">
<div class="w-5 h-5 border border-gray-300 rounded-full flex items-center justify-center mr-2 delivery-radio">
<div class="w-3 h-3 bg-primary rounded-full hidden"></div>
</div>
<span class="text-sm">Eve teslim</span>
</label>
</div>
</div>
<div id="city-selection" class="hidden">
<label for="city" class="block text-sm font-medium text-gray-700 mb-1">Şehir</label>
<div class="relative">
<i class="ri-building-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<select id="city" name="city" class="w-full pl-10 pr-10 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary appearance-none bg-white text-sm">
<option value="" disabled selected>Şehir seçin</option>
<option value="magusa">Mağusa</option>
<option value="lefkosa">Lefkoşa</option>
<option value="girne">Girne</option>
<option value="iskele">İskele</option>
<option value="guzelyurt">Güzelyurt</option>
<option value="lefke">Lefke</option>
<option value="karpaz">Karpaz</option>
</select>
<i class="ri-arrow-down-s-line ri-lg absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
</div>
<div id="delivery-address-input" class="hidden mt-4">
<label for="delivery-address" class="block text-sm font-medium text-gray-700 mb-1">Teslimat Adresi</label>
<div class="relative">
<i class="ri-map-pin-line ri-lg absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
<input type="text" id="delivery-address" name="delivery-address" class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-button focus:outline-none focus:border-primary" placeholder="Teslimat adresinizi girin">
</div>
</div>
</div>
<div class="form-actions flex gap-2">
<button type="button" class="w-full bg-primary text-white py-3 rounded-button font-medium hover:bg-primary/90 transition-colors cursor-pointer !rounded-button" id="calculate-btn2">
Hesapla
</button>
<button type="button" class="w-full bg-green-600 text-white py-3 rounded-button font-medium hover:bg-green-700 transition-colors cursor-pointer !rounded-button" id="submit-btn" style="display:none;">
Onayla
</button>
</div>
<div id="calculation-result" class="mt-6 p-4 bg-gray-50 rounded-lg hidden">
<h4 class="font-medium text-gray-800 mb-2">Hesaplama Sonucu</h4>
<div class="space-y-2 text-sm">
<div class="flex justify-between">
<span>Ürün Fiyatı:</span>
<span id="result-price">0 ₺</span>
</div>
<div class="flex justify-between">
<span>Kategori Ücreti:</span>
<span id="result-category-fee">0 ₺</span>
</div>
<div class="flex justify-between" id="result-city-row">
<span>Teslimat Ücreti:</span>
<span id="result-delivery-fee">0 ₺</span>
</div>
<div class="flex justify-between font-medium text-primary pt-2 border-t border-gray-200">
<span>Toplam:</span>
<span id="result-total">0 ₺</span>
</div>
</div>
</div>
<div id="error-info" class="mt-4 text-sm text-red-600 hidden"></div>
<div id="success-info" class="mt-4 text-sm text-green-700 hidden"></div>
</form>
</div>
<!-- ... (sayfanın geri kalanı değişmedi) -->
<!-- WhatsApp Button, Footer vb. aynı şekilde devam eder -->
<!-- ... -->
<script>
// Sipariş Yönetimi açılır menü ve seçenek işlevleri
document.addEventListener('DOMContentLoaded', function() {
  const orderMethodToggle = document.getElementById('order-method-toggle');
  const orderMethodMenu = document.getElementById('order-method-menu');
  const orderCodeRow = document.getElementById('order-code-row');
  const orderMethodRadios = document.querySelectorAll('.order-method-radio');

  // Açılır menü toggle
  orderMethodToggle.addEventListener('click', function() {
    orderMethodMenu.classList.toggle('hidden');
  });

  // Radio seçildiğinde kod kutusu göster/gizle
  orderMethodRadios.forEach(radio => {
    radio.addEventListener('change', function() {
      if (this.value === 'self') {
        orderCodeRow.classList.remove('hidden');
      } else {
        orderCodeRow.classList.add('hidden');
      }
    });
  });

  // Eğer sayfa yüklenmişken seçili "order-method" varsa onun için kutu aç
  const checkedOrderMethod = document.querySelector('input[name="order-method"]:checked');
  if (checkedOrderMethod && checkedOrderMethod.value === 'self') {
    orderCodeRow.classList.remove('hidden');
  }
});

// FIREBASE CONFIG (Kendi config'in ile değiştir)
// ... (mevcut Firebase ve diğer scriptler aynı şekilde devam eder)
// Ancak sipariş kodu ile ilgili kontroller güncellendi:
const firebaseConfig = {
  apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
  authDomain: "kibris-6b4f7.firebaseapp.com",
  projectId: "kibris-6b4f7",
  storageBucket: "kibris-6b4f7.firebasestorage.app",
  messagingSenderId: "141262926171",
  appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
  measurementId: "G-JL9P6BRZTD"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let user = null, toplamTutar = null;
// ... (auth ve navigasyon kodları aynı)

// Hesapla buton
document.getElementById('calculate-btn2').onclick = function() {
  const adSoyad = document.getElementById('full-name').value.trim();
  const telefon = document.getElementById('phone').value.trim();
  const urunLinki = document.getElementById('product-link').value.trim();
  // Sipariş yöntemi ve kodu
  let siparisYontemi = document.querySelector('input[name="order-method"]:checked');
  siparisYontemi = siparisYontemi ? siparisYontemi.value : "";
  const siparisKodu = document.getElementById('order-code-row').classList.contains('hidden')
    ? "" : document.getElementById('order-code').value.trim();
  const fiyat = parseFloat(document.getElementById('product-price').value.trim());
  const kategori = document.getElementById('product-category').value;
  const teslimat = document.querySelector('input[name="delivery-type"]:checked').value;
  const sehir = document.getElementById('city').value;
  const acikAdres = document.getElementById('delivery-address').value.trim();

  document.getElementById('error-info').classList.add('hidden');
  document.getElementById('success-info').classList.add('hidden');

  if (!adSoyad || !telefon) {
    document.getElementById('error-info').innerText = "Lütfen ad soyad ve telefon bilgilerinizi giriniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (!urunLinki || !fiyat || !kategori || !teslimat || !siparisYontemi) {
    document.getElementById('error-info').innerText = "Lütfen tüm alanları doldurunuz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (siparisYontemi === "self" && !siparisKodu) {
    document.getElementById('error-info').innerText = "Lütfen sipariş kodunuzu giriniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (teslimat === 'home' && !sehir) {
    document.getElementById('error-info').innerText = "Teslimat şehrini seçiniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (teslimat === 'home' && sehir && !acikAdres) {
    document.getElementById('error-info').innerText = "Teslimat adresinizi giriniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }

  let ekYuzde = categoryRates[kategori] || 0;
  let araFiyat = fiyat + (fiyat * ekYuzde);
  let kargo = 0;
  if (teslimat === 'home') {
    kargo = kargoUcretleri[sehir] || 0;
  }
  toplamTutar = Math.round(araFiyat + kargo);

  document.getElementById('result-price').textContent = `${fiyat.toFixed(2)} ₺`;
  document.getElementById('result-category-fee').textContent = `${(fiyat*ekYuzde).toFixed(2)} ₺`;
  document.getElementById('result-delivery-fee').textContent = `${kargo.toFixed(2)} ₺`;
  document.getElementById('result-total').textContent = `${toplamTutar.toFixed(2)} ₺`;
  if (teslimat === 'home') {
    document.getElementById('result-city-row').classList.remove('hidden');
  } else {
    document.getElementById('result-city-row').classList.add('hidden');
  }
  document.getElementById('calculation-result').classList.remove('hidden');
  document.getElementById('submit-btn').style.display = 'block';
};

// Onayla (sipariş gönder)
document.getElementById('submit-btn').onclick = async function() {
  const adSoyad = document.getElementById('full-name').value.trim();
  const telefon = document.getElementById('phone').value.trim();
  const urunLinki = document.getElementById('product-link').value.trim();
  let siparisYontemi = document.querySelector('input[name="order-method"]:checked');
  siparisYontemi = siparisYontemi ? siparisYontemi.value : "";
  const siparisKodu = document.getElementById('order-code-row').classList.contains('hidden')
    ? "" : document.getElementById('order-code').value.trim();
  const fiyat = parseFloat(document.getElementById('product-price').value.trim());
  const kategori = document.getElementById('product-category').value;
  const teslimat = document.querySelector('input[name="delivery-type"]:checked').value;
  const sehir = document.getElementById('city').value;
  const acikAdres = document.getElementById('delivery-address').value.trim();

  document.getElementById('error-info').classList.add('hidden');
  document.getElementById('success-info').classList.add('hidden');

  if (!adSoyad || !telefon) {
    document.getElementById('error-info').innerText = "Lütfen ad soyad ve telefon bilgilerinizi giriniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (!user) {
    document.getElementById('error-info').innerText = "Lütfen giriş yapınız.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (!urunLinki || !fiyat || !kategori || !teslimat || !siparisYontemi) {
    document.getElementById('error-info').innerText = "Lütfen tüm alanları doldurunuz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (siparisYontemi === "self" && !siparisKodu) {
    document.getElementById('error-info').innerText = "Lütfen sipariş kodunuzu giriniz.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (teslimat === 'home' && (!sehir || !acikAdres)) {
    document.getElementById('error-info').innerText = "Teslimat şehri ve açık adres gerekli.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }
  if (toplamTutar === null) {
    document.getElementById('error-info').innerText = "Lütfen önce Hesapla butonuna basınız.";
    document.getElementById('error-info').classList.remove('hidden');
    return;
  }

  document.getElementById('submit-btn').disabled = true;
  try {
    await db.collection("siparisler").add({
      uid: user.uid,
      email: user.email,
      adSoyad: adSoyad,
      telefon: telefon,
      urunLinki: urunLinki,
      siparisYontemi: siparisYontemi,
      siparisKodu: siparisYontemi === "self" ? siparisKodu : "",
      urunFiyati: fiyat,
      kategori,
      teslimatTipi: teslimat === 'home' ? 'Eve Teslim' : 'Depodan Teslim',
      sehir: teslimat === 'home' ? sehir : "",
      acikAdres: teslimat === 'home' ? acikAdres : "",
      toplamTutar,
      createdAt: new Date()
    });

    document.getElementById('success-info').innerText = "Siparişiniz başarıyla kaydedildi!";
    document.getElementById('success-info').classList.remove('hidden');
    document.getElementById('error-info').classList.add('hidden');
    document.getElementById('calculation-result').classList.add('hidden');

    setTimeout(() => {
      window.location.href = "siparislerim.html";
    }, 1500);

    document.getElementById('calculator-form').reset();
    citySelection.classList.add('hidden');
    deliveryAddressInput.classList.add('hidden');
    // Açılır menü ve kod satırını sıfırla
    document.getElementById('order-method-menu').classList.add('hidden');
    document.getElementById('order-code-row').classList.add('hidden');
    toplamTutar = null;
    document.getElementById('submit-btn').style.display = 'none';

  } catch (e) {
    document.getElementById('error-info').innerText = "Bir hata oluştu, lütfen tekrar deneyin.";
    document.getElementById('error-info').classList.remove('hidden');
  }
  document.getElementById('submit-btn').disabled = false;
};

// Form sıfırlama ve otomatik hata/success gizleme
Array.from(document.getElementById('calculator-form').elements).forEach(el=>{
  el.addEventListener('input', function() {
    document.getElementById('error-info').classList.add('hidden');
    document.getElementById('success-info').classList.add('hidden');
    document.getElementById('submit-btn').style.display = 'none';
    document.getElementById('calculation-result').classList.add('hidden');
    toplamTutar = null;
    // Sipariş yöntemi değiştiyse kodu da gizle
    if(el.name === "order-method") {
      document.getElementById('order-code-row').classList.add('hidden');
    }
  });
});

// IBAN kopyala
document.querySelectorAll('.copy-btn').forEach(button => {
  button.addEventListener('click', function() {
    const targetId = this.getAttribute('data-copy');
    const textToCopy = document.getElementById(targetId).textContent;
    navigator.clipboard.writeText(textToCopy)
    .then(() => {showToast('Kopyalandı!');})
    .catch(() => {showToast('Kopyalama başarısız');});
  });
});
function showToast(message) {
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toast-message');
  toastMessage.textContent = message;
  toast.classList.remove('opacity-0');
  setTimeout(() => {toast.classList.add('opacity-0');}, 3000);
}
</script>
</body>
</html>

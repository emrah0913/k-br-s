<!-- Kayıtlı Müşteriler açılır liste ve detaylı sipariş gösterimi entegre edildi! -->
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Paneli</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      background: #f7fafc;
      color: #232323;
      min-height: 100vh;
    }
    .admin-container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 12px 50px 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      color: #0094da;
      margin-bottom: 18px;
      font-size: 2.1rem;
      font-weight: 700;
      letter-spacing: -.5px;
      text-align: center;
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      align-items: center;
      margin-bottom: 30px;
      justify-content: center;
      width: 100%;
    }
    .toolbar input, .toolbar select {
      padding: 10px 14px;
      border-radius: 999px;
      border: 1.2px solid #ececec;
      font-size: 1rem;
      background: #f7fafc;
      margin-right: 0;
      outline: none;
      transition: border .13s;
    }
    .toolbar input:focus, .toolbar select:focus {
      border-color: #0094da;
    }
    .toolbar button {
      padding: 12px 22px;
      border-radius: 999px;
      border: none;
      font-weight: 700;
      background: #ffcb05;
      color: #232323;
      font-size: 1.07rem;
      box-shadow: 0 2px 16px rgba(255,203,5,0.10);
      cursor: pointer;
      transition: background .15s;
      margin-right: 0;
      margin-top: 4px;
    }
    .toolbar button:hover { background: #ffd940; }
    .toolbar .out-btn {
      background: #ee4949 !important;
      color: #fff !important;
      box-shadow: 0 2px 10px rgba(238,73,73,0.13);
      margin-left: 8px;
    }
    .toolbar .out-btn:hover { background: #d62d2d !important; }
    .summary-box {
      background: #fff;
      border-radius: 32px;
      padding: 20px 36px;
      margin-bottom: 28px;
      color: #0094da;
      font-weight: 700;
      font-size: 1.13rem;
      display: flex;
      gap: 38px;
      flex-wrap: wrap;
      box-shadow: 0 2px 24px rgba(0,0,0,0.07);
      width: 100%;
      max-width: 900px;
      justify-content: center;
    }
    .orders-card {
      width: 100%;
      max-width: 900px;
      background: #fff;
      border-radius: 32px;
      box-shadow: 0 2px 24px rgba(0,0,0,0.09);
      overflow: hidden;
      margin-bottom: 36px;
      padding: 0 0 12px 0;
    }
    .orders-table {
      width: 100%;
      border-collapse: collapse;
      background: transparent;
    }
    .orders-table th, .orders-table td {
      padding: 15px 10px;
      border-bottom: 1px solid #f2f2f2;
      font-size: 1.07rem;
      text-align: left;
      vertical-align: top;
    }
    .orders-table th {
      background: #f7fafc;
      color: #0094da;
      font-weight: 700;
      border-bottom: 2px solid #ececec;
      font-size: 1.08rem;
    }
    .orders-table tr:last-child td {
      border-bottom: none;
    }
    .status-select {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid #ececec;
      background: #eafdff;
      color: #0094da;
      font-weight: 700;
      font-size: 1rem;
      outline: none;
      transition: border .13s;
    }
    .status-select:focus {
      border-color: #0094da;
    }
    .delete-btn {
      background: #ffefef;
      color: #ee4949;
      border: none;
      border-radius: 999px;
      padding: 7px 18px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      transition: background .14s, color .14s;
    }
    .delete-btn:hover { background: #ee4949; color: #fff; }
    .modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.11);
      z-index: 10001;
      justify-content: center;
      align-items: center;
      transition: background .2s;
    }
    .modal {
      background: #fff;
      border-radius: 32px;
      padding: 32px 28px 22px 28px;
      min-width: 340px;
      box-shadow: 0 2px 24px rgba(0,0,0,0.11);
      text-align: left;
      max-width: 98vw;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .modal-close {
      position: absolute;
      right: 16px;
      top: 10px;
      background: none;
      border: none;
      color: #ee4949;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
    }
    .modal h2 {
      color: #0094da;
      margin-top: 0;
      margin-bottom: 18px;
      font-size: 1.32rem;
      font-weight: 700;
      letter-spacing: -.2px;
      text-align: center;
    }
    .google-btn {
      background: #fff;
      color: #444;
      border: 1.2px solid #ececec;
      font-weight: 700;
      font-family: inherit;
      border-radius: 999px;
      padding: 13px 28px;
      font-size: 1.13rem;
      cursor: pointer;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      margin: 0 auto 8px auto;
      transition: background .13s;
    }
    .google-btn:hover { background: #f7fafc; }
    .google-logo {
      width: 25px;
      height: 25px;
      display: inline-block;
    }
    .modal .error-msg {
      color: #ee4949;
      font-weight: 700;
      margin-top: 12px;
      font-size: 1rem;
      display: none;
      text-align: center;
    }
    .success-info {
      background: #e1f8e7;
      color: #24a85c;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
      font-size: 1.05rem;
      display: none;
      max-width: 350px;
    }
    .error-info {
      background: #ffeaea;
      color: #ee4949;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
      font-size: 1.05rem;
      display: none;
      max-width: 350px;
    }
    .customer-dropdown-list {
      width: 100%;
      max-width: 520px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 18px rgba(0,0,0,0.09);
      margin: 18px auto 0 auto;
      padding: 0;
      z-index: 10010;
      position: absolute;
      left: 0; right: 0;
      display: none;
    }
    .customer-dropdown-row {
      cursor: pointer;
      padding: 13px 28px;
      border-bottom: 1px solid #f1f1f1;
      font-size: 1.09rem;
      transition: background .13s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .customer-dropdown-row:hover {
      background: #f7fafc;
    }
    .customer-dropdown-details {
      padding: 14px 38px 18px 38px;
      background: #f7fafc;
      font-size: 1rem;
      color: #333;
      display: none;
    }
    .customer-dropdown-details ul {
      margin: 0 0 0 18px;
      padding: 0;
    }
    .customer-dropdown-details li {
      margin-bottom: 5px;
    }
    .show { display: block !important; }
    /* Müşteriler modalı */
    .customer-group {
      margin-bottom: 18px;
      background: #f7fafc;
      border-radius: 24px;
      padding: 16px 18px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.04);
    }
    .customer-group b {
      color: #0094da;
      font-size: 1.07rem;
    }
    .customer-group ul {
      margin: 8px 0 0 2px;
      padding-left: 18px;
      font-size: 1rem;
    }
    /* EK: Durum filtresi select'i için stil */
    .status-filter-select {
      padding: 10px 14px;
      border-radius: 999px;
      border: 1.2px solid #ececec;
      font-size: 1rem;
      background: #f7fafc;
      outline: none;
      transition: border .13s;
      min-width: 165px;
    }
    .status-filter-select:focus {
      border-color: #0094da;
    }
    @media (max-width: 900px) {
      .summary-box, .orders-card { max-width: 99vw; }
      .modal { min-width: 0; width: 99vw; }
      .orders-table th, .orders-table td { font-size: .99rem; }
      .toolbar { flex-direction: column; gap: 7px;}
      .customer-dropdown-list { max-width: 99vw; }
    }
    @media (max-width: 540px) {
      h1 { font-size: 1.18rem; }
      .modal { padding: 18px 4vw 12px 4vw; }
      .orders-card { padding:0; }
      .summary-box { padding:10px 5vw;}
      .toolbar input, .toolbar button { width: 98vw; }
    }
  </style>
</head>
<body>
  <!-- Google ile Giriş ekranı -->
  <div id="loginModal" class="modal-bg" style="display:flex;">
    <div class="modal">
      <h2>Google ile Giriş Yap</h2>
      <button class="google-btn" onclick="googleSignIn()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-logo" alt="Google">
        Google hesabı ile giriş yap
      </button>
      <div id="loginError" class="error-msg"></div>
    </div>
  </div>

  <div class="admin-container" style="display:none;" id="adminPanel">
    <h1>Admin Paneli</h1>
    <div class="toolbar" style="position:relative;">
      <input type="text" id="searchSiparisKodu" placeholder="Sipariş Kodu ile ara">
      <input type="text" id="searchMusteri" placeholder="Müşteri adı ile ara">
      <input type="date" id="startDate">
      <span style="color:#ececec;">—</span>
      <input type="date" id="endDate">
      <select id="statusFilter" class="status-filter-select">
        <option value="">Tüm Durumlar</option>
        <option value="Bekleniyor">Bekleniyor</option>
        <option value="Tr Depoda">Tr Depoda</option>
        <option value="Yüklendi">Yüklendi</option>
        <option value="Kıbrıs Depoda">Kıbrıs Depoda</option>
        <option value="Teslim Edildi">Teslim Edildi</option>
      </select>
      <button onclick="filterOrders()">Filtrele</button>
      <button onclick="clearFilters()">Temizle</button>
      <button onclick="toggleCustomersDropdown()">Kayıtlı Müşteriler</button>
      <button class="out-btn" onclick="adminLogout()">Çıkış Yap</button>
      <!-- Açılır müşteri listesi -->
      <div id="customersDropdown" class="customer-dropdown-list"></div>
    </div>
    <div class="summary-box" id="summaryBox">
      <span>Yükleniyor...</span>
    </div>
    <div class="success-info" id="successInfo"></div>
    <div class="error-info" id="errorInfo"></div>
    <div class="orders-card">
      <table class="orders-table" id="ordersTable">
        <thead>
          <tr>
            <th>Müşteri</th>
            <th>Sipariş Kodu</th>
            <th>Adres</th>
            <th>Telefon</th>
            <th>Kategori</th>
            <th>Toplam Tutar</th>
            <th>Durum</th>
            <th>İşlem</th>
          </tr>
        </thead>
        <tbody>
          <!-- Siparişler JS ile eklenecek -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Müşteriler Modalı (artık açılır listeden gösteriliyor, ister sil ister bırak) -->
  <div id="customersModal" class="modal-bg">
    <div class="modal" style="max-width:520px;">
      <button class="modal-close" onclick="closeCustomersModal()">&times;</button>
      <h2>Kayıtlı Müşteriler</h2>
      <div id="customersList">
        <!-- Müşteri bilgileri JS ile eklenecek -->
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
      authDomain: "kibris-6b4f7.firebaseapp.com",
      projectId: "kibris-6b4f7",
      storageBucket: "kibris-6b4f7.appspot.com",
      messagingSenderId: "141262926171",
      appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
      measurementId: "G-JL9P6BRZTD"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Google ile giriş fonksiyonu
    function googleSignIn() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          document.getElementById('loginModal').style.display = 'none';
          document.getElementById('adminPanel').style.display = '';
          document.getElementById('loginError').style.display = "none";
          loadOrders();
        })
        .catch((error) => {
          document.getElementById('loginError').innerText = "Giriş başarısız: " + error.message;
          document.getElementById('loginError').style.display = "";
        });
    }

    // Çıkış
    function adminLogout() {
      firebase.auth().signOut().then(() => {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('loginModal').style.display = 'flex';
        document.getElementById('successInfo').style.display = "none";
        document.getElementById('errorInfo').style.display = "none";
      });
    }

    // Oturum kontrolü (her sayfa yenilemede)
    auth.onAuthStateChanged(user => {
      if (user) {
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('adminPanel').style.display = '';
        loadOrders();
      } else {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('loginModal').style.display = 'flex';
      }
    });

    let allOrders = [];
    async function loadOrders() {
      document.querySelector("#summaryBox").innerHTML = "<span>Yükleniyor...</span>";
      const tbody = document.querySelector("#ordersTable tbody");
      tbody.innerHTML = "";
      allOrders = [];
      try {
        const snap = await db.collection("siparisler").orderBy("createdAt", "desc").get();
        snap.forEach(doc => {
          const data = doc.data();
          allOrders.push({ ...data, id: doc.id });
        });
        renderOrders(allOrders);
        renderSummary(allOrders);
      } catch(e) {
        tbody.innerHTML = `<tr><td colspan="8" style="color:#ee4949;font-weight:700;">Siparişler yüklenemedi.</td></tr>`;
        document.querySelector("#summaryBox").innerHTML = "Siparişler yüklenemedi!";
      }
    }
    function renderOrders(orders) {
      const tbody = document.querySelector("#ordersTable tbody");
      tbody.innerHTML = "";
      if(!orders.length) {
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;">Kayıt yok.</td></tr>`;
        return;
      }
      for(const o of orders) {
        tbody.innerHTML += `
          <tr>
            <td>${o.adSoyad || "-"}</td>
            <td>${o.siparisKodu || "-"}</td>
            <td>${o.sehir ? (o.sehir + "<br>" + (o.acikAdres||"")) : "-"}</td>
            <td>${o.telefon || "-"}</td>
            <td>${o.kategori || "-"}</td>
            <td>${o.toplamTutar ? o.toplamTutar + " TL" : "-"}</td>
            <td>
              <select class="status-select" data-id="${o.id}" onchange="updateStatus('${o.id}', this.value)">
                <option ${o.durum=="Bekleniyor"?'selected':''}>Bekleniyor</option>
                <option ${o.durum=="Tr Depoda"?'selected':''}>Tr Depoda</option>
                <option ${o.durum=="Yüklendi"?'selected':''}>Yüklendi</option>
                <option ${o.durum=="Kıbrıs Depoda"?'selected':''}>Kıbrıs Depoda</option>
                <option ${o.durum=="Teslim Edildi"?'selected':''}>Teslim Edildi</option>
              </select>
            </td>
            <td>
              <button class="delete-btn" onclick="deleteOrder('${o.id}')">Sil</button>
            </td>
          </tr>
        `;
      }
    }
    function renderSummary(orders) {
      // Kategori bazlı toplam tutar
      const summary = {};
      for(const o of orders) {
        if(!o.kategori || !o.toplamTutar) continue;
        if(!summary[o.kategori]) summary[o.kategori]=0;
        summary[o.kategori] += Number(o.toplamTutar);
      }
      let html = "";
      for(const k in summary) {
        html += `<span>${k}: <b>${summary[k]} TL</b></span>`;
      }
      document.getElementById('summaryBox').innerHTML = html || "<span>Kayıt yok.</span>";
    }
    // Durum güncelleme
    async function updateStatus(id, newStatus) {
      try {
        await db.collection("siparisler").doc(id).update({ durum: newStatus });
        document.getElementById('successInfo').innerText = "Durum güncellendi.";
        document.getElementById('successInfo').style.display = "";
        setTimeout(()=>document.getElementById('successInfo').style.display="none", 1300);
      } catch(e) {
        document.getElementById('errorInfo').innerText = "Durum güncellenemedi!";
        document.getElementById('errorInfo').style.display = "";
        setTimeout(()=>document.getElementById('errorInfo').style.display="none", 2000);
      }
    }
    // Sipariş silme
    async function deleteOrder(id) {
      if(!confirm("Siparişi silmek istediğinize emin misiniz?")) return;
      try {
        await db.collection("siparisler").doc(id).delete();
        loadOrders();
        document.getElementById('successInfo').innerText = "Sipariş silindi.";
        document.getElementById('successInfo').style.display = "";
        setTimeout(()=>document.getElementById('successInfo').style.display="none", 1300);
      } catch(e) {
        document.getElementById('errorInfo').innerText = "Sipariş silinemedi!";
        document.getElementById('errorInfo').style.display = "";
        setTimeout(()=>document.getElementById('errorInfo').style.display="none", 2000);
      }
    }
    // Filtreleme
    window.filterOrders = function() {
      let kod = document.getElementById('searchSiparisKodu').value.trim().toLowerCase();
      let musteri = document.getElementById('searchMusteri').value.trim().toLowerCase();
      let start = document.getElementById('startDate').value;
      let end = document.getElementById('endDate').value;
      let status = document.getElementById('statusFilter').value; // <-- EKLENDİ
      let filtered = allOrders.filter(o => {
        let ok = true;
        if(kod && !(o.siparisKodu||"").toLowerCase().includes(kod)) ok = false;
        if(musteri && !(o.email||"").toLowerCase().includes(musteri)) ok = false;
        if(start) {
          let d = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : (o.createdAt instanceof Date ? o.createdAt : null);
          if(!d || d < new Date(start)) ok = false;
        }
        if(end) {
          let d = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : (o.createdAt instanceof Date ? o.createdAt : null);
          if(!d || d > new Date(end + "T23:59:59")) ok = false;
        }
        if(status && (o.durum||"") !== status) ok = false; // <-- EKLENDİ
        return ok;
      });
      renderOrders(filtered);
      renderSummary(filtered);
    }
    window.clearFilters = function() {
      document.getElementById('searchSiparisKodu').value = "";
      document.getElementById('searchMusteri').value = "";
      document.getElementById('startDate').value = "";
      document.getElementById('endDate').value = "";
      document.getElementById('statusFilter').value = ""; // <-- EKLENDİ
      renderOrders(allOrders);
      renderSummary(allOrders);
    }

    // AÇILIR LİSTE KAYITLI MÜŞTERİLER BAŞLANGIÇ
    function toggleCustomersDropdown() {
      const dropdown = document.getElementById('customersDropdown');
      if(dropdown.style.display === "block") {
        dropdown.style.display = "none";
        dropdown.innerHTML = "";
        return;
      }
      // allOrders içinden müşteri haritası oluştur
      let musteriMap = {};
      for(const o of allOrders) {
        let key = (o.adSoyad || "-") + "___" + (o.telefon || "-");
        if(!musteriMap[key]) musteriMap[key] = [];
        musteriMap[key].push(o);
      }
      // HTML'i oluştur
      let idx = 0;
      let html = "";
      for(const key in musteriMap) {
        const [adSoyad, telefon] = key.split("___");
        html += `
          <div class="customer-dropdown-row" onclick="toggleCustomerDetailsRow(${idx})">
            <span><b>${adSoyad}</b></span>
            <span>${telefon}</span>
          </div>
          <div class="customer-dropdown-details" id="customerDropdownDetails${idx}">
          </div>
        `;
        idx++;
      }
      dropdown.innerHTML = html;
      dropdown.style.display = "block";
    }
    // Açılır müşteri detaylarını göster/gizle
    function toggleCustomerDetailsRow(idx) {
      const detailDiv = document.getElementById('customerDropdownDetails'+idx);
      if(!detailDiv) return;
      if(detailDiv.style.display === "block") {
        detailDiv.style.display = "none";
        detailDiv.innerHTML = "";
        return;
      }
      // Hangi müşteri?
      const dropdown = document.getElementById('customersDropdown');
      let rows = dropdown.querySelectorAll('.customer-dropdown-details');
      let key = Object.keys(getCustomerMap())[idx];
      let siparisler = getCustomerMap()[key];
      // Siparişleri listele
      let sipHtml = "";
      if(!siparisler || !siparisler.length) {
        sipHtml = `<i>Sipariş bulunamadı.</i>`;
      } else {
        sipHtml = `<ul>`;
        siparisler.forEach(sip => {
          sipHtml += `<li>
            <b>Kod:</b> ${sip.siparisKodu || "-"}&nbsp;
            <b>Kategori:</b> ${sip.kategori || "-"}&nbsp;
            <b>Ürün:</b> ${(sip.urun || "-")}&nbsp;
            <b>Tutar:</b> ${sip.toplamTutar ? sip.toplamTutar + " TL" : "-"}&nbsp;
            <b>Durum:</b> ${sip.durum || "-"}&nbsp;
            <b>Tarih:</b> ${
              sip.createdAt && sip.createdAt.toDate ? sip.createdAt.toDate().toLocaleDateString("tr-TR") :
              (sip.createdAt instanceof Date ? sip.createdAt.toLocaleDateString("tr-TR") : "-")
            }
            <br>
            <b>Adres:</b> ${sip.sehir ? (sip.sehir + " / " + (sip.acikAdres||"")) : "-"}
            <br>
            <b>Telefon:</b> ${sip.telefon || "-"}
          </li>`;
        });
        sipHtml += `</ul>`;
      }
      detailDiv.innerHTML = sipHtml;
      detailDiv.style.display = "block";
    }
    function getCustomerMap() {
      let musteriMap = {};
      for(const o of allOrders) {
        let key = (o.adSoyad || "-") + "___" + (o.telefon || "-");
        if(!musteriMap[key]) musteriMap[key] = [];
        musteriMap[key].push(o);
      }
      return musteriMap;
    }
    // AÇILIR LİSTE KAYITLI MÜŞTERİLER SON

    // Kayıtlı müşteriler eski modalı (artık kullanılmıyor, istersen silebilirsin)
    window.showCustomers = function() {
      document.getElementById('customersModal').style.display = 'flex';
      let musteriMap = {};
      for(const o of allOrders) {
        if(!o.email) continue;
        if(!musteriMap[o.email]) musteriMap[o.email] = { siparisler: [], telefon: o.telefon, adres: (o.sehir||'')+" "+(o.acikAdres||'') };
        musteriMap[o.email].siparisler.push(o);
      }
      let html = "";
      for(const e in musteriMap) {
        const m = musteriMap[e];
        html += `<div class="customer-group"><b>${e}</b>
        <br>Telefon: <span>${m.telefon||"-"}</span>
        <br>Adres: <span>${m.adres||"-"}</span>
        <ul>`;
        for(const s of m.siparisler) {
          html += `<li>${s.siparisKodu || "-"} | ${s.kategori || "-"} | ${s.toplamTutar || "-"} TL | ${s.durum || "Yeni"}</li>`;
        }
        html += `</ul></div>`;
      }
      document.getElementById('customersList').innerHTML = html || "Kayıt yok.";
    }
    window.closeCustomersModal = function() {
      document.getElementById('customersModal').style.display = 'none';
    }

    // EK: Durum filtresi değişince otomatik filtre uygula
    document.addEventListener('DOMContentLoaded', function() {
      var statusFilter = document.getElementById('statusFilter');
      if (statusFilter) {
        statusFilter.addEventListener('change', function() {
          filterOrders();
        });
      }
    });
    // Kayıtlı Müşteriler açılır liste dışına tıklanınca kapanır
    document.addEventListener('click', function(e) {
      const dropdown = document.getElementById('customersDropdown');
      const btn = document.querySelector('button[onclick="toggleCustomersDropdown()"]');
      if(dropdown && dropdown.style.display === "block") {
        if (!dropdown.contains(e.target) && e.target !== btn) {
          dropdown.style.display = "none";
          dropdown.innerHTML = "";
        }
      }
    });
  </script>
<!-- ADMIN GİRİŞ KONTROLÜ -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCHms5Y5x-KOu3Y43FrfRoljmW_4m3H4yY",
    authDomain: "kibris-6b4f7.firebaseapp.com",
    projectId: "kibris-6b4f7",
    storageBucket: "kibris-6b4f7.firebasestorage.app",
    messagingSenderId: "141262926171",
    appId: "1:141262926171:web:07226845e51d4bbc0dea7e",
    measurementId: "G-JL9P6BRZTD"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  onAuthStateChanged(auth, (user) => {
    const allowedAdminEmail = "emirmob09@gmail.com"; // <--- BURAYI KENDİ GOOGLE E-POSTANLA DEĞİŞTİR
    if (user) {
      if (user.email === allowedAdminEmail) {
        console.log("✅ Admin girişi başarılı:", user.email);
      } else {
        alert("❌ Bu sayfaya erişim yetkiniz yok.");
        window.location.href = "index.html";
      }
    } else {
      // Hiç giriş yapılmamışsa
      window.location.href = "index.html";
    }
  });
</script>

</body>
</html>

<!-- Kayıtlı Müşteriler açılır liste ve detaylı sipariş gösterimi entegre edildi! -->
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Paneli</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Tüm CSS kodların burada ve DEĞİŞMEDEN duruyor */
  </style>
</head>
<body>
  <!-- Google ile Giriş ekranı -->
  <div id="loginModal" class="modal-bg" style="display:flex;">
    <div class="modal">
      <h2>Google ile Giriş Yap</h2>
      <button class="google-btn" onclick="googleSignIn()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-logo" alt="Google">
        Google hesabı ile giriş yap
      </button>
      <div id="loginError" class="error-msg"></div>
    </div>
  </div>

  <div class="admin-container" style="display:none;" id="adminPanel">
    <h1>Admin Paneli</h1>
    <div class="toolbar" style="position:relative;">
      <input type="text" id="searchSiparisKodu" placeholder="Sipariş Kodu ile ara">
      <input type="text" id="searchMusteri" placeholder="Müşteri adı ile ara">
      <input type="date" id="startDate">
      <span style="color:#ececec;">—</span>
      <input type="date" id="endDate">
      <select id="statusFilter" class="status-filter-select">
        <option value="">Tüm Durumlar</option>
        <option value="Bekleniyor">Bekleniyor</option>
        <option value="Tr Depoda">Tr Depoda</option>
        <option value="Yüklendi">Yüklendi</option>
        <option value="Kıbrıs Depoda">Kıbrıs Depoda</option>
        <option value="Teslim Edildi">Teslim Edildi</option>
      </select>
      <button onclick="filterOrders()">Filtrele</button>
      <button onclick="clearFilters()">Temizle</button>
      <button onclick="toggleCustomersDropdown()">Kayıtlı Müşteriler</button>
      <button class="out-btn" onclick="adminLogout()">Çıkış Yap</button>
      <!-- Açılır müşteri listesi -->
      <div id="customersDropdown" class="customer-dropdown-list"></div>
    </div>
    <div class="summary-box" id="summaryBox">
      <span>Yükleniyor...</span>
    </div>
    <div class="success-info" id="successInfo"></div>
    <div class="error-info" id="errorInfo"></div>
    <div class="orders-card">
      <table class="orders-table" id="ordersTable">
        <thead>
          <tr>
            <th>Müşteri</th>
            <th>Sipariş Kodu</th>
            <th>Adres</th>
            <th>Telefon</th>
            <th>Kategori</th>
            <th>Toplam Tutar</th>
            <th>Durum</th>
            <th>İşlem</th>
          </tr>
        </thead>
        <tbody>
          <!-- Siparişler JS ile eklenecek -->
        </tbody>
      </table>
    </div>
  </div>

  <div id="customersModal" class="modal-bg">
    <div class="modal" style="max-width:520px;">
      <button class="modal-close" onclick="closeCustomersModal()">&times;</button>
      <h2>Kayıtlı Müşteriler</h2>
      <div id="customersList">
        <!-- Müşteri bilgileri JS ile eklenecek -->
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    // ...Tüm diğer kodlar ve fonksiyonlar burada değişmeden duruyor...

    // --- GÜNCELLEME: Filtreleme fonksiyonunda müşteri adı ile arama (adSoyad) ---
    window.filterOrders = function() {
      let kod = document.getElementById('searchSiparisKodu').value.trim().toLowerCase();
      let musteri = document.getElementById('searchMusteri').value.trim().toLowerCase();
      let start = document.getElementById('startDate').value;
      let end = document.getElementById('endDate').value;
      let status = document.getElementById('statusFilter').value; // <-- EKLENDİ
      let filtered = allOrders.filter(o => {
        let ok = true;
        if(kod && !(o.siparisKodu||"").toLowerCase().includes(kod)) ok = false;
        // Burada sadece bu satırı değiştirdim
        if(musteri && !(o.adSoyad||"").toLowerCase().includes(musteri)) ok = false;
        if(start) {
          let d = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : (o.createdAt instanceof Date ? o.createdAt : null);
          if(!d || d < new Date(start)) ok = false;
        }
        if(end) {
          let d = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : (o.createdAt instanceof Date ? o.createdAt : null);
          if(!d || d > new Date(end + "T23:59:59")) ok = false;
        }
        if(status && (o.durum||"") !== status) ok = false; // <-- EKLENDİ
        return ok;
      });
      renderOrders(filtered);
      renderSummary(filtered);
    }
    // -------------------------------------------------------------------------

    // ...Tüm diğer kodların devamı burada değişmeden duruyor...

    // EK: Durum filtresi değişince otomatik filtre uygula + müşteri adı yazarken anında filtrele
    document.addEventListener('DOMContentLoaded', function() {
      var statusFilter = document.getElementById('statusFilter');
      if (statusFilter) {
        statusFilter.addEventListener('change', function() {
          filterOrders();
        });
      }
      // --- GÜNCELLEME: Müşteri adı kutusu yazarken anlık filtreleme ---
      var musteriInput = document.getElementById('searchMusteri');
      if (musteriInput) {
        musteriInput.addEventListener('input', function() {
          filterOrders();
        });
      }
      // ----------------------------------------------------------------
    });

    // ...Tüm diğer kodların devamı burada değişmeden duruyor...
  </script>
</body>
</html>
